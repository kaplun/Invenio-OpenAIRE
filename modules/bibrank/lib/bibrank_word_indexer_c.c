/* Generated by Cython 0.11.2 on Thu Jul 16 11:43:29 2009 */

#define PY_SSIZE_T_CLEAN
#include "Python.h"
#include "structmember.h"
#ifndef Py_PYTHON_H
    #error Python headers needed to compile C extensions, please install development version of Python.
#endif
#ifndef PY_LONG_LONG
  #define PY_LONG_LONG LONG_LONG
#endif
#ifndef DL_EXPORT
  #define DL_EXPORT(t) t
#endif
#if PY_VERSION_HEX < 0x02040000
  #define METH_COEXIST 0
  #define PyDict_CheckExact(op) (Py_TYPE(op) == &PyDict_Type)
#endif
#if PY_VERSION_HEX < 0x02050000
  typedef int Py_ssize_t;
  #define PY_SSIZE_T_MAX INT_MAX
  #define PY_SSIZE_T_MIN INT_MIN
  #define PY_FORMAT_SIZE_T ""
  #define PyInt_FromSsize_t(z) PyInt_FromLong(z)
  #define PyInt_AsSsize_t(o)   PyInt_AsLong(o)
  #define PyNumber_Index(o)    PyNumber_Int(o)
  #define PyIndex_Check(o)     PyNumber_Check(o)
#endif
#if PY_VERSION_HEX < 0x02060000
  #define Py_REFCNT(ob) (((PyObject*)(ob))->ob_refcnt)
  #define Py_TYPE(ob)   (((PyObject*)(ob))->ob_type)
  #define Py_SIZE(ob)   (((PyVarObject*)(ob))->ob_size)
  #define PyVarObject_HEAD_INIT(type, size) \
          PyObject_HEAD_INIT(type) size,
  #define PyType_Modified(t)

  typedef struct {
       void *buf;
       PyObject *obj;
       Py_ssize_t len;
       Py_ssize_t itemsize;
       int readonly;
       int ndim;
       char *format;
       Py_ssize_t *shape;
       Py_ssize_t *strides;
       Py_ssize_t *suboffsets;
       void *internal;
  } Py_buffer;

  #define PyBUF_SIMPLE 0
  #define PyBUF_WRITABLE 0x0001
  #define PyBUF_FORMAT 0x0004
  #define PyBUF_ND 0x0008
  #define PyBUF_STRIDES (0x0010 | PyBUF_ND)
  #define PyBUF_C_CONTIGUOUS (0x0020 | PyBUF_STRIDES)
  #define PyBUF_F_CONTIGUOUS (0x0040 | PyBUF_STRIDES)
  #define PyBUF_ANY_CONTIGUOUS (0x0080 | PyBUF_STRIDES)
  #define PyBUF_INDIRECT (0x0100 | PyBUF_STRIDES)

#endif
#if PY_MAJOR_VERSION < 3
  #define __Pyx_BUILTIN_MODULE_NAME "__builtin__"
#else
  #define __Pyx_BUILTIN_MODULE_NAME "builtins"
#endif
#if PY_MAJOR_VERSION >= 3
  #define Py_TPFLAGS_CHECKTYPES 0
  #define Py_TPFLAGS_HAVE_INDEX 0
#endif
#if (PY_VERSION_HEX < 0x02060000) || (PY_MAJOR_VERSION >= 3)
  #define Py_TPFLAGS_HAVE_NEWBUFFER 0
#endif
#if PY_MAJOR_VERSION >= 3
  #define PyBaseString_Type            PyUnicode_Type
  #define PyString_Type                PyBytes_Type
  #define PyString_CheckExact          PyBytes_CheckExact
  #define PyInt_Type                   PyLong_Type
  #define PyInt_Check(op)              PyLong_Check(op)
  #define PyInt_CheckExact(op)         PyLong_CheckExact(op)
  #define PyInt_FromString             PyLong_FromString
  #define PyInt_FromUnicode            PyLong_FromUnicode
  #define PyInt_FromLong               PyLong_FromLong
  #define PyInt_FromSize_t             PyLong_FromSize_t
  #define PyInt_FromSsize_t            PyLong_FromSsize_t
  #define PyInt_AsLong                 PyLong_AsLong
  #define PyInt_AS_LONG                PyLong_AS_LONG
  #define PyInt_AsSsize_t              PyLong_AsSsize_t
  #define PyInt_AsUnsignedLongMask     PyLong_AsUnsignedLongMask
  #define PyInt_AsUnsignedLongLongMask PyLong_AsUnsignedLongLongMask
  #define __Pyx_PyNumber_Divide(x,y)         PyNumber_TrueDivide(x,y)
#else
  #define __Pyx_PyNumber_Divide(x,y)         PyNumber_Divide(x,y)
  #define PyBytes_Type                 PyString_Type
#endif
#if PY_MAJOR_VERSION >= 3
  #define PyMethod_New(func, self, klass) PyInstanceMethod_New(func)
#endif
#if !defined(WIN32) && !defined(MS_WINDOWS)
  #ifndef __stdcall
    #define __stdcall
  #endif
  #ifndef __cdecl
    #define __cdecl
  #endif
  #ifndef __fastcall
    #define __fastcall
  #endif
#else
  #define _USE_MATH_DEFINES
#endif
#if PY_VERSION_HEX < 0x02050000
  #define __Pyx_GetAttrString(o,n)   PyObject_GetAttrString((o),((char *)(n)))
  #define __Pyx_SetAttrString(o,n,a) PyObject_SetAttrString((o),((char *)(n)),(a))
  #define __Pyx_DelAttrString(o,n)   PyObject_DelAttrString((o),((char *)(n)))
#else
  #define __Pyx_GetAttrString(o,n)   PyObject_GetAttrString((o),(n))
  #define __Pyx_SetAttrString(o,n,a) PyObject_SetAttrString((o),(n),(a))
  #define __Pyx_DelAttrString(o,n)   PyObject_DelAttrString((o),(n))
#endif
#if PY_VERSION_HEX < 0x02050000
  #define __Pyx_NAMESTR(n) ((char *)(n))
  #define __Pyx_DOCSTR(n)  ((char *)(n))
#else
  #define __Pyx_NAMESTR(n) (n)
  #define __Pyx_DOCSTR(n)  (n)
#endif
#ifdef __cplusplus
#define __PYX_EXTERN_C extern "C"
#else
#define __PYX_EXTERN_C extern
#endif
#include <math.h>
#define __PYX_HAVE_API__bibrank_word_indexer_c
#include "math.h"
#define __PYX_USE_C99_COMPLEX defined(_Complex_I)


#ifdef __GNUC__
#define INLINE __inline__
#elif _WIN32
#define INLINE __inline
#else
#define INLINE 
#endif

typedef struct {PyObject **p; char *s; long n; char is_unicode; char intern; char is_identifier;} __Pyx_StringTabEntry; /*proto*/



static int __pyx_skip_dispatch = 0;


/* Type Conversion Predeclarations */

#if PY_MAJOR_VERSION < 3
#define __Pyx_PyBytes_FromString          PyString_FromString
#define __Pyx_PyBytes_FromStringAndSize   PyString_FromStringAndSize
#define __Pyx_PyBytes_AsString            PyString_AsString
#else
#define __Pyx_PyBytes_FromString          PyBytes_FromString
#define __Pyx_PyBytes_FromStringAndSize   PyBytes_FromStringAndSize
#define __Pyx_PyBytes_AsString            PyBytes_AsString
#endif

#define __Pyx_PyBool_FromLong(b) ((b) ? (Py_INCREF(Py_True), Py_True) : (Py_INCREF(Py_False), Py_False))
static INLINE int __Pyx_PyObject_IsTrue(PyObject*);
static INLINE PyObject* __Pyx_PyNumber_Int(PyObject* x);

#if !defined(T_PYSSIZET)
#if PY_VERSION_HEX < 0x02050000
#define T_PYSSIZET T_INT
#elif !defined(T_LONGLONG)
#define T_PYSSIZET \
        ((sizeof(Py_ssize_t) == sizeof(int))  ? T_INT  : \
        ((sizeof(Py_ssize_t) == sizeof(long)) ? T_LONG : -1))
#else
#define T_PYSSIZET \
        ((sizeof(Py_ssize_t) == sizeof(int))          ? T_INT      : \
        ((sizeof(Py_ssize_t) == sizeof(long))         ? T_LONG     : \
        ((sizeof(Py_ssize_t) == sizeof(PY_LONG_LONG)) ? T_LONGLONG : -1)))
#endif
#endif

#if !defined(T_SIZET)
#if !defined(T_ULONGLONG)
#define T_SIZET \
        ((sizeof(size_t) == sizeof(unsigned int))  ? T_UINT  : \
        ((sizeof(size_t) == sizeof(unsigned long)) ? T_ULONG : -1))
#else
#define T_SIZET \
        ((sizeof(size_t) == sizeof(unsigned int))          ? T_UINT      : \
        ((sizeof(size_t) == sizeof(unsigned long))         ? T_ULONG     : \
        ((sizeof(size_t) == sizeof(unsigned PY_LONG_LONG)) ? T_ULONGLONG : -1)))
#endif
#endif

static INLINE Py_ssize_t __Pyx_PyIndex_AsSsize_t(PyObject*);
static INLINE PyObject * __Pyx_PyInt_FromSize_t(size_t);
static INLINE size_t __Pyx_PyInt_AsSize_t(PyObject*);

#define __pyx_PyFloat_AsDouble(x) (PyFloat_CheckExact(x) ? PyFloat_AS_DOUBLE(x) : PyFloat_AsDouble(x))


#ifdef __GNUC__
/* Test for GCC > 2.95 */
#if __GNUC__ > 2 ||               (__GNUC__ == 2 && (__GNUC_MINOR__ > 95)) 
#define likely(x)   __builtin_expect(!!(x), 1)
#define unlikely(x) __builtin_expect(!!(x), 0)
#else /* __GNUC__ > 2 ... */
#define likely(x)   (x)
#define unlikely(x) (x)
#endif /* __GNUC__ > 2 ... */
#else /* __GNUC__ */
#define likely(x)   (x)
#define unlikely(x) (x)
#endif /* __GNUC__ */
    
static PyObject *__pyx_m;
static PyObject *__pyx_b;
static PyObject *__pyx_empty_tuple;
static int __pyx_lineno;
static int __pyx_clineno = 0;
static const char * __pyx_cfilenm= __FILE__;
static const char *__pyx_filename;
static const char **__pyx_f;

static char __pyx_mdoc[] = "\nCythonized BibRank word ranking algorithms.\n";


#ifdef CYTHON_REFNANNY
typedef struct {
  void (*INCREF)(void*, PyObject*, int);
  void (*DECREF)(void*, PyObject*, int);
  void (*GOTREF)(void*, PyObject*, int);
  void (*GIVEREF)(void*, PyObject*, int);
  void* (*NewContext)(const char*, int, const char*);
  void (*FinishContext)(void**);
} __Pyx_RefnannyAPIStruct;
static __Pyx_RefnannyAPIStruct *__Pyx_Refnanny = NULL;
#define __Pyx_ImportRefcountAPI(name)   (__Pyx_RefnannyAPIStruct *) PyCObject_Import((char *)name, (char *)"RefnannyAPI")
#define __Pyx_INCREF(r) __Pyx_Refnanny->INCREF(__pyx_refchk, (PyObject *)(r), __LINE__)
#define __Pyx_DECREF(r) __Pyx_Refnanny->DECREF(__pyx_refchk, (PyObject *)(r), __LINE__)
#define __Pyx_GOTREF(r) __Pyx_Refnanny->GOTREF(__pyx_refchk, (PyObject *)(r), __LINE__)
#define __Pyx_GIVEREF(r) __Pyx_Refnanny->GIVEREF(__pyx_refchk, (PyObject *)(r), __LINE__)
#define __Pyx_XDECREF(r) if((r) == NULL) ; else __Pyx_DECREF(r)
#define __Pyx_SetupRefcountContext(name)   void* __pyx_refchk = __Pyx_Refnanny->NewContext((name), __LINE__, __FILE__)
#define __Pyx_FinishRefcountContext()   __Pyx_Refnanny->FinishContext(&__pyx_refchk)
#else
#define __Pyx_INCREF(r) Py_INCREF(r)
#define __Pyx_DECREF(r) Py_DECREF(r)
#define __Pyx_GOTREF(r)
#define __Pyx_GIVEREF(r)
#define __Pyx_XDECREF(r) Py_XDECREF(r)
#define __Pyx_SetupRefcountContext(name)
#define __Pyx_FinishRefcountContext()
#endif /* CYTHON_REFNANNY */
#define __Pyx_XGIVEREF(r) if((r) == NULL) ; else __Pyx_GIVEREF(r)
#define __Pyx_XGOTREF(r) if((r) == NULL) ; else __Pyx_GOTREF(r)

static void __Pyx_RaiseDoubleKeywordsError(
    const char* func_name, PyObject* kw_name); /*proto*/

static void __Pyx_RaiseArgtupleInvalid(const char* func_name, int exact,
    Py_ssize_t num_min, Py_ssize_t num_max, Py_ssize_t num_found); /*proto*/

static int __Pyx_ParseOptionalKeywords(PyObject *kwds, PyObject **argnames[],     PyObject *kwds2, PyObject *values[], Py_ssize_t num_pos_args,     const char* function_name); /*proto*/


static INLINE PyObject *__Pyx_GetItemInt_Generic(PyObject *o, PyObject* j) {
    PyObject *r;
    if (!j) return NULL;
    r = PyObject_GetItem(o, j);
    Py_DECREF(j);
    return r;
}


#define __Pyx_GetItemInt_List(o, i, size, to_py_func) ((size <= sizeof(Py_ssize_t)) ? \
                                                    __Pyx_GetItemInt_List_Fast(o, i, size <= sizeof(long)) : \
                                                    __Pyx_GetItemInt_Generic(o, to_py_func(i)))

static INLINE PyObject *__Pyx_GetItemInt_List_Fast(PyObject *o, Py_ssize_t i, int fits_long) {
    if (likely(o != Py_None)) {
        if (likely((0 <= i) & (i < PyList_GET_SIZE(o)))) {
            PyObject *r = PyList_GET_ITEM(o, i);
            Py_INCREF(r);
            return r;
        }
        else if ((-PyList_GET_SIZE(o) <= i) & (i < 0)) {
            PyObject *r = PyList_GET_ITEM(o, PyList_GET_SIZE(o) + i);
            Py_INCREF(r);
            return r;
        }
    }
    return __Pyx_GetItemInt_Generic(o, fits_long ? PyInt_FromLong(i) : PyLong_FromLongLong(i));
}

#define __Pyx_GetItemInt_Tuple(o, i, size, to_py_func) ((size <= sizeof(Py_ssize_t)) ? \
                                                    __Pyx_GetItemInt_Tuple_Fast(o, i, size <= sizeof(long)) : \
                                                    __Pyx_GetItemInt_Generic(o, to_py_func(i)))

static INLINE PyObject *__Pyx_GetItemInt_Tuple_Fast(PyObject *o, Py_ssize_t i, int fits_long) {
    if (likely(o != Py_None)) {
        if (likely((0 <= i) & (i < PyTuple_GET_SIZE(o)))) {
            PyObject *r = PyTuple_GET_ITEM(o, i);
            Py_INCREF(r);
            return r;
        }
        else if ((-PyTuple_GET_SIZE(o) <= i) & (i < 0)) {
            PyObject *r = PyTuple_GET_ITEM(o, PyTuple_GET_SIZE(o) + i);
            Py_INCREF(r);
            return r;
        }
    }
    return __Pyx_GetItemInt_Generic(o, fits_long ? PyInt_FromLong(i) : PyLong_FromLongLong(i));
}


#define __Pyx_GetItemInt(o, i, size, to_py_func) ((size <= sizeof(Py_ssize_t)) ? \
                                                    __Pyx_GetItemInt_Fast(o, i, size <= sizeof(long)) : \
                                                    __Pyx_GetItemInt_Generic(o, to_py_func(i)))

static INLINE PyObject *__Pyx_GetItemInt_Fast(PyObject *o, Py_ssize_t i, int fits_long) {
    PyObject *r;
    if (PyList_CheckExact(o) && ((0 <= i) & (i < PyList_GET_SIZE(o)))) {
        r = PyList_GET_ITEM(o, i);
        Py_INCREF(r);
    }
    else if (PyTuple_CheckExact(o) && ((0 <= i) & (i < PyTuple_GET_SIZE(o)))) {
        r = PyTuple_GET_ITEM(o, i);
        Py_INCREF(r);
    }
    else if (Py_TYPE(o)->tp_as_sequence && Py_TYPE(o)->tp_as_sequence->sq_item && (likely(i >= 0))) {
        r = PySequence_GetItem(o, i);
    }
    else {
        r = __Pyx_GetItemInt_Generic(o, fits_long ? PyInt_FromLong(i) : PyLong_FromLongLong(i));
    }
    return r;
}

#define __Pyx_SetItemInt(o, i, v, size, to_py_func) ((size <= sizeof(Py_ssize_t)) ? \
                                                    __Pyx_SetItemInt_Fast(o, i, v, size <= sizeof(long)) : \
                                                    __Pyx_SetItemInt_Generic(o, to_py_func(i), v))

static INLINE int __Pyx_SetItemInt_Generic(PyObject *o, PyObject *j, PyObject *v) {
    int r;
    if (!j) return -1;
    r = PyObject_SetItem(o, j, v);
    Py_DECREF(j);
    return r;
}

static INLINE int __Pyx_SetItemInt_Fast(PyObject *o, Py_ssize_t i, PyObject *v, int fits_long) {
    if (PyList_CheckExact(o) && ((0 <= i) & (i < PyList_GET_SIZE(o)))) {
        Py_INCREF(v);
        Py_DECREF(PyList_GET_ITEM(o, i));
        PyList_SET_ITEM(o, i, v);
        return 1;
    }
    else if (Py_TYPE(o)->tp_as_sequence && Py_TYPE(o)->tp_as_sequence->sq_ass_item && (likely(i >= 0)))
        return PySequence_SetItem(o, i, v);
    else {
        PyObject *j = fits_long ? PyInt_FromLong(i) : PyLong_FromLongLong(i);
        return __Pyx_SetItemInt_Generic(o, j, v);
    }
}

static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb); /*proto*/

static int __Pyx_ArgTypeTest(PyObject *obj, PyTypeObject *type, int none_allowed,
    const char *name, int exact); /*proto*/

static INLINE void __Pyx_ExceptionSave(PyObject **type, PyObject **value, PyObject **tb); /*proto*/
static void __Pyx_ExceptionReset(PyObject *type, PyObject *value, PyObject *tb); /*proto*/

static PyObject *__Pyx_Import(PyObject *name, PyObject *from_list); /*proto*/

static int __Pyx_Print(PyObject *, int); /*proto*/
#if PY_MAJOR_VERSION >= 3
static PyObject* __pyx_print = 0;
static PyObject* __pyx_print_kwargs = 0;
#endif

static int __Pyx_PrintOne(PyObject *o); /*proto*/

static PyObject *__Pyx_GetName(PyObject *dict, PyObject *name); /*proto*/

static INLINE void __Pyx_RaiseNeedMoreValuesError(Py_ssize_t index);

static INLINE void __Pyx_RaiseTooManyValuesError(void);

static PyObject *__Pyx_UnpackItem(PyObject *, Py_ssize_t index); /*proto*/
static int __Pyx_EndUnpack(PyObject *); /*proto*/

static INLINE int __Pyx_StrEq(const char *, const char *); /*proto*/

static INLINE unsigned char __Pyx_PyInt_AsUnsignedChar(PyObject *);

static INLINE unsigned short __Pyx_PyInt_AsUnsignedShort(PyObject *);

static INLINE unsigned int __Pyx_PyInt_AsUnsignedInt(PyObject *);

static INLINE char __Pyx_PyInt_AsChar(PyObject *);

static INLINE short __Pyx_PyInt_AsShort(PyObject *);

static INLINE int __Pyx_PyInt_AsInt(PyObject *);

static INLINE signed char __Pyx_PyInt_AsSignedChar(PyObject *);

static INLINE signed short __Pyx_PyInt_AsSignedShort(PyObject *);

static INLINE signed int __Pyx_PyInt_AsSignedInt(PyObject *);

static INLINE unsigned long __Pyx_PyInt_AsUnsignedLong(PyObject *);

static INLINE unsigned PY_LONG_LONG __Pyx_PyInt_AsUnsignedLongLong(PyObject *);

static INLINE long __Pyx_PyInt_AsLong(PyObject *);

static INLINE PY_LONG_LONG __Pyx_PyInt_AsLongLong(PyObject *);

static INLINE signed long __Pyx_PyInt_AsSignedLong(PyObject *);

static INLINE signed PY_LONG_LONG __Pyx_PyInt_AsSignedLongLong(PyObject *);

static void __Pyx_AddTraceback(const char *funcname); /*proto*/

static int __Pyx_InitStrings(__Pyx_StringTabEntry *t); /*proto*/

/* Type declarations */
/* Module declarations from bibrank_word_indexer_c */

static PyObject *__pyx_f_22bibrank_word_indexer_c_get_from_forward_index(PyObject *, int, int, PyObject *, int __pyx_skip_dispatch); /*proto*/
static PyObject *__pyx_f_22bibrank_word_indexer_c_get_from_forward_index_with_id(int, int, PyObject *, int __pyx_skip_dispatch); /*proto*/
static PyObject *__pyx_f_22bibrank_word_indexer_c_get_from_reverse_index(PyObject *, int, int, PyObject *, int __pyx_skip_dispatch); /*proto*/
static PyObject *__pyx_f_22bibrank_word_indexer_c_serialize_via_marshal(PyObject *); /*proto*/
static PyObject *__pyx_f_22bibrank_word_indexer_c_deserialize_via_marshal(PyObject *); /*proto*/
#define __Pyx_MODULE_NAME "bibrank_word_indexer_c"
int __pyx_module_is_main_bibrank_word_indexer_c = 0;

/* Implementation of bibrank_word_indexer_c */
static PyObject *__pyx_int_0;
static PyObject *__pyx_int_1;
static PyObject *__pyx_int_2;
static PyObject *__pyx_int_100;
static PyObject *__pyx_int_60;
static char __pyx_k___main__[] = "__main__";
static PyObject *__pyx_kp___main__;
static char __pyx_k_1[] = "get_from_forward_index";
static PyObject *__pyx_kp_1;
static char __pyx_k_2[] = "get_from_forward_index_with_id";
static PyObject *__pyx_kp_2;
static char __pyx_k_3[] = "get_from_reverse_index";
static PyObject *__pyx_kp_3;
static char __pyx_k_table[] = "table";
static PyObject *__pyx_kp_table;
static char __pyx_k_terms[] = "terms";
static PyObject *__pyx_kp_terms;
static char __pyx_k_start[] = "start";
static PyObject *__pyx_kp_start;
static char __pyx_k_stop[] = "stop";
static PyObject *__pyx_kp_stop;
static char __pyx_k_records[] = "records";
static PyObject *__pyx_kp_records;
static char __pyx_k_marshal[] = "marshal";
static PyObject *__pyx_kp_marshal;
static char __pyx_k_loads[] = "loads";
static PyObject *__pyx_kp_loads;
static char __pyx_k_dumps[] = "dumps";
static PyObject *__pyx_kp_dumps;
static char __pyx_k_zlib[] = "zlib";
static PyObject *__pyx_kp_zlib;
static char __pyx_k_compress[] = "compress";
static PyObject *__pyx_kp_compress;
static char __pyx_k_decompress[] = "decompress";
static PyObject *__pyx_kp_decompress;
static char __pyx_k_time[] = "time";
static PyObject *__pyx_kp_time;
static char __pyx_k_4[] = "invenio.bibtask";
static PyObject *__pyx_kp_4;
static char __pyx_k_task_get_option[] = "task_get_option";
static PyObject *__pyx_kp_task_get_option;
static char __pyx_k_5[] = "task_update_progress";
static PyObject *__pyx_kp_5;
static char __pyx_k_6[] = "task_sleep_now_if_required";
static PyObject *__pyx_kp_6;
static char __pyx_k_write_message[] = "write_message";
static PyObject *__pyx_kp_write_message;
static char __pyx_k_7[] = "invenio.errorlib";
static PyObject *__pyx_kp_7;
static char __pyx_k_register_exception[] = "register_exception";
static PyObject *__pyx_kp_register_exception;
static char __pyx_k_8[] = "invenio.dbquery";
static PyObject *__pyx_kp_8;
static char __pyx_k_run_sql[] = "run_sql";
static PyObject *__pyx_kp_run_sql;
static char __pyx_k_10[] = "quick";
static PyObject *__pyx_kp_10;
static char __pyx_k_11[] = "yes";
static PyObject *__pyx_kp_11;
static char __pyx_k_14[] = "quick";
static PyObject *__pyx_kp_14;
static char __pyx_k_15[] = "yes";
static PyObject *__pyx_kp_15;
static char __pyx_k_has_key[] = "has_key";
static PyObject *__pyx_kp_has_key;
static char __pyx_k_19[] = "Gi";
static PyObject *__pyx_kp_19;
static char __pyx_k_20[] = "Gi";
static PyObject *__pyx_kp_20;
static char __pyx_k_iteritems[] = "iteritems";
static PyObject *__pyx_kp_iteritems;
static char __pyx_k_21[] = "quick";
static PyObject *__pyx_kp_21;
static char __pyx_k_22[] = "yes";
static PyObject *__pyx_kp_22;
static char __pyx_k_23[] = "quick";
static PyObject *__pyx_kp_23;
static char __pyx_k_24[] = "no";
static PyObject *__pyx_kp_24;
static char __pyx_k_34[] = "Gi";
static PyObject *__pyx_kp_34;
static char __pyx_k_35[] = "Gi";
static PyObject *__pyx_kp_35;
static char __pyx_k_40[] = "quick";
static PyObject *__pyx_kp_40;
static char __pyx_k_41[] = "no";
static PyObject *__pyx_kp_41;
static char __pyx_k_43[] = "Gi";
static PyObject *__pyx_kp_43;
static char __pyx_k_44[] = "Gi";
static PyObject *__pyx_kp_44;
static char __pyx_k_49[] = "Gi";
static PyObject *__pyx_kp_49;
static char __pyx_k_50[] = "Gi";
static PyObject *__pyx_kp_50;
static char __pyx_k_get[] = "get";
static PyObject *__pyx_kp_get;
static char __pyx_k_ZeroDivisionError[] = "ZeroDivisionError";
static PyObject *__pyx_kp_ZeroDivisionError;
static char __pyx_k_OverflowError[] = "OverflowError";
static PyObject *__pyx_kp_OverflowError;
static char __pyx_k_prefix[] = "prefix";
static PyObject *__pyx_kp_prefix;
static char __pyx_k_alert_admin[] = "alert_admin";
static PyObject *__pyx_kp_alert_admin;
static char __pyx_k_61[] = "Gi";
static PyObject *__pyx_kp_61;
static char __pyx_k_62[] = "Gi";
static PyObject *__pyx_kp_62;
static char __pyx_k_63[] = "Gi";
static PyObject *__pyx_kp_63;
static char __pyx_k_min[] = "min";
static PyObject *__pyx_kp_min;
static PyObject *__pyx_builtin_ZeroDivisionError;
static PyObject *__pyx_builtin_OverflowError;
static PyObject *__pyx_builtin_min;
static PyObject *__pyx_kp_9;
static PyObject *__pyx_kp_12;
static PyObject *__pyx_kp_13;
static PyObject *__pyx_kp_16;
static PyObject *__pyx_kp_17;
static PyObject *__pyx_kp_18;
static PyObject *__pyx_kp_25;
static PyObject *__pyx_kp_26;
static PyObject *__pyx_kp_27;
static PyObject *__pyx_kp_28;
static PyObject *__pyx_kp_29;
static PyObject *__pyx_kp_30;
static PyObject *__pyx_kp_31;
static PyObject *__pyx_kp_32;
static PyObject *__pyx_kp_33;
static PyObject *__pyx_kp_36;
static PyObject *__pyx_kp_37;
static PyObject *__pyx_kp_38;
static PyObject *__pyx_kp_39;
static PyObject *__pyx_kp_42;
static PyObject *__pyx_kp_45;
static PyObject *__pyx_kp_46;
static PyObject *__pyx_kp_47;
static PyObject *__pyx_kp_48;
static PyObject *__pyx_kp_51;
static PyObject *__pyx_kp_52;
static PyObject *__pyx_kp_53;
static PyObject *__pyx_kp_54;
static PyObject *__pyx_kp_55;
static PyObject *__pyx_kp_56;
static PyObject *__pyx_kp_57;
static PyObject *__pyx_kp_58;
static PyObject *__pyx_kp_59;
static PyObject *__pyx_kp_60;
static PyObject *__pyx_kp_64;
static PyObject *__pyx_kp_65;
static PyObject *__pyx_kp_66;
static PyObject *__pyx_kp_67;
static PyObject *__pyx_kp_68;
static PyObject *__pyx_kp_69;
static PyObject *__pyx_kp_70;
static PyObject *__pyx_kp_71;
static char __pyx_k_9[] = "select count(id_bibrec) from %sR";
static char __pyx_k_12[] = "No terms to process, ending...";
static char __pyx_k_13[] = "";
static char __pyx_k_16[] = "Beginning post-processing of %s terms";
static char __pyx_k_17[] = "Post-processing %s terms";
static char __pyx_k_18[] = "Phase 1: Finding records containing modified terms";
static char __pyx_k_25[] = "Phase 1: ......processed %s/%s terms";
static char __pyx_k_26[] = "Post-processing phase 1: %s/%s terms";
static char __pyx_k_27[] = "Phase 1: Finished finding records containing modified terms";
static char __pyx_k_28[] = "Phase 2: Finding all terms in affected records";
static char __pyx_k_29[] = "Phase 2: ......processed %s/%s records ";
static char __pyx_k_30[] = "Post-processing phase 2: %s/%s records";
static char __pyx_k_31[] = "Phase 2: Finished finding all terms in affected records";
static char __pyx_k_32[] = "SELECT MAX(id) FROM %s";
static char __pyx_k_33[] = "Beginning recalculation of %s terms";
static char __pyx_k_36[] = "Phase 1: ......processed %s/%s terms";
static char __pyx_k_37[] = "Post-processing phase 1: %s/%s terms";
static char __pyx_k_38[] = "Phase 1: Finished finding which records contains which terms";
static char __pyx_k_39[] = "Phase 2: Jumping over..already done in phase 1 because of -R option";
static char __pyx_k_42[] = "Phase 3: Calculating importance of all affected terms";
static char __pyx_k_45[] = "Phase 3: ......processed %s/%s terms";
static char __pyx_k_46[] = "Post-processing phase 3: %s/%s terms";
static char __pyx_k_47[] = "Phase 3: Finished calculating importance of all affected terms";
static char __pyx_k_48[] = "Phase 3: Getting approximate importance of all affected terms";
static char __pyx_k_51[] = "Phase 3: ......processed %s/%s terms";
static char __pyx_k_52[] = "Post-processing phase 3: %s/%s terms";
static char __pyx_k_53[] = "Phase 3: Finished getting approximate importance of all affected terms";
static char __pyx_k_54[] = "Phase 4: Calculating normalization value for all affected records and updating %sR";
static char __pyx_k_55[] = "UPDATE %sR SET termlist=%%s WHERE id_bibrec=%%s";
static char __pyx_k_56[] = "Error when analysing the record %s (%s): %s\n";
static char __pyx_k_57[] = "Phase 4: ......processed %s/%s records";
static char __pyx_k_58[] = "Post-processing phase 4: %s/%s records";
static char __pyx_k_59[] = "Phase 4: Finished calculating normalization value for all affected records and updating %sR";
static char __pyx_k_60[] = "Phase 5: Updating %s with new normalization values";
static char __pyx_k_64[] = "UPDATE %s SET hitlist=%%s WHERE term=%%s";
static char __pyx_k_65[] = "Error when analysing the term %s (%s): %s\n";
static char __pyx_k_66[] = "Phase 5: ......processed %s/%s terms";
static char __pyx_k_67[] = "Post-processing phase 5: %s/%s terms";
static char __pyx_k_68[] = "Phase 5:  Finished updating %s with new normalization values";
static char __pyx_k_69[] = "Time used for post-processing: %.1fmin";
static char __pyx_k_70[] = "Finished post-processing";
static char __pyx_k_71[] = "Post-processing done";
static PyObject *__pyx_kp_72;
static char __pyx_k_72[] = "SELECT term, hitlist FROM %s WHERE term=%%s";
static PyObject *__pyx_kp_73;
static char __pyx_k_73[] = "SELECT term, hitlist FROM %s WHERE id BETWEEN %%s AND %%s";
static PyObject *__pyx_kp_74;
static PyObject *__pyx_kp_75;
static char __pyx_k_74[] = "%s";
static char __pyx_k_75[] = "SELECT id_bibrec, termlist FROM %sR WHERE id_bibrec IN (%s)";

/* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":36
 *     float logf(float x)
 * 
 * def test():             # <<<<<<<<<<<<<<
 *     cdef float x = 1
 *     x = x / 0.0
 */

static PyObject *__pyx_pf_22bibrank_word_indexer_c_test(PyObject *__pyx_self, PyObject *unused); /*proto*/
static PyObject *__pyx_pf_22bibrank_word_indexer_c_test(PyObject *__pyx_self, PyObject *unused) {
  float __pyx_v_x;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  __Pyx_SetupRefcountContext("test");
  __pyx_self = __pyx_self;

  /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":37
 * 
 * def test():
 *     cdef float x = 1             # <<<<<<<<<<<<<<
 *     x = x / 0.0
 *     print x
 */
  __pyx_v_x = 1;

  /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":38
 * def test():
 *     cdef float x = 1
 *     x = x / 0.0             # <<<<<<<<<<<<<<
 *     print x
 *     return x
 */
  __pyx_v_x = (__pyx_v_x / 0.0);

  /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":39
 *     cdef float x = 1
 *     x = x / 0.0
 *     print x             # <<<<<<<<<<<<<<
 *     return x
 * 
 */
  __pyx_t_1 = PyFloat_FromDouble(__pyx_v_x); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 39; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (__Pyx_PrintOne(__pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 39; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":40
 *     x = x / 0.0
 *     print x
 *     return x             # <<<<<<<<<<<<<<
 * 
 * def update_rnkWORD(str table, list terms):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyFloat_FromDouble(__pyx_v_x); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 40; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("bibrank_word_indexer_c.test");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_FinishRefcountContext();
  return __pyx_r;
}

/* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":42
 *     return x
 * 
 * def update_rnkWORD(str table, list terms):             # <<<<<<<<<<<<<<
 *     """Updates rnkWORDF and rnkWORDR with Gi and Nj values. For each term in rnkWORDF, a Gi value for the term is added. And for each term in each document, the Nj value for that document is added. In rnkWORDR, the Gi value for each term in each document is added. For description on how things are computed, look in the hacking docs.
 *     table - name of forward index to update
 */

static PyObject *__pyx_pf_22bibrank_word_indexer_c_update_rnkWORD(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_22bibrank_word_indexer_c_update_rnkWORD[] = "Updates rnkWORDF and rnkWORDR with Gi and Nj values. For each term in rnkWORDF, a Gi value for the term is added. And for each term in each document, the Nj value for that document is added. In rnkWORDR, the Gi value for each term in each document is added. For description on how things are computed, look in the hacking docs.\n    table - name of forward index to update\n    terms - modified terms";
static PyObject *__pyx_pf_22bibrank_word_indexer_c_update_rnkWORD(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_table = 0;
  PyObject *__pyx_v_terms = 0;
  float __pyx_v_stime;
  PyObject *__pyx_v_Gi = 0;
  PyObject *__pyx_v_Nj = 0;
  int __pyx_v_N;
  int __pyx_v_i;
  int __pyx_v_j;
  int __pyx_v_max_id;
  PyObject *__pyx_v_terms_docs;
  PyObject *__pyx_v_docs_terms;
  PyObject *__pyx_v_hitlist;
  PyObject *__pyx_v_t;
  PyObject *__pyx_v_termlist;
  PyObject *__pyx_v_term_docs;
  PyObject *__pyx_v_tf;
  PyObject *__pyx_v_records;
  float __pyx_v_log2N;
  PyObject *__pyx_v_doc_terms;
  PyObject *__pyx_v_Fi;
  PyObject *__pyx_v_Git;
  PyObject *__pyx_v_e;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  int __pyx_4;
  PyObject *__pyx_5 = 0;
  PyObject *__pyx_6 = 0;
  PyObject *__pyx_t_1 = NULL;
  float __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  int __pyx_t_5;
  int __pyx_t_6;
  int __pyx_t_7;
  Py_ssize_t __pyx_t_8;
  PyObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  Py_ssize_t __pyx_t_11;
  void *__pyx_t_12;
  void *__pyx_t_13;
  PyObject *__pyx_t_14 = NULL;
  static PyObject **__pyx_pyargnames[] = {&__pyx_kp_table,&__pyx_kp_terms,0};
  __Pyx_SetupRefcountContext("update_rnkWORD");
  __pyx_self = __pyx_self;
  if (unlikely(__pyx_kwds)) {
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[2] = {0,0};
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_kp_table);
      if (likely(values[0])) kw_args--;
      else goto __pyx_L5_argtuple_error;
      case  1:
      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_kp_terms);
      if (likely(values[1])) kw_args--;
      else {
        __Pyx_RaiseArgtupleInvalid("update_rnkWORD", 1, 2, 2, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 42; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "update_rnkWORD") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 42; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    __pyx_v_table = ((PyObject *)values[0]);
    __pyx_v_terms = ((PyObject *)values[1]);
  } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
    goto __pyx_L5_argtuple_error;
  } else {
    __pyx_v_table = ((PyObject *)PyTuple_GET_ITEM(__pyx_args, 0));
    __pyx_v_terms = ((PyObject *)PyTuple_GET_ITEM(__pyx_args, 1));
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("update_rnkWORD", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 42; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("bibrank_word_indexer_c.update_rnkWORD");
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __Pyx_INCREF(__pyx_v_terms);
  __pyx_v_terms_docs = ((PyObject *)Py_None); __Pyx_INCREF(Py_None);
  __pyx_v_docs_terms = ((PyObject *)Py_None); __Pyx_INCREF(Py_None);
  __pyx_v_hitlist = ((PyObject *)Py_None); __Pyx_INCREF(Py_None);
  __pyx_v_t = ((PyObject *)Py_None); __Pyx_INCREF(Py_None);
  __pyx_v_termlist = ((PyObject *)Py_None); __Pyx_INCREF(Py_None);
  __pyx_v_term_docs = ((PyObject *)Py_None); __Pyx_INCREF(Py_None);
  __pyx_v_tf = ((PyObject *)Py_None); __Pyx_INCREF(Py_None);
  __pyx_v_records = ((PyObject *)Py_None); __Pyx_INCREF(Py_None);
  __pyx_v_doc_terms = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_Fi = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_Git = Py_None; __Pyx_INCREF(Py_None);
  __pyx_v_e = Py_None; __Pyx_INCREF(Py_None);
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_table), &PyString_Type, 1, "table", 1))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 42; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_terms), &PyList_Type, 1, "terms", 1))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 42; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":47
 *     terms - modified terms"""
 * 
 *     cdef float stime = time()             # <<<<<<<<<<<<<<
 *     cdef dict Gi = {}
 *     cdef dict Nj = {}
 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_time); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 47; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __pyx_t_1 = PyObject_Call(__pyx_1, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 47; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_t_2 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 47; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_stime = __pyx_t_2;

  /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":48
 * 
 *     cdef float stime = time()
 *     cdef dict Gi = {}             # <<<<<<<<<<<<<<
 *     cdef dict Nj = {}
 *     cdef int N = run_sql("select count(id_bibrec) from %sR" % table[:-1])[0][0]
 */
  __pyx_1 = PyDict_New(); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 48; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_1));
  __pyx_v_Gi = __pyx_1;
  __pyx_1 = 0;

  /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":49
 *     cdef float stime = time()
 *     cdef dict Gi = {}
 *     cdef dict Nj = {}             # <<<<<<<<<<<<<<
 *     cdef int N = run_sql("select count(id_bibrec) from %sR" % table[:-1])[0][0]
 *     cdef int i, j, max_id
 */
  __pyx_1 = PyDict_New(); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 49; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_1));
  __pyx_v_Nj = __pyx_1;
  __pyx_1 = 0;

  /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":50
 *     cdef dict Gi = {}
 *     cdef dict Nj = {}
 *     cdef int N = run_sql("select count(id_bibrec) from %sR" % table[:-1])[0][0]             # <<<<<<<<<<<<<<
 *     cdef int i, j, max_id
 *     cdef tuple terms_docs, docs_terms
 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_run_sql); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 50; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __pyx_2 = PySequence_GetSlice(((PyObject *)__pyx_v_table), 0, -1); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 50; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_2));
  __pyx_t_1 = PyNumber_Remainder(__pyx_kp_9, ((PyObject *)__pyx_2)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 50; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(((PyObject *)__pyx_2)); __pyx_2 = 0;
  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 50; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_3));
  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = PyObject_Call(__pyx_1, ((PyObject *)__pyx_t_3), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 50; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  __pyx_2 = __Pyx_GetItemInt(__pyx_t_1, 0, sizeof(long), PyInt_FromLong); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 50; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_1 = __Pyx_GetItemInt(__pyx_2, 0, sizeof(long), PyInt_FromLong); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 50; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_t_4 = __Pyx_PyInt_AsInt(__pyx_1); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 50; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_v_N = __pyx_t_4;

  /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":57
 *     cdef tuple tf
 *     cdef list records
 *     cdef float log2N = logf(2) * logf(N)             # <<<<<<<<<<<<<<
 * 
 *     if not terms and task_get_option("quick") == "yes":
 */
  __pyx_v_log2N = (logf(2) * logf(__pyx_v_N));

  /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":59
 *     cdef float log2N = logf(2) * logf(N)
 * 
 *     if not terms and task_get_option("quick") == "yes":             # <<<<<<<<<<<<<<
 *         write_message("No terms to process, ending...")
 *         return ""
 */
  __pyx_t_5 = __Pyx_PyObject_IsTrue(((PyObject *)__pyx_v_terms)); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 59; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_6 = (!__pyx_t_5);
  if (__pyx_t_6) {
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_kp_task_get_option); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 59; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_2);
    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 59; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    __Pyx_INCREF(__pyx_kp_10);
    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_10);
    __Pyx_GIVEREF(__pyx_kp_10);
    __pyx_t_3 = PyObject_Call(__pyx_2, ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 59; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    __pyx_t_1 = PyObject_RichCompare(__pyx_t_3, __pyx_kp_11, Py_EQ); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 59; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 59; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_7 = __pyx_t_5;
  } else {
    __pyx_t_7 = __pyx_t_6;
  }
  if (__pyx_t_7) {

    /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":60
 * 
 *     if not terms and task_get_option("quick") == "yes":
 *         write_message("No terms to process, ending...")             # <<<<<<<<<<<<<<
 *         return ""
 *     elif task_get_option("quick") == "yes": #not used -R option, fast calculation (not accurate)
 */
    __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_write_message); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 60; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 60; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    __Pyx_INCREF(__pyx_kp_12);
    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_12);
    __Pyx_GIVEREF(__pyx_kp_12);
    __pyx_t_3 = PyObject_Call(__pyx_1, ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 60; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":61
 *     if not terms and task_get_option("quick") == "yes":
 *         write_message("No terms to process, ending...")
 *         return ""             # <<<<<<<<<<<<<<
 *     elif task_get_option("quick") == "yes": #not used -R option, fast calculation (not accurate)
 *         write_message("Beginning post-processing of %s terms" % len(terms))
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(__pyx_kp_13);
    __pyx_r = __pyx_kp_13;
    goto __pyx_L0;
    goto __pyx_L6;
  }

  /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":62
 *         write_message("No terms to process, ending...")
 *         return ""
 *     elif task_get_option("quick") == "yes": #not used -R option, fast calculation (not accurate)             # <<<<<<<<<<<<<<
 *         write_message("Beginning post-processing of %s terms" % len(terms))
 *         task_update_progress("Post-processing %s terms" % len(terms))
 */
  __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_kp_task_get_option); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_2);
  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_3));
  __Pyx_INCREF(__pyx_kp_14);
  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_kp_14);
  __Pyx_GIVEREF(__pyx_kp_14);
  __pyx_t_1 = PyObject_Call(__pyx_2, ((PyObject *)__pyx_t_3), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  __pyx_t_3 = PyObject_RichCompare(__pyx_t_1, __pyx_kp_15, Py_EQ); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_7 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (__pyx_t_7) {

    /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":63
 *         return ""
 *     elif task_get_option("quick") == "yes": #not used -R option, fast calculation (not accurate)
 *         write_message("Beginning post-processing of %s terms" % len(terms))             # <<<<<<<<<<<<<<
 *         task_update_progress("Post-processing %s terms" % len(terms))
 *         #Locating all documents related to the modified/new/deleted terms, if fast update,
 */
    __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_write_message); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 63; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __pyx_t_8 = PyObject_Length(((PyObject *)__pyx_v_terms)); if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 63; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_3 = PyInt_FromSsize_t(__pyx_t_8); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 63; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_1 = PyNumber_Remainder(__pyx_kp_16, __pyx_t_3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 63; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 63; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_3));
    PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1);
    __Pyx_GIVEREF(__pyx_t_1);
    __pyx_t_1 = 0;
    __pyx_t_1 = PyObject_Call(__pyx_1, ((PyObject *)__pyx_t_3), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 63; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":64
 *     elif task_get_option("quick") == "yes": #not used -R option, fast calculation (not accurate)
 *         write_message("Beginning post-processing of %s terms" % len(terms))
 *         task_update_progress("Post-processing %s terms" % len(terms))             # <<<<<<<<<<<<<<
 *         #Locating all documents related to the modified/new/deleted terms, if fast update,
 *         #only take into account new/modified occurences
 */
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_kp_5); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 64; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_2);
    __pyx_t_8 = PyObject_Length(((PyObject *)__pyx_v_terms)); if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 64; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_8); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 64; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = PyNumber_Remainder(__pyx_kp_17, __pyx_t_1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 64; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 64; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_3);
    __Pyx_GIVEREF(__pyx_t_3);
    __pyx_t_3 = 0;
    __pyx_t_3 = PyObject_Call(__pyx_2, ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 64; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":67
 *         #Locating all documents related to the modified/new/deleted terms, if fast update,
 *         #only take into account new/modified occurences
 *         write_message("Phase 1: Finding records containing modified terms")             # <<<<<<<<<<<<<<
 *         i = 0
 * 
 */
    __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_write_message); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 67; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 67; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_3));
    __Pyx_INCREF(__pyx_kp_18);
    PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_kp_18);
    __Pyx_GIVEREF(__pyx_kp_18);
    __pyx_t_1 = PyObject_Call(__pyx_1, ((PyObject *)__pyx_t_3), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 67; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":68
 *         #only take into account new/modified occurences
 *         write_message("Phase 1: Finding records containing modified terms")
 *         i = 0             # <<<<<<<<<<<<<<
 * 
 *         while i < len(terms):
 */
    __pyx_v_i = 0;

    /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":70
 *         i = 0
 * 
 *         while i < len(terms):             # <<<<<<<<<<<<<<
 *             terms_docs = get_from_forward_index(terms, i, (i+5000), table)
 *             for (t, hitlist) in terms_docs:
 */
    while (1) {
      __pyx_t_8 = PyObject_Length(((PyObject *)__pyx_v_terms)); if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 70; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_t_7 = (__pyx_v_i < __pyx_t_8);
      if (!__pyx_t_7) break;

      /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":71
 * 
 *         while i < len(terms):
 *             terms_docs = get_from_forward_index(terms, i, (i+5000), table)             # <<<<<<<<<<<<<<
 *             for (t, hitlist) in terms_docs:
 *                 term_docs = deserialize_via_marshal(hitlist)
 */
      __pyx_t_1 = __pyx_f_22bibrank_word_indexer_c_get_from_forward_index(__pyx_v_terms, __pyx_v_i, (__pyx_v_i + 5000), __pyx_v_table, 0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 71; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      if (!(likely(PyTuple_CheckExact(__pyx_t_1)) || (__pyx_t_1) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected tuple, got %s", Py_TYPE(__pyx_t_1)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 71; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(((PyObject *)__pyx_v_terms_docs));
      __pyx_v_terms_docs = ((PyObject *)__pyx_t_1);
      __pyx_t_1 = 0;

      /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":72
 *         while i < len(terms):
 *             terms_docs = get_from_forward_index(terms, i, (i+5000), table)
 *             for (t, hitlist) in terms_docs:             # <<<<<<<<<<<<<<
 *                 term_docs = deserialize_via_marshal(hitlist)
 *                 if term_docs.has_key("Gi"):
 */
      if (likely(((PyObject *)__pyx_v_terms_docs) != Py_None)) {
        __pyx_t_8 = 0; __pyx_t_1 = ((PyObject *)__pyx_v_terms_docs); __Pyx_INCREF(__pyx_t_1);
      } else {
        PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable"); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      }
      for (;;) {
        if (__pyx_t_8 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_8); __Pyx_INCREF(__pyx_t_3); __pyx_t_8++;
        if (PyTuple_CheckExact(__pyx_t_3) && likely(PyTuple_GET_SIZE(__pyx_t_3) == 2)) {
          PyObject* tuple = __pyx_t_3;
          __pyx_1 = PyTuple_GET_ITEM(tuple, 0); __Pyx_INCREF(__pyx_1);
          if (!(likely(PyString_CheckExact(__pyx_1)) || (__pyx_1) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected str, got %s", Py_TYPE(__pyx_1)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __pyx_3 = PyTuple_GET_ITEM(tuple, 1); __Pyx_INCREF(__pyx_3);
          if (!(likely(PyString_CheckExact(__pyx_3)) || (__pyx_3) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected str, got %s", Py_TYPE(__pyx_3)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __Pyx_DECREF(((PyObject *)__pyx_v_t));
          __pyx_v_t = ((PyObject *)__pyx_1);
          __pyx_1 = 0;
          __Pyx_DECREF(((PyObject *)__pyx_v_hitlist));
          __pyx_v_hitlist = ((PyObject *)__pyx_3);
          __pyx_3 = 0;
        } else {
          __pyx_2 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_2);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_1 = __Pyx_UnpackItem(__pyx_2, 0); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_1);
          if (!(likely(PyString_CheckExact(__pyx_1)) || (__pyx_1) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected str, got %s", Py_TYPE(__pyx_1)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __pyx_3 = __Pyx_UnpackItem(__pyx_2, 1); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_3);
          if (!(likely(PyString_CheckExact(__pyx_3)) || (__pyx_3) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected str, got %s", Py_TYPE(__pyx_3)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          if (__Pyx_EndUnpack(__pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
          __Pyx_DECREF(((PyObject *)__pyx_v_t));
          __pyx_v_t = ((PyObject *)__pyx_1);
          __pyx_1 = 0;
          __Pyx_DECREF(((PyObject *)__pyx_v_hitlist));
          __pyx_v_hitlist = ((PyObject *)__pyx_3);
          __pyx_3 = 0;
        }

        /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":73
 *             terms_docs = get_from_forward_index(terms, i, (i+5000), table)
 *             for (t, hitlist) in terms_docs:
 *                 term_docs = deserialize_via_marshal(hitlist)             # <<<<<<<<<<<<<<
 *                 if term_docs.has_key("Gi"):
 *                     del term_docs["Gi"]
 */
        __pyx_t_3 = __pyx_f_22bibrank_word_indexer_c_deserialize_via_marshal(__pyx_v_hitlist); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
        if (!(likely(PyDict_CheckExact(__pyx_t_3)) || (__pyx_t_3) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected dict, got %s", Py_TYPE(__pyx_t_3)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(((PyObject *)__pyx_v_term_docs));
        __pyx_v_term_docs = ((PyObject *)__pyx_t_3);
        __pyx_t_3 = 0;

        /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":74
 *             for (t, hitlist) in terms_docs:
 *                 term_docs = deserialize_via_marshal(hitlist)
 *                 if term_docs.has_key("Gi"):             # <<<<<<<<<<<<<<
 *                     del term_docs["Gi"]
 *                 for (j, tf) in term_docs.iteritems():
 */
        __pyx_t_3 = PyObject_GetAttr(((PyObject *)__pyx_v_term_docs), __pyx_kp_has_key); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 74; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_9 = PyTuple_New(1); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 74; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(((PyObject *)__pyx_t_9));
        __Pyx_INCREF(__pyx_kp_19);
        PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_kp_19);
        __Pyx_GIVEREF(__pyx_kp_19);
        __pyx_t_10 = PyObject_Call(__pyx_t_3, ((PyObject *)__pyx_t_9), NULL); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 74; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_10);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(((PyObject *)__pyx_t_9)); __pyx_t_9 = 0;
        __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_10); if (unlikely(__pyx_t_7 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 74; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        if (__pyx_t_7) {

          /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":75
 *                 term_docs = deserialize_via_marshal(hitlist)
 *                 if term_docs.has_key("Gi"):
 *                     del term_docs["Gi"]             # <<<<<<<<<<<<<<
 *                 for (j, tf) in term_docs.iteritems():
 *                     if (task_get_option("quick") == "yes" and tf[1] == 0) or task_get_option("quick") == "no":
 */
          if (PyDict_DelItem(((PyObject *)__pyx_v_term_docs), __pyx_kp_20) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          goto __pyx_L11;
        }
        __pyx_L11:;

        /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":76
 *                 if term_docs.has_key("Gi"):
 *                     del term_docs["Gi"]
 *                 for (j, tf) in term_docs.iteritems():             # <<<<<<<<<<<<<<
 *                     if (task_get_option("quick") == "yes" and tf[1] == 0) or task_get_option("quick") == "no":
 *                         Nj[j] = 0
 */
        __Pyx_INCREF(((PyObject *)__pyx_v_term_docs));
        __Pyx_XDECREF(__pyx_t_10);
        __pyx_t_10 = ((PyObject *)__pyx_v_term_docs);
        __pyx_t_11 = 0;
        while (1) {
          if (!PyDict_Next(__pyx_t_10, (&__pyx_t_11), ((PyObject **)(&__pyx_t_12)), ((PyObject **)(&__pyx_t_13)))) break;
          __pyx_t_4 = __Pyx_PyInt_AsInt(((PyObject *)__pyx_t_12)); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 76; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __pyx_v_j = __pyx_t_4;
          if (!(likely(PyTuple_CheckExact(((PyObject *)__pyx_t_13))) || (((PyObject *)__pyx_t_13)) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected tuple, got %s", Py_TYPE(((PyObject *)__pyx_t_13))->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 76; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_INCREF(((PyObject *)((PyObject *)__pyx_t_13)));
          __Pyx_DECREF(((PyObject *)__pyx_v_tf));
          __pyx_v_tf = ((PyObject *)__pyx_t_13);

          /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":77
 *                     del term_docs["Gi"]
 *                 for (j, tf) in term_docs.iteritems():
 *                     if (task_get_option("quick") == "yes" and tf[1] == 0) or task_get_option("quick") == "no":             # <<<<<<<<<<<<<<
 *                         Nj[j] = 0
 *             write_message("Phase 1: ......processed %s/%s terms" % ((i+5000>len(terms) and len(terms) or (i+5000)), len(terms)))
 */
          __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_task_get_option); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 77; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_1);
          __pyx_t_9 = PyTuple_New(1); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 77; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(((PyObject *)__pyx_t_9));
          __Pyx_INCREF(__pyx_kp_21);
          PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_kp_21);
          __Pyx_GIVEREF(__pyx_kp_21);
          __pyx_t_3 = PyObject_Call(__pyx_1, ((PyObject *)__pyx_t_9), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 77; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
          __Pyx_DECREF(((PyObject *)__pyx_t_9)); __pyx_t_9 = 0;
          __pyx_t_9 = PyObject_RichCompare(__pyx_t_3, __pyx_kp_22, Py_EQ); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 77; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_9);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_9); if (unlikely(__pyx_t_7 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 77; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
          if (__pyx_t_7) {
            __pyx_2 = __Pyx_GetItemInt_Tuple(((PyObject *)__pyx_v_tf), 1, sizeof(long), PyInt_FromLong); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 77; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_2);
            __pyx_t_9 = PyObject_RichCompare(__pyx_2, __pyx_int_0, Py_EQ); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 77; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_9);
            __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
            __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_9); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 77; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
            __pyx_t_5 = __pyx_t_6;
          } else {
            __pyx_t_5 = __pyx_t_7;
          }
          if (!__pyx_t_5) {
            __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_kp_task_get_option); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 77; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_3);
            __pyx_t_9 = PyTuple_New(1); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 77; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(((PyObject *)__pyx_t_9));
            __Pyx_INCREF(__pyx_kp_23);
            PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_kp_23);
            __Pyx_GIVEREF(__pyx_kp_23);
            __pyx_t_3 = PyObject_Call(__pyx_3, ((PyObject *)__pyx_t_9), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 77; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_3);
            __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
            __Pyx_DECREF(((PyObject *)__pyx_t_9)); __pyx_t_9 = 0;
            __pyx_t_9 = PyObject_RichCompare(__pyx_t_3, __pyx_kp_24, Py_EQ); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 77; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_9);
            __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
            __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_9); if (unlikely(__pyx_t_7 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 77; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
            __pyx_t_6 = __pyx_t_7;
          } else {
            __pyx_t_6 = __pyx_t_5;
          }
          if (__pyx_t_6) {

            /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":78
 *                 for (j, tf) in term_docs.iteritems():
 *                     if (task_get_option("quick") == "yes" and tf[1] == 0) or task_get_option("quick") == "no":
 *                         Nj[j] = 0             # <<<<<<<<<<<<<<
 *             write_message("Phase 1: ......processed %s/%s terms" % ((i+5000>len(terms) and len(terms) or (i+5000)), len(terms)))
 *             task_update_progress("Post-processing phase 1: %s/%s terms" % ((i+5000>len(terms) and len(terms) or (i+5000)), len(terms)))
 */
            if (__Pyx_SetItemInt(((PyObject *)__pyx_v_Nj), __pyx_v_j, __pyx_int_0, sizeof(int), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 78; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            goto __pyx_L14;
          }
          __pyx_L14:;
        }
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      }
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

      /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":79
 *                     if (task_get_option("quick") == "yes" and tf[1] == 0) or task_get_option("quick") == "no":
 *                         Nj[j] = 0
 *             write_message("Phase 1: ......processed %s/%s terms" % ((i+5000>len(terms) and len(terms) or (i+5000)), len(terms)))             # <<<<<<<<<<<<<<
 *             task_update_progress("Post-processing phase 1: %s/%s terms" % ((i+5000>len(terms) and len(terms) or (i+5000)), len(terms)))
 *             i += 5000
 */
      __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_write_message); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 79; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_1);
      __pyx_t_8 = PyObject_Length(((PyObject *)__pyx_v_terms)); if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 79; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      if (((__pyx_v_i + 5000) > __pyx_t_8)) {
        __pyx_t_11 = PyObject_Length(((PyObject *)__pyx_v_terms)); if (unlikely(__pyx_t_11 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 79; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __pyx_t_6 = __pyx_t_11;
      } else {
        __pyx_t_6 = ((__pyx_v_i + 5000) > __pyx_t_8);
      }
      if (!__pyx_t_6) {
        __pyx_t_5 = (__pyx_v_i + 5000);
      } else {
        __pyx_t_5 = __pyx_t_6;
      }
      __pyx_t_1 = __Pyx_PyBool_FromLong(__pyx_t_5); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 79; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_8 = PyObject_Length(((PyObject *)__pyx_v_terms)); if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 79; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_t_10 = PyInt_FromSsize_t(__pyx_t_8); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 79; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_10);
      __pyx_t_9 = PyTuple_New(2); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 79; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(((PyObject *)__pyx_t_9));
      PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_1);
      __Pyx_GIVEREF(__pyx_t_1);
      PyTuple_SET_ITEM(__pyx_t_9, 1, __pyx_t_10);
      __Pyx_GIVEREF(__pyx_t_10);
      __pyx_t_1 = 0;
      __pyx_t_10 = 0;
      __pyx_t_10 = PyNumber_Remainder(__pyx_kp_25, ((PyObject *)__pyx_t_9)); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 79; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_DECREF(((PyObject *)__pyx_t_9)); __pyx_t_9 = 0;
      __pyx_t_9 = PyTuple_New(1); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 79; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(((PyObject *)__pyx_t_9));
      PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_10);
      __Pyx_GIVEREF(__pyx_t_10);
      __pyx_t_10 = 0;
      __pyx_t_10 = PyObject_Call(__pyx_1, ((PyObject *)__pyx_t_9), NULL); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 79; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
      __Pyx_DECREF(((PyObject *)__pyx_t_9)); __pyx_t_9 = 0;
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

      /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":80
 *                         Nj[j] = 0
 *             write_message("Phase 1: ......processed %s/%s terms" % ((i+5000>len(terms) and len(terms) or (i+5000)), len(terms)))
 *             task_update_progress("Post-processing phase 1: %s/%s terms" % ((i+5000>len(terms) and len(terms) or (i+5000)), len(terms)))             # <<<<<<<<<<<<<<
 *             i += 5000
 *             task_sleep_now_if_required()
 */
      __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_kp_5); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 80; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_2);
      __pyx_t_8 = PyObject_Length(((PyObject *)__pyx_v_terms)); if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 80; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      if (((__pyx_v_i + 5000) > __pyx_t_8)) {
        __pyx_t_11 = PyObject_Length(((PyObject *)__pyx_v_terms)); if (unlikely(__pyx_t_11 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 80; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __pyx_t_5 = __pyx_t_11;
      } else {
        __pyx_t_5 = ((__pyx_v_i + 5000) > __pyx_t_8);
      }
      if (!__pyx_t_5) {
        __pyx_t_6 = (__pyx_v_i + 5000);
      } else {
        __pyx_t_6 = __pyx_t_5;
      }
      __pyx_t_10 = __Pyx_PyBool_FromLong(__pyx_t_6); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 80; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_10);
      __pyx_t_8 = PyObject_Length(((PyObject *)__pyx_v_terms)); if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 80; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_t_9 = PyInt_FromSsize_t(__pyx_t_8); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 80; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_9);
      __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 80; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(((PyObject *)__pyx_t_1));
      PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_10);
      __Pyx_GIVEREF(__pyx_t_10);
      PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_9);
      __Pyx_GIVEREF(__pyx_t_9);
      __pyx_t_10 = 0;
      __pyx_t_9 = 0;
      __pyx_t_9 = PyNumber_Remainder(__pyx_kp_26, ((PyObject *)__pyx_t_1)); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 80; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_9);
      __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
      __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 80; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(((PyObject *)__pyx_t_1));
      PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_9);
      __Pyx_GIVEREF(__pyx_t_9);
      __pyx_t_9 = 0;
      __pyx_t_9 = PyObject_Call(__pyx_2, ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 80; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_9);
      __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
      __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;

      /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":81
 *             write_message("Phase 1: ......processed %s/%s terms" % ((i+5000>len(terms) and len(terms) or (i+5000)), len(terms)))
 *             task_update_progress("Post-processing phase 1: %s/%s terms" % ((i+5000>len(terms) and len(terms) or (i+5000)), len(terms)))
 *             i += 5000             # <<<<<<<<<<<<<<
 *             task_sleep_now_if_required()
 *         write_message("Phase 1: Finished finding records containing modified terms")
 */
      __pyx_v_i += 5000;

      /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":82
 *             task_update_progress("Post-processing phase 1: %s/%s terms" % ((i+5000>len(terms) and len(terms) or (i+5000)), len(terms)))
 *             i += 5000
 *             task_sleep_now_if_required()             # <<<<<<<<<<<<<<
 *         write_message("Phase 1: Finished finding records containing modified terms")
 *         task_sleep_now_if_required()
 */
      __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_kp_6); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 82; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_3);
      __pyx_t_9 = PyObject_Call(__pyx_3, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 82; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_9);
      __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    }

    /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":83
 *             i += 5000
 *             task_sleep_now_if_required()
 *         write_message("Phase 1: Finished finding records containing modified terms")             # <<<<<<<<<<<<<<
 *         task_sleep_now_if_required()
 *         #Find all terms in the records found in last phase
 */
    __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_write_message); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __pyx_t_9 = PyTuple_New(1); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_9));
    __Pyx_INCREF(__pyx_kp_27);
    PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_kp_27);
    __Pyx_GIVEREF(__pyx_kp_27);
    __pyx_t_1 = PyObject_Call(__pyx_1, ((PyObject *)__pyx_t_9), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_9)); __pyx_t_9 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":84
 *             task_sleep_now_if_required()
 *         write_message("Phase 1: Finished finding records containing modified terms")
 *         task_sleep_now_if_required()             # <<<<<<<<<<<<<<
 *         #Find all terms in the records found in last phase
 *         write_message("Phase 2: Finding all terms in affected records")
 */
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_kp_6); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_2);
    __pyx_t_1 = PyObject_Call(__pyx_2, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":86
 *         task_sleep_now_if_required()
 *         #Find all terms in the records found in last phase
 *         write_message("Phase 2: Finding all terms in affected records")             # <<<<<<<<<<<<<<
 *         records = Nj.keys()
 *         i = 0
 */
    __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_kp_write_message); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_3);
    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    __Pyx_INCREF(__pyx_kp_28);
    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_28);
    __Pyx_GIVEREF(__pyx_kp_28);
    __pyx_t_9 = PyObject_Call(__pyx_3, ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;

    /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":87
 *         #Find all terms in the records found in last phase
 *         write_message("Phase 2: Finding all terms in affected records")
 *         records = Nj.keys()             # <<<<<<<<<<<<<<
 *         i = 0
 *         while i < len(records):
 */
    __pyx_t_9 = PyDict_Keys(((PyObject *)__pyx_v_Nj)); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_9);
    if (!(likely(PyList_CheckExact(__pyx_t_9)) || (__pyx_t_9) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected list, got %s", Py_TYPE(__pyx_t_9)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(((PyObject *)__pyx_v_records));
    __pyx_v_records = ((PyObject *)__pyx_t_9);
    __pyx_t_9 = 0;

    /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":88
 *         write_message("Phase 2: Finding all terms in affected records")
 *         records = Nj.keys()
 *         i = 0             # <<<<<<<<<<<<<<
 *         while i < len(records):
 *             docs_terms = get_from_reverse_index(records, i, (i + 5000), table)
 */
    __pyx_v_i = 0;

    /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":89
 *         records = Nj.keys()
 *         i = 0
 *         while i < len(records):             # <<<<<<<<<<<<<<
 *             docs_terms = get_from_reverse_index(records, i, (i + 5000), table)
 *             for (j, termlist) in docs_terms:
 */
    while (1) {
      __pyx_t_8 = PyObject_Length(((PyObject *)__pyx_v_records)); if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 89; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_t_6 = (__pyx_v_i < __pyx_t_8);
      if (!__pyx_t_6) break;

      /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":90
 *         i = 0
 *         while i < len(records):
 *             docs_terms = get_from_reverse_index(records, i, (i + 5000), table)             # <<<<<<<<<<<<<<
 *             for (j, termlist) in docs_terms:
 *                 doc_terms = deserialize_via_marshal(termlist)
 */
      __pyx_t_9 = __pyx_f_22bibrank_word_indexer_c_get_from_reverse_index(__pyx_v_records, __pyx_v_i, (__pyx_v_i + 5000), __pyx_v_table, 0); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 90; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_9);
      if (!(likely(PyTuple_CheckExact(__pyx_t_9)) || (__pyx_t_9) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected tuple, got %s", Py_TYPE(__pyx_t_9)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 90; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(((PyObject *)__pyx_v_docs_terms));
      __pyx_v_docs_terms = ((PyObject *)__pyx_t_9);
      __pyx_t_9 = 0;

      /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":91
 *         while i < len(records):
 *             docs_terms = get_from_reverse_index(records, i, (i + 5000), table)
 *             for (j, termlist) in docs_terms:             # <<<<<<<<<<<<<<
 *                 doc_terms = deserialize_via_marshal(termlist)
 *                 for (t, tf) in doc_terms.iteritems():
 */
      if (likely(((PyObject *)__pyx_v_docs_terms) != Py_None)) {
        __pyx_t_8 = 0; __pyx_t_9 = ((PyObject *)__pyx_v_docs_terms); __Pyx_INCREF(__pyx_t_9);
      } else {
        PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable"); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 91; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      }
      for (;;) {
        if (__pyx_t_8 >= PyTuple_GET_SIZE(__pyx_t_9)) break;
        __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_9, __pyx_t_8); __Pyx_INCREF(__pyx_t_1); __pyx_t_8++;
        if (PyTuple_CheckExact(__pyx_t_1) && likely(PyTuple_GET_SIZE(__pyx_t_1) == 2)) {
          PyObject* tuple = __pyx_t_1;
          __pyx_2 = PyTuple_GET_ITEM(tuple, 0); __Pyx_INCREF(__pyx_2);
          __pyx_t_4 = __Pyx_PyInt_AsInt(__pyx_2); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 91; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
          __pyx_3 = PyTuple_GET_ITEM(tuple, 1); __Pyx_INCREF(__pyx_3);
          if (!(likely(PyString_CheckExact(__pyx_3)) || (__pyx_3) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected str, got %s", Py_TYPE(__pyx_3)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 91; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_v_j = __pyx_t_4;
          __Pyx_DECREF(((PyObject *)__pyx_v_termlist));
          __pyx_v_termlist = ((PyObject *)__pyx_3);
          __pyx_3 = 0;
        } else {
          __pyx_1 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 91; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_1);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_2 = __Pyx_UnpackItem(__pyx_1, 0); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 91; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_2);
          __pyx_t_4 = __Pyx_PyInt_AsInt(__pyx_2); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 91; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
          __pyx_3 = __Pyx_UnpackItem(__pyx_1, 1); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 91; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_3);
          if (!(likely(PyString_CheckExact(__pyx_3)) || (__pyx_3) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected str, got %s", Py_TYPE(__pyx_3)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 91; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          if (__Pyx_EndUnpack(__pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 91; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
          __pyx_v_j = __pyx_t_4;
          __Pyx_DECREF(((PyObject *)__pyx_v_termlist));
          __pyx_v_termlist = ((PyObject *)__pyx_3);
          __pyx_3 = 0;
        }

        /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":92
 *             docs_terms = get_from_reverse_index(records, i, (i + 5000), table)
 *             for (j, termlist) in docs_terms:
 *                 doc_terms = deserialize_via_marshal(termlist)             # <<<<<<<<<<<<<<
 *                 for (t, tf) in doc_terms.iteritems():
 *                     Gi[t] = 0
 */
        __pyx_t_1 = __pyx_f_22bibrank_word_indexer_c_deserialize_via_marshal(__pyx_v_termlist); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 92; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_v_doc_terms);
        __pyx_v_doc_terms = __pyx_t_1;
        __pyx_t_1 = 0;

        /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":93
 *             for (j, termlist) in docs_terms:
 *                 doc_terms = deserialize_via_marshal(termlist)
 *                 for (t, tf) in doc_terms.iteritems():             # <<<<<<<<<<<<<<
 *                     Gi[t] = 0
 *             write_message("Phase 2: ......processed %s/%s records " % ((i+5000>len(records) and len(records) or (i+5000)), len(records)))
 */
        __pyx_t_1 = PyObject_GetAttr(__pyx_v_doc_terms, __pyx_kp_iteritems); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 93; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_10 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 93; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_10);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        if (PyList_CheckExact(__pyx_t_10) || PyTuple_CheckExact(__pyx_t_10)) {
          __pyx_t_11 = 0; __pyx_t_1 = __pyx_t_10; __Pyx_INCREF(__pyx_t_1);
        } else {
          __pyx_t_11 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_t_10); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 93; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_1);
        }
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        for (;;) {
          if (likely(PyList_CheckExact(__pyx_t_1))) {
            if (__pyx_t_11 >= PyList_GET_SIZE(__pyx_t_1)) break;
            __pyx_t_10 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_11); __Pyx_INCREF(__pyx_t_10); __pyx_t_11++;
          } else if (likely(PyTuple_CheckExact(__pyx_t_1))) {
            if (__pyx_t_11 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
            __pyx_t_10 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_11); __Pyx_INCREF(__pyx_t_10); __pyx_t_11++;
          } else {
            __pyx_t_10 = PyIter_Next(__pyx_t_1);
            if (!__pyx_t_10) {
              if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 93; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
              break;
            }
            __Pyx_GOTREF(__pyx_t_10);
          }
          if (PyTuple_CheckExact(__pyx_t_10) && likely(PyTuple_GET_SIZE(__pyx_t_10) == 2)) {
            PyObject* tuple = __pyx_t_10;
            __pyx_1 = PyTuple_GET_ITEM(tuple, 0); __Pyx_INCREF(__pyx_1);
            if (!(likely(PyString_CheckExact(__pyx_1)) || (__pyx_1) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected str, got %s", Py_TYPE(__pyx_1)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 93; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __pyx_3 = PyTuple_GET_ITEM(tuple, 1); __Pyx_INCREF(__pyx_3);
            if (!(likely(PyTuple_CheckExact(__pyx_3)) || (__pyx_3) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected tuple, got %s", Py_TYPE(__pyx_3)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 93; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
            __Pyx_DECREF(((PyObject *)__pyx_v_t));
            __pyx_v_t = ((PyObject *)__pyx_1);
            __pyx_1 = 0;
            __Pyx_DECREF(((PyObject *)__pyx_v_tf));
            __pyx_v_tf = ((PyObject *)__pyx_3);
            __pyx_3 = 0;
          } else {
            __pyx_2 = PyObject_GetIter(__pyx_t_10); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 93; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_2);
            __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
            __pyx_1 = __Pyx_UnpackItem(__pyx_2, 0); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 93; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_1);
            if (!(likely(PyString_CheckExact(__pyx_1)) || (__pyx_1) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected str, got %s", Py_TYPE(__pyx_1)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 93; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __pyx_3 = __Pyx_UnpackItem(__pyx_2, 1); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 93; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_3);
            if (!(likely(PyTuple_CheckExact(__pyx_3)) || (__pyx_3) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected tuple, got %s", Py_TYPE(__pyx_3)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 93; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            if (__Pyx_EndUnpack(__pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 93; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
            __Pyx_DECREF(((PyObject *)__pyx_v_t));
            __pyx_v_t = ((PyObject *)__pyx_1);
            __pyx_1 = 0;
            __Pyx_DECREF(((PyObject *)__pyx_v_tf));
            __pyx_v_tf = ((PyObject *)__pyx_3);
            __pyx_3 = 0;
          }

          /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":94
 *                 doc_terms = deserialize_via_marshal(termlist)
 *                 for (t, tf) in doc_terms.iteritems():
 *                     Gi[t] = 0             # <<<<<<<<<<<<<<
 *             write_message("Phase 2: ......processed %s/%s records " % ((i+5000>len(records) and len(records) or (i+5000)), len(records)))
 *             task_update_progress("Post-processing phase 2: %s/%s records" % ((i+5000>len(records) and len(records) or (i+5000)), len(records)))
 */
          if (PyDict_SetItem(((PyObject *)__pyx_v_Gi), ((PyObject *)__pyx_v_t), __pyx_int_0) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 94; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      }
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;

      /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":95
 *                 for (t, tf) in doc_terms.iteritems():
 *                     Gi[t] = 0
 *             write_message("Phase 2: ......processed %s/%s records " % ((i+5000>len(records) and len(records) or (i+5000)), len(records)))             # <<<<<<<<<<<<<<
 *             task_update_progress("Post-processing phase 2: %s/%s records" % ((i+5000>len(records) and len(records) or (i+5000)), len(records)))
 * 
 */
      __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_kp_write_message); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_2);
      __pyx_t_8 = PyObject_Length(((PyObject *)__pyx_v_records)); if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      if (((__pyx_v_i + 5000) > __pyx_t_8)) {
        __pyx_t_11 = PyObject_Length(((PyObject *)__pyx_v_records)); if (unlikely(__pyx_t_11 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __pyx_t_6 = __pyx_t_11;
      } else {
        __pyx_t_6 = ((__pyx_v_i + 5000) > __pyx_t_8);
      }
      if (!__pyx_t_6) {
        __pyx_t_5 = (__pyx_v_i + 5000);
      } else {
        __pyx_t_5 = __pyx_t_6;
      }
      __pyx_t_9 = __Pyx_PyBool_FromLong(__pyx_t_5); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_9);
      __pyx_t_8 = PyObject_Length(((PyObject *)__pyx_v_records)); if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_8); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_10 = PyTuple_New(2); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(((PyObject *)__pyx_t_10));
      PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_9);
      __Pyx_GIVEREF(__pyx_t_9);
      PyTuple_SET_ITEM(__pyx_t_10, 1, __pyx_t_1);
      __Pyx_GIVEREF(__pyx_t_1);
      __pyx_t_9 = 0;
      __pyx_t_1 = 0;
      __pyx_t_1 = PyNumber_Remainder(__pyx_kp_29, ((PyObject *)__pyx_t_10)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(((PyObject *)__pyx_t_10)); __pyx_t_10 = 0;
      __pyx_t_10 = PyTuple_New(1); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(((PyObject *)__pyx_t_10));
      PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_1);
      __Pyx_GIVEREF(__pyx_t_1);
      __pyx_t_1 = 0;
      __pyx_t_1 = PyObject_Call(__pyx_2, ((PyObject *)__pyx_t_10), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
      __Pyx_DECREF(((PyObject *)__pyx_t_10)); __pyx_t_10 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

      /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":96
 *                     Gi[t] = 0
 *             write_message("Phase 2: ......processed %s/%s records " % ((i+5000>len(records) and len(records) or (i+5000)), len(records)))
 *             task_update_progress("Post-processing phase 2: %s/%s records" % ((i+5000>len(records) and len(records) or (i+5000)), len(records)))             # <<<<<<<<<<<<<<
 * 
 *             i += 5000
 */
      __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_5); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 96; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_1);
      __pyx_t_8 = PyObject_Length(((PyObject *)__pyx_v_records)); if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 96; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      if (((__pyx_v_i + 5000) > __pyx_t_8)) {
        __pyx_t_11 = PyObject_Length(((PyObject *)__pyx_v_records)); if (unlikely(__pyx_t_11 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 96; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __pyx_t_5 = __pyx_t_11;
      } else {
        __pyx_t_5 = ((__pyx_v_i + 5000) > __pyx_t_8);
      }
      if (!__pyx_t_5) {
        __pyx_t_6 = (__pyx_v_i + 5000);
      } else {
        __pyx_t_6 = __pyx_t_5;
      }
      __pyx_t_1 = __Pyx_PyBool_FromLong(__pyx_t_6); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 96; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_8 = PyObject_Length(((PyObject *)__pyx_v_records)); if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 96; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_t_10 = PyInt_FromSsize_t(__pyx_t_8); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 96; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_10);
      __pyx_t_9 = PyTuple_New(2); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 96; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(((PyObject *)__pyx_t_9));
      PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_1);
      __Pyx_GIVEREF(__pyx_t_1);
      PyTuple_SET_ITEM(__pyx_t_9, 1, __pyx_t_10);
      __Pyx_GIVEREF(__pyx_t_10);
      __pyx_t_1 = 0;
      __pyx_t_10 = 0;
      __pyx_t_10 = PyNumber_Remainder(__pyx_kp_30, ((PyObject *)__pyx_t_9)); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 96; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_DECREF(((PyObject *)__pyx_t_9)); __pyx_t_9 = 0;
      __pyx_t_9 = PyTuple_New(1); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 96; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(((PyObject *)__pyx_t_9));
      PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_10);
      __Pyx_GIVEREF(__pyx_t_10);
      __pyx_t_10 = 0;
      __pyx_t_10 = PyObject_Call(__pyx_1, ((PyObject *)__pyx_t_9), NULL); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 96; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
      __Pyx_DECREF(((PyObject *)__pyx_t_9)); __pyx_t_9 = 0;
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

      /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":98
 *             task_update_progress("Post-processing phase 2: %s/%s records" % ((i+5000>len(records) and len(records) or (i+5000)), len(records)))
 * 
 *             i += 5000             # <<<<<<<<<<<<<<
 *             task_sleep_now_if_required()
 *         write_message("Phase 2: Finished finding all terms in affected records")
 */
      __pyx_v_i += 5000;

      /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":99
 * 
 *             i += 5000
 *             task_sleep_now_if_required()             # <<<<<<<<<<<<<<
 *         write_message("Phase 2: Finished finding all terms in affected records")
 * 
 */
      __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_kp_6); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 99; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_3);
      __pyx_t_10 = PyObject_Call(__pyx_3, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 99; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
    }

    /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":100
 *             i += 5000
 *             task_sleep_now_if_required()
 *         write_message("Phase 2: Finished finding all terms in affected records")             # <<<<<<<<<<<<<<
 * 
 *     else: #recalculate
 */
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_kp_write_message); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 100; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_2);
    __pyx_t_10 = PyTuple_New(1); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 100; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_10));
    __Pyx_INCREF(__pyx_kp_31);
    PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_kp_31);
    __Pyx_GIVEREF(__pyx_kp_31);
    __pyx_t_9 = PyObject_Call(__pyx_2, ((PyObject *)__pyx_t_10), NULL); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 100; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_10)); __pyx_t_10 = 0;
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    goto __pyx_L6;
  }
  /*else*/ {

    /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":103
 * 
 *     else: #recalculate
 *         max_id = run_sql("SELECT MAX(id) FROM %s" % table)[0][0]             # <<<<<<<<<<<<<<
 *         write_message("Beginning recalculation of %s terms" % max_id)
 * 
 */
    __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_run_sql); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __pyx_t_9 = PyNumber_Remainder(__pyx_kp_32, ((PyObject *)__pyx_v_table)); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_9);
    __pyx_t_10 = PyTuple_New(1); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_10));
    PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_9);
    __Pyx_GIVEREF(__pyx_t_9);
    __pyx_t_9 = 0;
    __pyx_t_9 = PyObject_Call(__pyx_1, ((PyObject *)__pyx_t_10), NULL); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_10)); __pyx_t_10 = 0;
    __pyx_3 = __Pyx_GetItemInt(__pyx_t_9, 0, sizeof(long), PyInt_FromLong); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_3);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __pyx_2 = __Pyx_GetItemInt(__pyx_3, 0, sizeof(long), PyInt_FromLong); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_2);
    __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_t_4 = __Pyx_PyInt_AsInt(__pyx_2); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_v_max_id = __pyx_t_4;

    /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":104
 *     else: #recalculate
 *         max_id = run_sql("SELECT MAX(id) FROM %s" % table)[0][0]
 *         write_message("Beginning recalculation of %s terms" % max_id)             # <<<<<<<<<<<<<<
 * 
 *         terms = []
 */
    __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_write_message); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 104; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __pyx_t_9 = PyInt_FromLong(__pyx_v_max_id); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 104; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_9);
    __pyx_t_10 = PyNumber_Remainder(__pyx_kp_33, __pyx_t_9); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 104; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_10);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __pyx_t_9 = PyTuple_New(1); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 104; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_9));
    PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_10);
    __Pyx_GIVEREF(__pyx_t_10);
    __pyx_t_10 = 0;
    __pyx_t_10 = PyObject_Call(__pyx_1, ((PyObject *)__pyx_t_9), NULL); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 104; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_10);
    __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_9)); __pyx_t_9 = 0;
    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

    /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":106
 *         write_message("Beginning recalculation of %s terms" % max_id)
 * 
 *         terms = []             # <<<<<<<<<<<<<<
 *         i = 0
 *         while i < max_id:
 */
    __pyx_t_10 = PyList_New(0); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 106; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_10));
    __Pyx_DECREF(((PyObject *)__pyx_v_terms));
    __pyx_v_terms = __pyx_t_10;
    __pyx_t_10 = 0;

    /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":107
 * 
 *         terms = []
 *         i = 0             # <<<<<<<<<<<<<<
 *         while i < max_id:
 *             terms_docs = get_from_forward_index_with_id(i, (i+5000), table)
 */
    __pyx_v_i = 0;

    /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":108
 *         terms = []
 *         i = 0
 *         while i < max_id:             # <<<<<<<<<<<<<<
 *             terms_docs = get_from_forward_index_with_id(i, (i+5000), table)
 *             for (t, hitlist) in terms_docs:
 */
    while (1) {
      __pyx_t_6 = (__pyx_v_i < __pyx_v_max_id);
      if (!__pyx_t_6) break;

      /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":109
 *         i = 0
 *         while i < max_id:
 *             terms_docs = get_from_forward_index_with_id(i, (i+5000), table)             # <<<<<<<<<<<<<<
 *             for (t, hitlist) in terms_docs:
 *                 Gi[t] = 0
 */
      __pyx_t_10 = __pyx_f_22bibrank_word_indexer_c_get_from_forward_index_with_id(__pyx_v_i, (__pyx_v_i + 5000), __pyx_v_table, 0); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 109; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_10);
      if (!(likely(PyTuple_CheckExact(__pyx_t_10)) || (__pyx_t_10) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected tuple, got %s", Py_TYPE(__pyx_t_10)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 109; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(((PyObject *)__pyx_v_terms_docs));
      __pyx_v_terms_docs = ((PyObject *)__pyx_t_10);
      __pyx_t_10 = 0;

      /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":110
 *         while i < max_id:
 *             terms_docs = get_from_forward_index_with_id(i, (i+5000), table)
 *             for (t, hitlist) in terms_docs:             # <<<<<<<<<<<<<<
 *                 Gi[t] = 0
 *                 term_docs = deserialize_via_marshal(hitlist)
 */
      if (likely(((PyObject *)__pyx_v_terms_docs) != Py_None)) {
        __pyx_t_8 = 0; __pyx_t_10 = ((PyObject *)__pyx_v_terms_docs); __Pyx_INCREF(__pyx_t_10);
      } else {
        PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable"); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 110; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      }
      for (;;) {
        if (__pyx_t_8 >= PyTuple_GET_SIZE(__pyx_t_10)) break;
        __pyx_t_9 = PyTuple_GET_ITEM(__pyx_t_10, __pyx_t_8); __Pyx_INCREF(__pyx_t_9); __pyx_t_8++;
        if (PyTuple_CheckExact(__pyx_t_9) && likely(PyTuple_GET_SIZE(__pyx_t_9) == 2)) {
          PyObject* tuple = __pyx_t_9;
          __pyx_2 = PyTuple_GET_ITEM(tuple, 0); __Pyx_INCREF(__pyx_2);
          if (!(likely(PyString_CheckExact(__pyx_2)) || (__pyx_2) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected str, got %s", Py_TYPE(__pyx_2)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 110; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __pyx_1 = PyTuple_GET_ITEM(tuple, 1); __Pyx_INCREF(__pyx_1);
          if (!(likely(PyString_CheckExact(__pyx_1)) || (__pyx_1) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected str, got %s", Py_TYPE(__pyx_1)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 110; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
          __Pyx_DECREF(((PyObject *)__pyx_v_t));
          __pyx_v_t = ((PyObject *)__pyx_2);
          __pyx_2 = 0;
          __Pyx_DECREF(((PyObject *)__pyx_v_hitlist));
          __pyx_v_hitlist = ((PyObject *)__pyx_1);
          __pyx_1 = 0;
        } else {
          __pyx_3 = PyObject_GetIter(__pyx_t_9); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 110; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_3);
          __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
          __pyx_2 = __Pyx_UnpackItem(__pyx_3, 0); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 110; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_2);
          if (!(likely(PyString_CheckExact(__pyx_2)) || (__pyx_2) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected str, got %s", Py_TYPE(__pyx_2)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 110; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __pyx_1 = __Pyx_UnpackItem(__pyx_3, 1); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 110; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_1);
          if (!(likely(PyString_CheckExact(__pyx_1)) || (__pyx_1) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected str, got %s", Py_TYPE(__pyx_1)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 110; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          if (__Pyx_EndUnpack(__pyx_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 110; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
          __Pyx_DECREF(((PyObject *)__pyx_v_t));
          __pyx_v_t = ((PyObject *)__pyx_2);
          __pyx_2 = 0;
          __Pyx_DECREF(((PyObject *)__pyx_v_hitlist));
          __pyx_v_hitlist = ((PyObject *)__pyx_1);
          __pyx_1 = 0;
        }

        /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":111
 *             terms_docs = get_from_forward_index_with_id(i, (i+5000), table)
 *             for (t, hitlist) in terms_docs:
 *                 Gi[t] = 0             # <<<<<<<<<<<<<<
 *                 term_docs = deserialize_via_marshal(hitlist)
 *                 if term_docs.has_key("Gi"):
 */
        if (PyDict_SetItem(((PyObject *)__pyx_v_Gi), ((PyObject *)__pyx_v_t), __pyx_int_0) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 111; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

        /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":112
 *             for (t, hitlist) in terms_docs:
 *                 Gi[t] = 0
 *                 term_docs = deserialize_via_marshal(hitlist)             # <<<<<<<<<<<<<<
 *                 if term_docs.has_key("Gi"):
 *                     del term_docs["Gi"]
 */
        __pyx_t_9 = __pyx_f_22bibrank_word_indexer_c_deserialize_via_marshal(__pyx_v_hitlist); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 112; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_9);
        if (!(likely(PyDict_CheckExact(__pyx_t_9)) || (__pyx_t_9) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected dict, got %s", Py_TYPE(__pyx_t_9)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 112; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(((PyObject *)__pyx_v_term_docs));
        __pyx_v_term_docs = ((PyObject *)__pyx_t_9);
        __pyx_t_9 = 0;

        /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":113
 *                 Gi[t] = 0
 *                 term_docs = deserialize_via_marshal(hitlist)
 *                 if term_docs.has_key("Gi"):             # <<<<<<<<<<<<<<
 *                     del term_docs["Gi"]
 *                 for (j, tf) in term_docs.iteritems():
 */
        __pyx_t_9 = PyObject_GetAttr(((PyObject *)__pyx_v_term_docs), __pyx_kp_has_key); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 113; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_9);
        __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 113; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(((PyObject *)__pyx_t_1));
        __Pyx_INCREF(__pyx_kp_34);
        PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_34);
        __Pyx_GIVEREF(__pyx_kp_34);
        __pyx_t_3 = PyObject_Call(__pyx_t_9, ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 113; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
        __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
        __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 113; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        if (__pyx_t_6) {

          /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":114
 *                 term_docs = deserialize_via_marshal(hitlist)
 *                 if term_docs.has_key("Gi"):
 *                     del term_docs["Gi"]             # <<<<<<<<<<<<<<
 *                 for (j, tf) in term_docs.iteritems():
 *                     Nj[j] = 0
 */
          if (PyDict_DelItem(((PyObject *)__pyx_v_term_docs), __pyx_kp_35) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 114; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          goto __pyx_L25;
        }
        __pyx_L25:;

        /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":115
 *                 if term_docs.has_key("Gi"):
 *                     del term_docs["Gi"]
 *                 for (j, tf) in term_docs.iteritems():             # <<<<<<<<<<<<<<
 *                     Nj[j] = 0
 *             write_message("Phase 1: ......processed %s/%s terms" % ((i+5000)>max_id and max_id or (i+5000), max_id))
 */
        __Pyx_INCREF(((PyObject *)__pyx_v_term_docs));
        __Pyx_XDECREF(__pyx_t_3);
        __pyx_t_3 = ((PyObject *)__pyx_v_term_docs);
        __pyx_t_11 = 0;
        while (1) {
          if (!PyDict_Next(__pyx_t_3, (&__pyx_t_11), ((PyObject **)(&__pyx_t_13)), ((PyObject **)(&__pyx_t_12)))) break;
          __pyx_t_4 = __Pyx_PyInt_AsInt(((PyObject *)__pyx_t_13)); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 115; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __pyx_v_j = __pyx_t_4;
          if (!(likely(PyTuple_CheckExact(((PyObject *)__pyx_t_12))) || (((PyObject *)__pyx_t_12)) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected tuple, got %s", Py_TYPE(((PyObject *)__pyx_t_12))->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 115; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_INCREF(((PyObject *)((PyObject *)__pyx_t_12)));
          __Pyx_DECREF(((PyObject *)__pyx_v_tf));
          __pyx_v_tf = ((PyObject *)__pyx_t_12);

          /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":116
 *                     del term_docs["Gi"]
 *                 for (j, tf) in term_docs.iteritems():
 *                     Nj[j] = 0             # <<<<<<<<<<<<<<
 *             write_message("Phase 1: ......processed %s/%s terms" % ((i+5000)>max_id and max_id or (i+5000), max_id))
 *             task_update_progress("Post-processing phase 1: %s/%s terms" % ((i+5000)>max_id and max_id or (i+5000), max_id))
 */
          if (__Pyx_SetItemInt(((PyObject *)__pyx_v_Nj), __pyx_v_j, __pyx_int_0, sizeof(int), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 116; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      }
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

      /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":117
 *                 for (j, tf) in term_docs.iteritems():
 *                     Nj[j] = 0
 *             write_message("Phase 1: ......processed %s/%s terms" % ((i+5000)>max_id and max_id or (i+5000), max_id))             # <<<<<<<<<<<<<<
 *             task_update_progress("Post-processing phase 1: %s/%s terms" % ((i+5000)>max_id and max_id or (i+5000), max_id))
 *             i += 5000
 */
      __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_kp_write_message); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 117; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_2);
      if (((__pyx_v_i + 5000) > __pyx_v_max_id)) {
        __pyx_t_6 = __pyx_v_max_id;
      } else {
        __pyx_t_6 = ((__pyx_v_i + 5000) > __pyx_v_max_id);
      }
      if (!__pyx_t_6) {
        __pyx_t_5 = (__pyx_v_i + 5000);
      } else {
        __pyx_t_5 = __pyx_t_6;
      }
      __pyx_t_10 = __Pyx_PyBool_FromLong(__pyx_t_5); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 117; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_10);
      __pyx_t_3 = PyInt_FromLong(__pyx_v_max_id); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 117; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 117; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(((PyObject *)__pyx_t_1));
      PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_10);
      __Pyx_GIVEREF(__pyx_t_10);
      PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_3);
      __Pyx_GIVEREF(__pyx_t_3);
      __pyx_t_10 = 0;
      __pyx_t_3 = 0;
      __pyx_t_3 = PyNumber_Remainder(__pyx_kp_36, ((PyObject *)__pyx_t_1)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 117; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
      __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 117; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(((PyObject *)__pyx_t_1));
      PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_3);
      __Pyx_GIVEREF(__pyx_t_3);
      __pyx_t_3 = 0;
      __pyx_t_3 = PyObject_Call(__pyx_2, ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 117; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
      __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

      /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":118
 *                     Nj[j] = 0
 *             write_message("Phase 1: ......processed %s/%s terms" % ((i+5000)>max_id and max_id or (i+5000), max_id))
 *             task_update_progress("Post-processing phase 1: %s/%s terms" % ((i+5000)>max_id and max_id or (i+5000), max_id))             # <<<<<<<<<<<<<<
 *             i += 5000
 *             task_sleep_now_if_required()
 */
      __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_kp_5); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 118; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_3);
      if (((__pyx_v_i + 5000) > __pyx_v_max_id)) {
        __pyx_t_5 = __pyx_v_max_id;
      } else {
        __pyx_t_5 = ((__pyx_v_i + 5000) > __pyx_v_max_id);
      }
      if (!__pyx_t_5) {
        __pyx_t_6 = (__pyx_v_i + 5000);
      } else {
        __pyx_t_6 = __pyx_t_5;
      }
      __pyx_t_3 = __Pyx_PyBool_FromLong(__pyx_t_6); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 118; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_1 = PyInt_FromLong(__pyx_v_max_id); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 118; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_10 = PyTuple_New(2); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 118; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(((PyObject *)__pyx_t_10));
      PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_3);
      __Pyx_GIVEREF(__pyx_t_3);
      PyTuple_SET_ITEM(__pyx_t_10, 1, __pyx_t_1);
      __Pyx_GIVEREF(__pyx_t_1);
      __pyx_t_3 = 0;
      __pyx_t_1 = 0;
      __pyx_t_1 = PyNumber_Remainder(__pyx_kp_37, ((PyObject *)__pyx_t_10)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 118; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(((PyObject *)__pyx_t_10)); __pyx_t_10 = 0;
      __pyx_t_10 = PyTuple_New(1); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 118; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(((PyObject *)__pyx_t_10));
      PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_1);
      __Pyx_GIVEREF(__pyx_t_1);
      __pyx_t_1 = 0;
      __pyx_t_1 = PyObject_Call(__pyx_3, ((PyObject *)__pyx_t_10), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 118; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
      __Pyx_DECREF(((PyObject *)__pyx_t_10)); __pyx_t_10 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

      /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":119
 *             write_message("Phase 1: ......processed %s/%s terms" % ((i+5000)>max_id and max_id or (i+5000), max_id))
 *             task_update_progress("Post-processing phase 1: %s/%s terms" % ((i+5000)>max_id and max_id or (i+5000), max_id))
 *             i += 5000             # <<<<<<<<<<<<<<
 *             task_sleep_now_if_required()
 * 
 */
      __pyx_v_i += 5000;

      /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":120
 *             task_update_progress("Post-processing phase 1: %s/%s terms" % ((i+5000)>max_id and max_id or (i+5000), max_id))
 *             i += 5000
 *             task_sleep_now_if_required()             # <<<<<<<<<<<<<<
 * 
 *         write_message("Phase 1: Finished finding which records contains which terms")
 */
      __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_6); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 120; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_1);
      __pyx_t_1 = PyObject_Call(__pyx_1, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 120; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    }

    /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":122
 *             task_sleep_now_if_required()
 * 
 *         write_message("Phase 1: Finished finding which records contains which terms")             # <<<<<<<<<<<<<<
 *         write_message("Phase 2: Jumping over..already done in phase 1 because of -R option")
 *     task_sleep_now_if_required()
 */
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_kp_write_message); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 122; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_2);
    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 122; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    __Pyx_INCREF(__pyx_kp_38);
    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_38);
    __Pyx_GIVEREF(__pyx_kp_38);
    __pyx_t_10 = PyObject_Call(__pyx_2, ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 122; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_10);
    __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

    /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":123
 * 
 *         write_message("Phase 1: Finished finding which records contains which terms")
 *         write_message("Phase 2: Jumping over..already done in phase 1 because of -R option")             # <<<<<<<<<<<<<<
 *     task_sleep_now_if_required()
 *     terms = Gi.keys()
 */
    __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_kp_write_message); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 123; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_3);
    __pyx_t_10 = PyTuple_New(1); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 123; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_10));
    __Pyx_INCREF(__pyx_kp_39);
    PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_kp_39);
    __Pyx_GIVEREF(__pyx_kp_39);
    __pyx_t_1 = PyObject_Call(__pyx_3, ((PyObject *)__pyx_t_10), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 123; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_10)); __pyx_t_10 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  }
  __pyx_L6:;

  /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":124
 *         write_message("Phase 1: Finished finding which records contains which terms")
 *         write_message("Phase 2: Jumping over..already done in phase 1 because of -R option")
 *     task_sleep_now_if_required()             # <<<<<<<<<<<<<<
 *     terms = Gi.keys()
 *     Gi = {}
 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_6); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 124; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __pyx_t_1 = PyObject_Call(__pyx_1, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 124; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":125
 *         write_message("Phase 2: Jumping over..already done in phase 1 because of -R option")
 *     task_sleep_now_if_required()
 *     terms = Gi.keys()             # <<<<<<<<<<<<<<
 *     Gi = {}
 *     i = 0
 */
  __pyx_t_1 = PyDict_Keys(((PyObject *)__pyx_v_Gi)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 125; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (!(likely(PyList_CheckExact(__pyx_t_1)) || (__pyx_t_1) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected list, got %s", Py_TYPE(__pyx_t_1)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 125; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(((PyObject *)__pyx_v_terms));
  __pyx_v_terms = ((PyObject *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":126
 *     task_sleep_now_if_required()
 *     terms = Gi.keys()
 *     Gi = {}             # <<<<<<<<<<<<<<
 *     i = 0
 *     if task_get_option("quick") == "no":
 */
  __pyx_2 = PyDict_New(); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 126; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_2));
  __Pyx_DECREF(((PyObject *)__pyx_v_Gi));
  __pyx_v_Gi = __pyx_2;
  __pyx_2 = 0;

  /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":127
 *     terms = Gi.keys()
 *     Gi = {}
 *     i = 0             # <<<<<<<<<<<<<<
 *     if task_get_option("quick") == "no":
 *         #Calculating Fi and Gi value for each term
 */
  __pyx_v_i = 0;

  /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":128
 *     Gi = {}
 *     i = 0
 *     if task_get_option("quick") == "no":             # <<<<<<<<<<<<<<
 *         #Calculating Fi and Gi value for each term
 *         write_message("Phase 3: Calculating importance of all affected terms")
 */
  __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_kp_task_get_option); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_3);
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  __Pyx_INCREF(__pyx_kp_40);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_40);
  __Pyx_GIVEREF(__pyx_kp_40);
  __pyx_t_10 = PyObject_Call(__pyx_3, ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_10);
  __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_1 = PyObject_RichCompare(__pyx_t_10, __pyx_kp_41, Py_EQ); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
  __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_6) {

    /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":130
 *     if task_get_option("quick") == "no":
 *         #Calculating Fi and Gi value for each term
 *         write_message("Phase 3: Calculating importance of all affected terms")             # <<<<<<<<<<<<<<
 *         while i < len(terms):
 *             terms_docs = get_from_forward_index(terms, i, (i+5000), table)
 */
    __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_write_message); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 130; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 130; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    __Pyx_INCREF(__pyx_kp_42);
    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_42);
    __Pyx_GIVEREF(__pyx_kp_42);
    __pyx_t_10 = PyObject_Call(__pyx_1, ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 130; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_10);
    __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

    /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":131
 *         #Calculating Fi and Gi value for each term
 *         write_message("Phase 3: Calculating importance of all affected terms")
 *         while i < len(terms):             # <<<<<<<<<<<<<<
 *             terms_docs = get_from_forward_index(terms, i, (i+5000), table)
 *             for (t, hitlist) in terms_docs:
 */
    while (1) {
      __pyx_t_8 = PyObject_Length(((PyObject *)__pyx_v_terms)); if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 131; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_t_6 = (__pyx_v_i < __pyx_t_8);
      if (!__pyx_t_6) break;

      /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":132
 *         write_message("Phase 3: Calculating importance of all affected terms")
 *         while i < len(terms):
 *             terms_docs = get_from_forward_index(terms, i, (i+5000), table)             # <<<<<<<<<<<<<<
 *             for (t, hitlist) in terms_docs:
 *                 term_docs = deserialize_via_marshal(hitlist)
 */
      __pyx_t_10 = __pyx_f_22bibrank_word_indexer_c_get_from_forward_index(__pyx_v_terms, __pyx_v_i, (__pyx_v_i + 5000), __pyx_v_table, 0); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 132; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_10);
      if (!(likely(PyTuple_CheckExact(__pyx_t_10)) || (__pyx_t_10) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected tuple, got %s", Py_TYPE(__pyx_t_10)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 132; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(((PyObject *)__pyx_v_terms_docs));
      __pyx_v_terms_docs = ((PyObject *)__pyx_t_10);
      __pyx_t_10 = 0;

      /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":133
 *         while i < len(terms):
 *             terms_docs = get_from_forward_index(terms, i, (i+5000), table)
 *             for (t, hitlist) in terms_docs:             # <<<<<<<<<<<<<<
 *                 term_docs = deserialize_via_marshal(hitlist)
 *                 if term_docs.has_key("Gi"):
 */
      if (likely(((PyObject *)__pyx_v_terms_docs) != Py_None)) {
        __pyx_t_8 = 0; __pyx_t_10 = ((PyObject *)__pyx_v_terms_docs); __Pyx_INCREF(__pyx_t_10);
      } else {
        PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable"); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      }
      for (;;) {
        if (__pyx_t_8 >= PyTuple_GET_SIZE(__pyx_t_10)) break;
        __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_10, __pyx_t_8); __Pyx_INCREF(__pyx_t_1); __pyx_t_8++;
        if (PyTuple_CheckExact(__pyx_t_1) && likely(PyTuple_GET_SIZE(__pyx_t_1) == 2)) {
          PyObject* tuple = __pyx_t_1;
          __pyx_3 = PyTuple_GET_ITEM(tuple, 0); __Pyx_INCREF(__pyx_3);
          if (!(likely(PyString_CheckExact(__pyx_3)) || (__pyx_3) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected str, got %s", Py_TYPE(__pyx_3)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __pyx_1 = PyTuple_GET_ITEM(tuple, 1); __Pyx_INCREF(__pyx_1);
          if (!(likely(PyString_CheckExact(__pyx_1)) || (__pyx_1) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected str, got %s", Py_TYPE(__pyx_1)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __Pyx_DECREF(((PyObject *)__pyx_v_t));
          __pyx_v_t = ((PyObject *)__pyx_3);
          __pyx_3 = 0;
          __Pyx_DECREF(((PyObject *)__pyx_v_hitlist));
          __pyx_v_hitlist = ((PyObject *)__pyx_1);
          __pyx_1 = 0;
        } else {
          __pyx_2 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_2);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_3 = __Pyx_UnpackItem(__pyx_2, 0); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_3);
          if (!(likely(PyString_CheckExact(__pyx_3)) || (__pyx_3) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected str, got %s", Py_TYPE(__pyx_3)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __pyx_1 = __Pyx_UnpackItem(__pyx_2, 1); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_1);
          if (!(likely(PyString_CheckExact(__pyx_1)) || (__pyx_1) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected str, got %s", Py_TYPE(__pyx_1)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          if (__Pyx_EndUnpack(__pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
          __Pyx_DECREF(((PyObject *)__pyx_v_t));
          __pyx_v_t = ((PyObject *)__pyx_3);
          __pyx_3 = 0;
          __Pyx_DECREF(((PyObject *)__pyx_v_hitlist));
          __pyx_v_hitlist = ((PyObject *)__pyx_1);
          __pyx_1 = 0;
        }

        /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":134
 *             terms_docs = get_from_forward_index(terms, i, (i+5000), table)
 *             for (t, hitlist) in terms_docs:
 *                 term_docs = deserialize_via_marshal(hitlist)             # <<<<<<<<<<<<<<
 *                 if term_docs.has_key("Gi"):
 *                     del term_docs["Gi"]
 */
        __pyx_t_1 = __pyx_f_22bibrank_word_indexer_c_deserialize_via_marshal(__pyx_v_hitlist); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 134; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_1);
        if (!(likely(PyDict_CheckExact(__pyx_t_1)) || (__pyx_t_1) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected dict, got %s", Py_TYPE(__pyx_t_1)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 134; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(((PyObject *)__pyx_v_term_docs));
        __pyx_v_term_docs = ((PyObject *)__pyx_t_1);
        __pyx_t_1 = 0;

        /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":135
 *             for (t, hitlist) in terms_docs:
 *                 term_docs = deserialize_via_marshal(hitlist)
 *                 if term_docs.has_key("Gi"):             # <<<<<<<<<<<<<<
 *                     del term_docs["Gi"]
 *                 Fi = 0
 */
        __pyx_t_1 = PyObject_GetAttr(((PyObject *)__pyx_v_term_docs), __pyx_kp_has_key); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(((PyObject *)__pyx_t_3));
        __Pyx_INCREF(__pyx_kp_43);
        PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_kp_43);
        __Pyx_GIVEREF(__pyx_kp_43);
        __pyx_t_9 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_3), NULL); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_9);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
        __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_9); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
        if (__pyx_t_6) {

          /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":136
 *                 term_docs = deserialize_via_marshal(hitlist)
 *                 if term_docs.has_key("Gi"):
 *                     del term_docs["Gi"]             # <<<<<<<<<<<<<<
 *                 Fi = 0
 *                 Gi[t] = 1
 */
          if (PyDict_DelItem(((PyObject *)__pyx_v_term_docs), __pyx_kp_44) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 136; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          goto __pyx_L33;
        }
        __pyx_L33:;

        /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":137
 *                 if term_docs.has_key("Gi"):
 *                     del term_docs["Gi"]
 *                 Fi = 0             # <<<<<<<<<<<<<<
 *                 Gi[t] = 1
 *                 for (j, tf) in term_docs.iteritems():
 */
        __Pyx_INCREF(__pyx_int_0);
        __Pyx_DECREF(__pyx_v_Fi);
        __pyx_v_Fi = __pyx_int_0;

        /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":138
 *                     del term_docs["Gi"]
 *                 Fi = 0
 *                 Gi[t] = 1             # <<<<<<<<<<<<<<
 *                 for (j, tf) in term_docs.iteritems():
 *                     Fi += tf[0]
 */
        if (PyDict_SetItem(((PyObject *)__pyx_v_Gi), ((PyObject *)__pyx_v_t), __pyx_int_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 138; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

        /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":139
 *                 Fi = 0
 *                 Gi[t] = 1
 *                 for (j, tf) in term_docs.iteritems():             # <<<<<<<<<<<<<<
 *                     Fi += tf[0]
 *                 for (j, tf) in term_docs.iteritems():
 */
        __Pyx_INCREF(((PyObject *)__pyx_v_term_docs));
        __Pyx_XDECREF(__pyx_t_9);
        __pyx_t_9 = ((PyObject *)__pyx_v_term_docs);
        __pyx_t_11 = 0;
        while (1) {
          if (!PyDict_Next(__pyx_t_9, (&__pyx_t_11), ((PyObject **)(&__pyx_t_12)), ((PyObject **)(&__pyx_t_13)))) break;
          __pyx_t_4 = __Pyx_PyInt_AsInt(((PyObject *)__pyx_t_12)); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 139; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __pyx_v_j = __pyx_t_4;
          if (!(likely(PyTuple_CheckExact(((PyObject *)__pyx_t_13))) || (((PyObject *)__pyx_t_13)) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected tuple, got %s", Py_TYPE(((PyObject *)__pyx_t_13))->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 139; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_INCREF(((PyObject *)((PyObject *)__pyx_t_13)));
          __Pyx_DECREF(((PyObject *)__pyx_v_tf));
          __pyx_v_tf = ((PyObject *)__pyx_t_13);

          /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":140
 *                 Gi[t] = 1
 *                 for (j, tf) in term_docs.iteritems():
 *                     Fi += tf[0]             # <<<<<<<<<<<<<<
 *                 for (j, tf) in term_docs.iteritems():
 *                     if tf[0] != Fi and Fi != 0:
 */
          __pyx_2 = __Pyx_GetItemInt_Tuple(((PyObject *)__pyx_v_tf), 0, sizeof(long), PyInt_FromLong); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_2);
          __pyx_3 = PyNumber_InPlaceAdd(__pyx_v_Fi, __pyx_2); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_3);
          __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
          __Pyx_DECREF(__pyx_v_Fi);
          __pyx_v_Fi = __pyx_3;
          __pyx_3 = 0;
        }
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;

        /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":141
 *                 for (j, tf) in term_docs.iteritems():
 *                     Fi += tf[0]
 *                 for (j, tf) in term_docs.iteritems():             # <<<<<<<<<<<<<<
 *                     if tf[0] != Fi and Fi != 0:
 *                         Gi[t] += ((<float>tf[0] / Fi) * logf(<float>tf[0] / Fi)) / log2N
 */
        __Pyx_INCREF(((PyObject *)__pyx_v_term_docs));
        __Pyx_XDECREF(__pyx_t_9);
        __pyx_t_9 = ((PyObject *)__pyx_v_term_docs);
        __pyx_t_11 = 0;
        while (1) {
          if (!PyDict_Next(__pyx_t_9, (&__pyx_t_11), ((PyObject **)(&__pyx_t_13)), ((PyObject **)(&__pyx_t_12)))) break;
          __pyx_t_4 = __Pyx_PyInt_AsInt(((PyObject *)__pyx_t_13)); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 141; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __pyx_v_j = __pyx_t_4;
          if (!(likely(PyTuple_CheckExact(((PyObject *)__pyx_t_12))) || (((PyObject *)__pyx_t_12)) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected tuple, got %s", Py_TYPE(((PyObject *)__pyx_t_12))->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 141; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_INCREF(((PyObject *)((PyObject *)__pyx_t_12)));
          __Pyx_DECREF(((PyObject *)__pyx_v_tf));
          __pyx_v_tf = ((PyObject *)__pyx_t_12);

          /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":142
 *                     Fi += tf[0]
 *                 for (j, tf) in term_docs.iteritems():
 *                     if tf[0] != Fi and Fi != 0:             # <<<<<<<<<<<<<<
 *                         Gi[t] += ((<float>tf[0] / Fi) * logf(<float>tf[0] / Fi)) / log2N
 *             write_message("Phase 3: ......processed %s/%s terms" % ((i+5000>len(terms) and len(terms) or (i+5000)), len(terms)))
 */
          __pyx_2 = __Pyx_GetItemInt_Tuple(((PyObject *)__pyx_v_tf), 0, sizeof(long), PyInt_FromLong); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 142; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_2);
          __pyx_t_3 = PyObject_RichCompare(__pyx_2, __pyx_v_Fi, Py_NE); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 142; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
          __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 142; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          if (__pyx_t_6) {
            __pyx_t_3 = PyObject_RichCompare(__pyx_v_Fi, __pyx_int_0, Py_NE); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 142; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_3);
            __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 142; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
            __pyx_t_7 = __pyx_t_5;
          } else {
            __pyx_t_7 = __pyx_t_6;
          }
          if (__pyx_t_7) {

            /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":143
 *                 for (j, tf) in term_docs.iteritems():
 *                     if tf[0] != Fi and Fi != 0:
 *                         Gi[t] += ((<float>tf[0] / Fi) * logf(<float>tf[0] / Fi)) / log2N             # <<<<<<<<<<<<<<
 *             write_message("Phase 3: ......processed %s/%s terms" % ((i+5000>len(terms) and len(terms) or (i+5000)), len(terms)))
 *             task_update_progress("Post-processing phase 3: %s/%s terms" % ((i+5000>len(terms) and len(terms) or (i+5000)), len(terms)))
 */
            __pyx_3 = __Pyx_GetItemInt_Tuple(((PyObject *)__pyx_v_tf), 0, sizeof(long), PyInt_FromLong); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 143; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_3);
            __pyx_t_2 = __pyx_PyFloat_AsDouble(__pyx_3); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 143; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
            __pyx_t_3 = PyFloat_FromDouble(((float)__pyx_t_2)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 143; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_3);
            __pyx_t_1 = __Pyx_PyNumber_Divide(__pyx_t_3, __pyx_v_Fi); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 143; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_1);
            __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
            __pyx_2 = __Pyx_GetItemInt_Tuple(((PyObject *)__pyx_v_tf), 0, sizeof(long), PyInt_FromLong); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 143; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_2);
            __pyx_t_2 = __pyx_PyFloat_AsDouble(__pyx_2); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 143; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
            __pyx_t_3 = PyFloat_FromDouble(((float)__pyx_t_2)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 143; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_3);
            __pyx_t_14 = __Pyx_PyNumber_Divide(__pyx_t_3, __pyx_v_Fi); if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 143; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_14);
            __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
            __pyx_t_2 = __pyx_PyFloat_AsDouble(__pyx_t_14); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 143; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
            __pyx_t_14 = PyFloat_FromDouble(logf(__pyx_t_2)); if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 143; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_14);
            __pyx_t_3 = PyNumber_Multiply(__pyx_t_1, __pyx_t_14); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 143; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_3);
            __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
            __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
            __pyx_t_14 = PyFloat_FromDouble(__pyx_v_log2N); if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 143; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_14);
            __pyx_t_1 = __Pyx_PyNumber_Divide(__pyx_t_3, __pyx_t_14); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 143; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_1);
            __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
            __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
            __pyx_3 = PyObject_GetItem(((PyObject *)__pyx_v_Gi), ((PyObject *)__pyx_v_t)); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 143; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_3);
            __pyx_1 = PyNumber_InPlaceAdd(__pyx_3, __pyx_t_1); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 143; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_1);
            __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
            __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
            if (PyDict_SetItem(((PyObject *)__pyx_v_Gi), ((PyObject *)__pyx_v_t), __pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 143; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
            goto __pyx_L38;
          }
          __pyx_L38:;
        }
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      }
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

      /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":144
 *                     if tf[0] != Fi and Fi != 0:
 *                         Gi[t] += ((<float>tf[0] / Fi) * logf(<float>tf[0] / Fi)) / log2N
 *             write_message("Phase 3: ......processed %s/%s terms" % ((i+5000>len(terms) and len(terms) or (i+5000)), len(terms)))             # <<<<<<<<<<<<<<
 *             task_update_progress("Post-processing phase 3: %s/%s terms" % ((i+5000>len(terms) and len(terms) or (i+5000)), len(terms)))
 *             i += 5000
 */
      __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_kp_write_message); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 144; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_2);
      __pyx_t_8 = PyObject_Length(((PyObject *)__pyx_v_terms)); if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 144; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      if (((__pyx_v_i + 5000) > __pyx_t_8)) {
        __pyx_t_11 = PyObject_Length(((PyObject *)__pyx_v_terms)); if (unlikely(__pyx_t_11 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 144; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __pyx_t_7 = __pyx_t_11;
      } else {
        __pyx_t_7 = ((__pyx_v_i + 5000) > __pyx_t_8);
      }
      if (!__pyx_t_7) {
        __pyx_t_6 = (__pyx_v_i + 5000);
      } else {
        __pyx_t_6 = __pyx_t_7;
      }
      __pyx_t_10 = __Pyx_PyBool_FromLong(__pyx_t_6); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 144; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_10);
      __pyx_t_8 = PyObject_Length(((PyObject *)__pyx_v_terms)); if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 144; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_t_9 = PyInt_FromSsize_t(__pyx_t_8); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 144; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_9);
      __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 144; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(((PyObject *)__pyx_t_1));
      PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_10);
      __Pyx_GIVEREF(__pyx_t_10);
      PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_9);
      __Pyx_GIVEREF(__pyx_t_9);
      __pyx_t_10 = 0;
      __pyx_t_9 = 0;
      __pyx_t_9 = PyNumber_Remainder(__pyx_kp_45, ((PyObject *)__pyx_t_1)); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 144; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_9);
      __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
      __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 144; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(((PyObject *)__pyx_t_1));
      PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_9);
      __Pyx_GIVEREF(__pyx_t_9);
      __pyx_t_9 = 0;
      __pyx_t_9 = PyObject_Call(__pyx_2, ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 144; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_9);
      __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
      __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;

      /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":145
 *                         Gi[t] += ((<float>tf[0] / Fi) * logf(<float>tf[0] / Fi)) / log2N
 *             write_message("Phase 3: ......processed %s/%s terms" % ((i+5000>len(terms) and len(terms) or (i+5000)), len(terms)))
 *             task_update_progress("Post-processing phase 3: %s/%s terms" % ((i+5000>len(terms) and len(terms) or (i+5000)), len(terms)))             # <<<<<<<<<<<<<<
 *             i += 5000
 *             task_sleep_now_if_required()
 */
      __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_kp_5); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_3);
      __pyx_t_8 = PyObject_Length(((PyObject *)__pyx_v_terms)); if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      if (((__pyx_v_i + 5000) > __pyx_t_8)) {
        __pyx_t_11 = PyObject_Length(((PyObject *)__pyx_v_terms)); if (unlikely(__pyx_t_11 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __pyx_t_6 = __pyx_t_11;
      } else {
        __pyx_t_6 = ((__pyx_v_i + 5000) > __pyx_t_8);
      }
      if (!__pyx_t_6) {
        __pyx_t_7 = (__pyx_v_i + 5000);
      } else {
        __pyx_t_7 = __pyx_t_6;
      }
      __pyx_t_9 = __Pyx_PyBool_FromLong(__pyx_t_7); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_9);
      __pyx_t_8 = PyObject_Length(((PyObject *)__pyx_v_terms)); if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_8); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_10 = PyTuple_New(2); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(((PyObject *)__pyx_t_10));
      PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_9);
      __Pyx_GIVEREF(__pyx_t_9);
      PyTuple_SET_ITEM(__pyx_t_10, 1, __pyx_t_1);
      __Pyx_GIVEREF(__pyx_t_1);
      __pyx_t_9 = 0;
      __pyx_t_1 = 0;
      __pyx_t_1 = PyNumber_Remainder(__pyx_kp_46, ((PyObject *)__pyx_t_10)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(((PyObject *)__pyx_t_10)); __pyx_t_10 = 0;
      __pyx_t_10 = PyTuple_New(1); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(((PyObject *)__pyx_t_10));
      PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_1);
      __Pyx_GIVEREF(__pyx_t_1);
      __pyx_t_1 = 0;
      __pyx_t_1 = PyObject_Call(__pyx_3, ((PyObject *)__pyx_t_10), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
      __Pyx_DECREF(((PyObject *)__pyx_t_10)); __pyx_t_10 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

      /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":146
 *             write_message("Phase 3: ......processed %s/%s terms" % ((i+5000>len(terms) and len(terms) or (i+5000)), len(terms)))
 *             task_update_progress("Post-processing phase 3: %s/%s terms" % ((i+5000>len(terms) and len(terms) or (i+5000)), len(terms)))
 *             i += 5000             # <<<<<<<<<<<<<<
 *             task_sleep_now_if_required()
 *         write_message("Phase 3: Finished calculating importance of all affected terms")
 */
      __pyx_v_i += 5000;

      /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":147
 *             task_update_progress("Post-processing phase 3: %s/%s terms" % ((i+5000>len(terms) and len(terms) or (i+5000)), len(terms)))
 *             i += 5000
 *             task_sleep_now_if_required()             # <<<<<<<<<<<<<<
 *         write_message("Phase 3: Finished calculating importance of all affected terms")
 *     else:
 */
      __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_6); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 147; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_1);
      __pyx_t_1 = PyObject_Call(__pyx_1, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 147; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    }

    /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":148
 *             i += 5000
 *             task_sleep_now_if_required()
 *         write_message("Phase 3: Finished calculating importance of all affected terms")             # <<<<<<<<<<<<<<
 *     else:
 *         #Using existing Gi value instead of calculating a new one. Missing some accurancy.
 */
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_kp_write_message); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_2);
    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    __Pyx_INCREF(__pyx_kp_47);
    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_47);
    __Pyx_GIVEREF(__pyx_kp_47);
    __pyx_t_10 = PyObject_Call(__pyx_2, ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_10);
    __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
    goto __pyx_L28;
  }
  /*else*/ {

    /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":151
 *     else:
 *         #Using existing Gi value instead of calculating a new one. Missing some accurancy.
 *         write_message("Phase 3: Getting approximate importance of all affected terms")             # <<<<<<<<<<<<<<
 *         while i < len(terms):
 *             terms_docs = get_from_forward_index(terms, i, (i+5000), table)
 */
    __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_kp_write_message); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 151; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_3);
    __pyx_t_10 = PyTuple_New(1); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 151; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_10));
    __Pyx_INCREF(__pyx_kp_48);
    PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_kp_48);
    __Pyx_GIVEREF(__pyx_kp_48);
    __pyx_t_1 = PyObject_Call(__pyx_3, ((PyObject *)__pyx_t_10), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 151; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_10)); __pyx_t_10 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":152
 *         #Using existing Gi value instead of calculating a new one. Missing some accurancy.
 *         write_message("Phase 3: Getting approximate importance of all affected terms")
 *         while i < len(terms):             # <<<<<<<<<<<<<<
 *             terms_docs = get_from_forward_index(terms, i, (i+5000), table)
 *             for (t, hitlist) in terms_docs:
 */
    while (1) {
      __pyx_t_8 = PyObject_Length(((PyObject *)__pyx_v_terms)); if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_t_7 = (__pyx_v_i < __pyx_t_8);
      if (!__pyx_t_7) break;

      /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":153
 *         write_message("Phase 3: Getting approximate importance of all affected terms")
 *         while i < len(terms):
 *             terms_docs = get_from_forward_index(terms, i, (i+5000), table)             # <<<<<<<<<<<<<<
 *             for (t, hitlist) in terms_docs:
 *                 term_docs = deserialize_via_marshal(hitlist)
 */
      __pyx_t_1 = __pyx_f_22bibrank_word_indexer_c_get_from_forward_index(__pyx_v_terms, __pyx_v_i, (__pyx_v_i + 5000), __pyx_v_table, 0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 153; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      if (!(likely(PyTuple_CheckExact(__pyx_t_1)) || (__pyx_t_1) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected tuple, got %s", Py_TYPE(__pyx_t_1)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 153; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_DECREF(((PyObject *)__pyx_v_terms_docs));
      __pyx_v_terms_docs = ((PyObject *)__pyx_t_1);
      __pyx_t_1 = 0;

      /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":154
 *         while i < len(terms):
 *             terms_docs = get_from_forward_index(terms, i, (i+5000), table)
 *             for (t, hitlist) in terms_docs:             # <<<<<<<<<<<<<<
 *                 term_docs = deserialize_via_marshal(hitlist)
 *                 if term_docs.has_key("Gi"):
 */
      if (likely(((PyObject *)__pyx_v_terms_docs) != Py_None)) {
        __pyx_t_8 = 0; __pyx_t_1 = ((PyObject *)__pyx_v_terms_docs); __Pyx_INCREF(__pyx_t_1);
      } else {
        PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable"); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      }
      for (;;) {
        if (__pyx_t_8 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        __pyx_t_10 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_8); __Pyx_INCREF(__pyx_t_10); __pyx_t_8++;
        if (PyTuple_CheckExact(__pyx_t_10) && likely(PyTuple_GET_SIZE(__pyx_t_10) == 2)) {
          PyObject* tuple = __pyx_t_10;
          __pyx_2 = PyTuple_GET_ITEM(tuple, 0); __Pyx_INCREF(__pyx_2);
          if (!(likely(PyString_CheckExact(__pyx_2)) || (__pyx_2) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected str, got %s", Py_TYPE(__pyx_2)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __pyx_3 = PyTuple_GET_ITEM(tuple, 1); __Pyx_INCREF(__pyx_3);
          if (!(likely(PyString_CheckExact(__pyx_3)) || (__pyx_3) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected str, got %s", Py_TYPE(__pyx_3)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          __Pyx_DECREF(((PyObject *)__pyx_v_t));
          __pyx_v_t = ((PyObject *)__pyx_2);
          __pyx_2 = 0;
          __Pyx_DECREF(((PyObject *)__pyx_v_hitlist));
          __pyx_v_hitlist = ((PyObject *)__pyx_3);
          __pyx_3 = 0;
        } else {
          __pyx_1 = PyObject_GetIter(__pyx_t_10); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_1);
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          __pyx_2 = __Pyx_UnpackItem(__pyx_1, 0); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_2);
          if (!(likely(PyString_CheckExact(__pyx_2)) || (__pyx_2) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected str, got %s", Py_TYPE(__pyx_2)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __pyx_3 = __Pyx_UnpackItem(__pyx_1, 1); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_3);
          if (!(likely(PyString_CheckExact(__pyx_3)) || (__pyx_3) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected str, got %s", Py_TYPE(__pyx_3)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          if (__Pyx_EndUnpack(__pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
          __Pyx_DECREF(((PyObject *)__pyx_v_t));
          __pyx_v_t = ((PyObject *)__pyx_2);
          __pyx_2 = 0;
          __Pyx_DECREF(((PyObject *)__pyx_v_hitlist));
          __pyx_v_hitlist = ((PyObject *)__pyx_3);
          __pyx_3 = 0;
        }

        /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":155
 *             terms_docs = get_from_forward_index(terms, i, (i+5000), table)
 *             for (t, hitlist) in terms_docs:
 *                 term_docs = deserialize_via_marshal(hitlist)             # <<<<<<<<<<<<<<
 *                 if term_docs.has_key("Gi"):
 *                     Gi[t] = term_docs["Gi"][1]
 */
        __pyx_t_10 = __pyx_f_22bibrank_word_indexer_c_deserialize_via_marshal(__pyx_v_hitlist); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 155; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_10);
        if (!(likely(PyDict_CheckExact(__pyx_t_10)) || (__pyx_t_10) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected dict, got %s", Py_TYPE(__pyx_t_10)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 155; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(((PyObject *)__pyx_v_term_docs));
        __pyx_v_term_docs = ((PyObject *)__pyx_t_10);
        __pyx_t_10 = 0;

        /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":156
 *             for (t, hitlist) in terms_docs:
 *                 term_docs = deserialize_via_marshal(hitlist)
 *                 if term_docs.has_key("Gi"):             # <<<<<<<<<<<<<<
 *                     Gi[t] = term_docs["Gi"][1]
 *                 elif len(term_docs) == 1:
 */
        __pyx_t_10 = PyObject_GetAttr(((PyObject *)__pyx_v_term_docs), __pyx_kp_has_key); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 156; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_10);
        __pyx_t_9 = PyTuple_New(1); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 156; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(((PyObject *)__pyx_t_9));
        __Pyx_INCREF(__pyx_kp_49);
        PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_kp_49);
        __Pyx_GIVEREF(__pyx_kp_49);
        __pyx_t_14 = PyObject_Call(__pyx_t_10, ((PyObject *)__pyx_t_9), NULL); if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 156; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_t_14);
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        __Pyx_DECREF(((PyObject *)__pyx_t_9)); __pyx_t_9 = 0;
        __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_14); if (unlikely(__pyx_t_7 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 156; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
        if (__pyx_t_7) {

          /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":157
 *                 term_docs = deserialize_via_marshal(hitlist)
 *                 if term_docs.has_key("Gi"):
 *                     Gi[t] = term_docs["Gi"][1]             # <<<<<<<<<<<<<<
 *                 elif len(term_docs) == 1:
 *                     Gi[t] = 1
 */
          __pyx_1 = PyObject_GetItem(((PyObject *)__pyx_v_term_docs), __pyx_kp_50); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 157; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_1);
          __pyx_2 = __Pyx_GetItemInt(__pyx_1, 1, sizeof(long), PyInt_FromLong); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 157; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_GOTREF(__pyx_2);
          __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
          if (PyDict_SetItem(((PyObject *)__pyx_v_Gi), ((PyObject *)__pyx_v_t), __pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 157; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
          goto __pyx_L43;
        }

        /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":158
 *                 if term_docs.has_key("Gi"):
 *                     Gi[t] = term_docs["Gi"][1]
 *                 elif len(term_docs) == 1:             # <<<<<<<<<<<<<<
 *                     Gi[t] = 1
 *                 else:
 */
        __pyx_t_11 = PyObject_Length(((PyObject *)__pyx_v_term_docs)); if (unlikely(__pyx_t_11 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 158; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __pyx_t_7 = (__pyx_t_11 == 1);
        if (__pyx_t_7) {

          /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":159
 *                     Gi[t] = term_docs["Gi"][1]
 *                 elif len(term_docs) == 1:
 *                     Gi[t] = 1             # <<<<<<<<<<<<<<
 *                 else:
 *                     Fi = 0
 */
          if (PyDict_SetItem(((PyObject *)__pyx_v_Gi), ((PyObject *)__pyx_v_t), __pyx_int_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 159; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          goto __pyx_L43;
        }
        /*else*/ {

          /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":161
 *                     Gi[t] = 1
 *                 else:
 *                     Fi = 0             # <<<<<<<<<<<<<<
 *                     Gi[t] = 1
 *                     for (j, tf) in term_docs.iteritems():
 */
          __Pyx_INCREF(__pyx_int_0);
          __Pyx_DECREF(__pyx_v_Fi);
          __pyx_v_Fi = __pyx_int_0;

          /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":162
 *                 else:
 *                     Fi = 0
 *                     Gi[t] = 1             # <<<<<<<<<<<<<<
 *                     for (j, tf) in term_docs.iteritems():
 *                         Fi += tf[0]
 */
          if (PyDict_SetItem(((PyObject *)__pyx_v_Gi), ((PyObject *)__pyx_v_t), __pyx_int_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 162; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

          /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":163
 *                     Fi = 0
 *                     Gi[t] = 1
 *                     for (j, tf) in term_docs.iteritems():             # <<<<<<<<<<<<<<
 *                         Fi += tf[0]
 *                     for (j, tf) in term_docs.iteritems():
 */
          __Pyx_INCREF(((PyObject *)__pyx_v_term_docs));
          __Pyx_XDECREF(__pyx_t_14);
          __pyx_t_14 = ((PyObject *)__pyx_v_term_docs);
          __pyx_t_11 = 0;
          while (1) {
            if (!PyDict_Next(__pyx_t_14, (&__pyx_t_11), ((PyObject **)(&__pyx_t_12)), ((PyObject **)(&__pyx_t_13)))) break;
            __pyx_t_4 = __Pyx_PyInt_AsInt(((PyObject *)__pyx_t_12)); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 163; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __pyx_v_j = __pyx_t_4;
            if (!(likely(PyTuple_CheckExact(((PyObject *)__pyx_t_13))) || (((PyObject *)__pyx_t_13)) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected tuple, got %s", Py_TYPE(((PyObject *)__pyx_t_13))->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 163; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_INCREF(((PyObject *)((PyObject *)__pyx_t_13)));
            __Pyx_DECREF(((PyObject *)__pyx_v_tf));
            __pyx_v_tf = ((PyObject *)__pyx_t_13);

            /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":164
 *                     Gi[t] = 1
 *                     for (j, tf) in term_docs.iteritems():
 *                         Fi += tf[0]             # <<<<<<<<<<<<<<
 *                     for (j, tf) in term_docs.iteritems():
 *                         if tf[0] != Fi and Fi != 0:
 */
            __pyx_3 = __Pyx_GetItemInt_Tuple(((PyObject *)__pyx_v_tf), 0, sizeof(long), PyInt_FromLong); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 164; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_3);
            __pyx_1 = PyNumber_InPlaceAdd(__pyx_v_Fi, __pyx_3); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 164; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_1);
            __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
            __Pyx_DECREF(__pyx_v_Fi);
            __pyx_v_Fi = __pyx_1;
            __pyx_1 = 0;
          }
          __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;

          /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":165
 *                     for (j, tf) in term_docs.iteritems():
 *                         Fi += tf[0]
 *                     for (j, tf) in term_docs.iteritems():             # <<<<<<<<<<<<<<
 *                         if tf[0] != Fi and Fi != 0:
 *                             Gi[t] += (<float>tf[0] / Fi) * logf(<float>tf[0] / Fi) / log2N
 */
          __Pyx_INCREF(((PyObject *)__pyx_v_term_docs));
          __Pyx_XDECREF(__pyx_t_14);
          __pyx_t_14 = ((PyObject *)__pyx_v_term_docs);
          __pyx_t_11 = 0;
          while (1) {
            if (!PyDict_Next(__pyx_t_14, (&__pyx_t_11), ((PyObject **)(&__pyx_t_13)), ((PyObject **)(&__pyx_t_12)))) break;
            __pyx_t_4 = __Pyx_PyInt_AsInt(((PyObject *)__pyx_t_13)); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 165; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __pyx_v_j = __pyx_t_4;
            if (!(likely(PyTuple_CheckExact(((PyObject *)__pyx_t_12))) || (((PyObject *)__pyx_t_12)) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected tuple, got %s", Py_TYPE(((PyObject *)__pyx_t_12))->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 165; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_INCREF(((PyObject *)((PyObject *)__pyx_t_12)));
            __Pyx_DECREF(((PyObject *)__pyx_v_tf));
            __pyx_v_tf = ((PyObject *)__pyx_t_12);

            /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":166
 *                         Fi += tf[0]
 *                     for (j, tf) in term_docs.iteritems():
 *                         if tf[0] != Fi and Fi != 0:             # <<<<<<<<<<<<<<
 *                             Gi[t] += (<float>tf[0] / Fi) * logf(<float>tf[0] / Fi) / log2N
 *             write_message("Phase 3: ......processed %s/%s terms" % ((i+5000>len(terms) and len(terms) or (i+5000)), len(terms)))
 */
            __pyx_3 = __Pyx_GetItemInt_Tuple(((PyObject *)__pyx_v_tf), 0, sizeof(long), PyInt_FromLong); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 166; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_3);
            __pyx_t_9 = PyObject_RichCompare(__pyx_3, __pyx_v_Fi, Py_NE); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 166; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_GOTREF(__pyx_t_9);
            __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
            __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_9); if (unlikely(__pyx_t_7 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 166; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
            if (__pyx_t_7) {
              __pyx_t_9 = PyObject_RichCompare(__pyx_v_Fi, __pyx_int_0, Py_NE); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 166; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
              __Pyx_GOTREF(__pyx_t_9);
              __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_9); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 166; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
              __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
              __pyx_t_5 = __pyx_t_6;
            } else {
              __pyx_t_5 = __pyx_t_7;
            }
            if (__pyx_t_5) {

              /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":167
 *                     for (j, tf) in term_docs.iteritems():
 *                         if tf[0] != Fi and Fi != 0:
 *                             Gi[t] += (<float>tf[0] / Fi) * logf(<float>tf[0] / Fi) / log2N             # <<<<<<<<<<<<<<
 *             write_message("Phase 3: ......processed %s/%s terms" % ((i+5000>len(terms) and len(terms) or (i+5000)), len(terms)))
 *             task_update_progress("Post-processing phase 3: %s/%s terms" % ((i+5000>len(terms) and len(terms) or (i+5000)), len(terms)))
 */
              __pyx_1 = __Pyx_GetItemInt_Tuple(((PyObject *)__pyx_v_tf), 0, sizeof(long), PyInt_FromLong); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 167; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
              __Pyx_GOTREF(__pyx_1);
              __pyx_t_2 = __pyx_PyFloat_AsDouble(__pyx_1); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 167; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
              __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
              __pyx_t_9 = PyFloat_FromDouble(((float)__pyx_t_2)); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 167; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
              __Pyx_GOTREF(__pyx_t_9);
              __pyx_t_10 = __Pyx_PyNumber_Divide(__pyx_t_9, __pyx_v_Fi); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 167; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
              __Pyx_GOTREF(__pyx_t_10);
              __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
              __pyx_3 = __Pyx_GetItemInt_Tuple(((PyObject *)__pyx_v_tf), 0, sizeof(long), PyInt_FromLong); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 167; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
              __Pyx_GOTREF(__pyx_3);
              __pyx_t_2 = __pyx_PyFloat_AsDouble(__pyx_3); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 167; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
              __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
              __pyx_t_9 = PyFloat_FromDouble(((float)__pyx_t_2)); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 167; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
              __Pyx_GOTREF(__pyx_t_9);
              __pyx_t_3 = __Pyx_PyNumber_Divide(__pyx_t_9, __pyx_v_Fi); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 167; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
              __Pyx_GOTREF(__pyx_t_3);
              __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
              __pyx_t_2 = __pyx_PyFloat_AsDouble(__pyx_t_3); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 167; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
              __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
              __pyx_t_3 = PyFloat_FromDouble(logf(__pyx_t_2)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 167; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
              __Pyx_GOTREF(__pyx_t_3);
              __pyx_t_9 = PyNumber_Multiply(__pyx_t_10, __pyx_t_3); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 167; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
              __Pyx_GOTREF(__pyx_t_9);
              __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
              __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
              __pyx_t_3 = PyFloat_FromDouble(__pyx_v_log2N); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 167; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
              __Pyx_GOTREF(__pyx_t_3);
              __pyx_t_10 = __Pyx_PyNumber_Divide(__pyx_t_9, __pyx_t_3); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 167; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
              __Pyx_GOTREF(__pyx_t_10);
              __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
              __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
              __pyx_1 = PyObject_GetItem(((PyObject *)__pyx_v_Gi), ((PyObject *)__pyx_v_t)); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 167; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
              __Pyx_GOTREF(__pyx_1);
              __pyx_2 = PyNumber_InPlaceAdd(__pyx_1, __pyx_t_10); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 167; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
              __Pyx_GOTREF(__pyx_2);
              __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
              __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
              if (PyDict_SetItem(((PyObject *)__pyx_v_Gi), ((PyObject *)__pyx_v_t), __pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 167; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
              __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
              goto __pyx_L48;
            }
            __pyx_L48:;
          }
          __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
        }
        __pyx_L43:;
      }
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

      /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":168
 *                         if tf[0] != Fi and Fi != 0:
 *                             Gi[t] += (<float>tf[0] / Fi) * logf(<float>tf[0] / Fi) / log2N
 *             write_message("Phase 3: ......processed %s/%s terms" % ((i+5000>len(terms) and len(terms) or (i+5000)), len(terms)))             # <<<<<<<<<<<<<<
 *             task_update_progress("Post-processing phase 3: %s/%s terms" % ((i+5000>len(terms) and len(terms) or (i+5000)), len(terms)))
 *             i += 5000
 */
      __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_kp_write_message); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 168; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_3);
      __pyx_t_8 = PyObject_Length(((PyObject *)__pyx_v_terms)); if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 168; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      if (((__pyx_v_i + 5000) > __pyx_t_8)) {
        __pyx_t_11 = PyObject_Length(((PyObject *)__pyx_v_terms)); if (unlikely(__pyx_t_11 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 168; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __pyx_t_5 = __pyx_t_11;
      } else {
        __pyx_t_5 = ((__pyx_v_i + 5000) > __pyx_t_8);
      }
      if (!__pyx_t_5) {
        __pyx_t_7 = (__pyx_v_i + 5000);
      } else {
        __pyx_t_7 = __pyx_t_5;
      }
      __pyx_t_1 = __Pyx_PyBool_FromLong(__pyx_t_7); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 168; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_8 = PyObject_Length(((PyObject *)__pyx_v_terms)); if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 168; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_t_14 = PyInt_FromSsize_t(__pyx_t_8); if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 168; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_14);
      __pyx_t_10 = PyTuple_New(2); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 168; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(((PyObject *)__pyx_t_10));
      PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_1);
      __Pyx_GIVEREF(__pyx_t_1);
      PyTuple_SET_ITEM(__pyx_t_10, 1, __pyx_t_14);
      __Pyx_GIVEREF(__pyx_t_14);
      __pyx_t_1 = 0;
      __pyx_t_14 = 0;
      __pyx_t_14 = PyNumber_Remainder(__pyx_kp_51, ((PyObject *)__pyx_t_10)); if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 168; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_14);
      __Pyx_DECREF(((PyObject *)__pyx_t_10)); __pyx_t_10 = 0;
      __pyx_t_10 = PyTuple_New(1); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 168; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(((PyObject *)__pyx_t_10));
      PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_14);
      __Pyx_GIVEREF(__pyx_t_14);
      __pyx_t_14 = 0;
      __pyx_t_14 = PyObject_Call(__pyx_3, ((PyObject *)__pyx_t_10), NULL); if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 168; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_14);
      __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
      __Pyx_DECREF(((PyObject *)__pyx_t_10)); __pyx_t_10 = 0;
      __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;

      /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":169
 *                             Gi[t] += (<float>tf[0] / Fi) * logf(<float>tf[0] / Fi) / log2N
 *             write_message("Phase 3: ......processed %s/%s terms" % ((i+5000>len(terms) and len(terms) or (i+5000)), len(terms)))
 *             task_update_progress("Post-processing phase 3: %s/%s terms" % ((i+5000>len(terms) and len(terms) or (i+5000)), len(terms)))             # <<<<<<<<<<<<<<
 *             i += 5000
 *             task_sleep_now_if_required()
 */
      __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_5); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 169; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_1);
      __pyx_t_8 = PyObject_Length(((PyObject *)__pyx_v_terms)); if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 169; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      if (((__pyx_v_i + 5000) > __pyx_t_8)) {
        __pyx_t_11 = PyObject_Length(((PyObject *)__pyx_v_terms)); if (unlikely(__pyx_t_11 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 169; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __pyx_t_7 = __pyx_t_11;
      } else {
        __pyx_t_7 = ((__pyx_v_i + 5000) > __pyx_t_8);
      }
      if (!__pyx_t_7) {
        __pyx_t_5 = (__pyx_v_i + 5000);
      } else {
        __pyx_t_5 = __pyx_t_7;
      }
      __pyx_t_14 = __Pyx_PyBool_FromLong(__pyx_t_5); if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 169; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_14);
      __pyx_t_8 = PyObject_Length(((PyObject *)__pyx_v_terms)); if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 169; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_t_10 = PyInt_FromSsize_t(__pyx_t_8); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 169; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_10);
      __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 169; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(((PyObject *)__pyx_t_1));
      PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_14);
      __Pyx_GIVEREF(__pyx_t_14);
      PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_10);
      __Pyx_GIVEREF(__pyx_t_10);
      __pyx_t_14 = 0;
      __pyx_t_10 = 0;
      __pyx_t_10 = PyNumber_Remainder(__pyx_kp_52, ((PyObject *)__pyx_t_1)); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 169; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
      __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 169; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(((PyObject *)__pyx_t_1));
      PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_10);
      __Pyx_GIVEREF(__pyx_t_10);
      __pyx_t_10 = 0;
      __pyx_t_10 = PyObject_Call(__pyx_1, ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 169; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
      __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

      /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":170
 *             write_message("Phase 3: ......processed %s/%s terms" % ((i+5000>len(terms) and len(terms) or (i+5000)), len(terms)))
 *             task_update_progress("Post-processing phase 3: %s/%s terms" % ((i+5000>len(terms) and len(terms) or (i+5000)), len(terms)))
 *             i += 5000             # <<<<<<<<<<<<<<
 *             task_sleep_now_if_required()
 *         write_message("Phase 3: Finished getting approximate importance of all affected terms")
 */
      __pyx_v_i += 5000;

      /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":171
 *             task_update_progress("Post-processing phase 3: %s/%s terms" % ((i+5000>len(terms) and len(terms) or (i+5000)), len(terms)))
 *             i += 5000
 *             task_sleep_now_if_required()             # <<<<<<<<<<<<<<
 *         write_message("Phase 3: Finished getting approximate importance of all affected terms")
 *     task_sleep_now_if_required()
 */
      __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_kp_6); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_2);
      __pyx_t_10 = PyObject_Call(__pyx_2, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
    }

    /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":172
 *             i += 5000
 *             task_sleep_now_if_required()
 *         write_message("Phase 3: Finished getting approximate importance of all affected terms")             # <<<<<<<<<<<<<<
 *     task_sleep_now_if_required()
 *     write_message("Phase 4: Calculating normalization value for all affected records and updating %sR" % table[:-1])
 */
    __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_kp_write_message); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 172; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_3);
    __pyx_t_10 = PyTuple_New(1); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 172; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_10));
    __Pyx_INCREF(__pyx_kp_53);
    PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_kp_53);
    __Pyx_GIVEREF(__pyx_kp_53);
    __pyx_t_1 = PyObject_Call(__pyx_3, ((PyObject *)__pyx_t_10), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 172; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_10)); __pyx_t_10 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  }
  __pyx_L28:;

  /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":173
 *             task_sleep_now_if_required()
 *         write_message("Phase 3: Finished getting approximate importance of all affected terms")
 *     task_sleep_now_if_required()             # <<<<<<<<<<<<<<
 *     write_message("Phase 4: Calculating normalization value for all affected records and updating %sR" % table[:-1])
 *     records = Nj.keys()
 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_6); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 173; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __pyx_t_1 = PyObject_Call(__pyx_1, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 173; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":174
 *         write_message("Phase 3: Finished getting approximate importance of all affected terms")
 *     task_sleep_now_if_required()
 *     write_message("Phase 4: Calculating normalization value for all affected records and updating %sR" % table[:-1])             # <<<<<<<<<<<<<<
 *     records = Nj.keys()
 *     i = 0
 */
  __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_kp_write_message); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 174; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_2);
  __pyx_3 = PySequence_GetSlice(((PyObject *)__pyx_v_table), 0, -1); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 174; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_3));
  __pyx_t_1 = PyNumber_Remainder(__pyx_kp_54, ((PyObject *)__pyx_3)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 174; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(((PyObject *)__pyx_3)); __pyx_3 = 0;
  __pyx_t_10 = PyTuple_New(1); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 174; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_10));
  PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = PyObject_Call(__pyx_2, ((PyObject *)__pyx_t_10), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 174; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_10)); __pyx_t_10 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":175
 *     task_sleep_now_if_required()
 *     write_message("Phase 4: Calculating normalization value for all affected records and updating %sR" % table[:-1])
 *     records = Nj.keys()             # <<<<<<<<<<<<<<
 *     i = 0
 *     while i < len(records):
 */
  __pyx_t_1 = PyDict_Keys(((PyObject *)__pyx_v_Nj)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 175; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  if (!(likely(PyList_CheckExact(__pyx_t_1)) || (__pyx_t_1) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected list, got %s", Py_TYPE(__pyx_t_1)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 175; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(((PyObject *)__pyx_v_records));
  __pyx_v_records = ((PyObject *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":176
 *     write_message("Phase 4: Calculating normalization value for all affected records and updating %sR" % table[:-1])
 *     records = Nj.keys()
 *     i = 0             # <<<<<<<<<<<<<<
 *     while i < len(records):
 *         #Calculating the normalization value for each document, and adding the Gi value to each term in each document.
 */
  __pyx_v_i = 0;

  /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":177
 *     records = Nj.keys()
 *     i = 0
 *     while i < len(records):             # <<<<<<<<<<<<<<
 *         #Calculating the normalization value for each document, and adding the Gi value to each term in each document.
 *         docs_terms = get_from_reverse_index(records, i, (i + 5000), table)
 */
  while (1) {
    __pyx_t_8 = PyObject_Length(((PyObject *)__pyx_v_records)); if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 177; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_5 = (__pyx_v_i < __pyx_t_8);
    if (!__pyx_t_5) break;

    /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":179
 *     while i < len(records):
 *         #Calculating the normalization value for each document, and adding the Gi value to each term in each document.
 *         docs_terms = get_from_reverse_index(records, i, (i + 5000), table)             # <<<<<<<<<<<<<<
 *         for (j, termlist) in docs_terms:
 *             doc_terms = deserialize_via_marshal(termlist)
 */
    __pyx_t_1 = __pyx_f_22bibrank_word_indexer_c_get_from_reverse_index(__pyx_v_records, __pyx_v_i, (__pyx_v_i + 5000), __pyx_v_table, 0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 179; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    if (!(likely(PyTuple_CheckExact(__pyx_t_1)) || (__pyx_t_1) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected tuple, got %s", Py_TYPE(__pyx_t_1)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 179; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(((PyObject *)__pyx_v_docs_terms));
    __pyx_v_docs_terms = ((PyObject *)__pyx_t_1);
    __pyx_t_1 = 0;

    /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":180
 *         #Calculating the normalization value for each document, and adding the Gi value to each term in each document.
 *         docs_terms = get_from_reverse_index(records, i, (i + 5000), table)
 *         for (j, termlist) in docs_terms:             # <<<<<<<<<<<<<<
 *             doc_terms = deserialize_via_marshal(termlist)
 *             try:
 */
    if (likely(((PyObject *)__pyx_v_docs_terms) != Py_None)) {
      __pyx_t_8 = 0; __pyx_t_1 = ((PyObject *)__pyx_v_docs_terms); __Pyx_INCREF(__pyx_t_1);
    } else {
      PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable"); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 180; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    }
    for (;;) {
      if (__pyx_t_8 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
      __pyx_t_10 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_8); __Pyx_INCREF(__pyx_t_10); __pyx_t_8++;
      if (PyTuple_CheckExact(__pyx_t_10) && likely(PyTuple_GET_SIZE(__pyx_t_10) == 2)) {
        PyObject* tuple = __pyx_t_10;
        __pyx_3 = PyTuple_GET_ITEM(tuple, 0); __Pyx_INCREF(__pyx_3);
        __pyx_t_4 = __Pyx_PyInt_AsInt(__pyx_3); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 180; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
        __pyx_2 = PyTuple_GET_ITEM(tuple, 1); __Pyx_INCREF(__pyx_2);
        if (!(likely(PyString_CheckExact(__pyx_2)) || (__pyx_2) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected str, got %s", Py_TYPE(__pyx_2)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 180; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        __pyx_v_j = __pyx_t_4;
        __Pyx_DECREF(((PyObject *)__pyx_v_termlist));
        __pyx_v_termlist = ((PyObject *)__pyx_2);
        __pyx_2 = 0;
      } else {
        __pyx_1 = PyObject_GetIter(__pyx_t_10); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 180; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_1);
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        __pyx_3 = __Pyx_UnpackItem(__pyx_1, 0); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 180; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_3);
        __pyx_t_4 = __Pyx_PyInt_AsInt(__pyx_3); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 180; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
        __pyx_2 = __Pyx_UnpackItem(__pyx_1, 1); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 180; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_2);
        if (!(likely(PyString_CheckExact(__pyx_2)) || (__pyx_2) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected str, got %s", Py_TYPE(__pyx_2)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 180; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        if (__Pyx_EndUnpack(__pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 180; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
        __pyx_v_j = __pyx_t_4;
        __Pyx_DECREF(((PyObject *)__pyx_v_termlist));
        __pyx_v_termlist = ((PyObject *)__pyx_2);
        __pyx_2 = 0;
      }

      /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":181
 *         docs_terms = get_from_reverse_index(records, i, (i + 5000), table)
 *         for (j, termlist) in docs_terms:
 *             doc_terms = deserialize_via_marshal(termlist)             # <<<<<<<<<<<<<<
 *             try:
 *                 for (t, tf) in doc_terms.iteritems():
 */
      __pyx_t_10 = __pyx_f_22bibrank_word_indexer_c_deserialize_via_marshal(__pyx_v_termlist); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 181; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_DECREF(__pyx_v_doc_terms);
      __pyx_v_doc_terms = __pyx_t_10;
      __pyx_t_10 = 0;

      /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":182
 *         for (j, termlist) in docs_terms:
 *             doc_terms = deserialize_via_marshal(termlist)
 *             try:             # <<<<<<<<<<<<<<
 *                 for (t, tf) in doc_terms.iteritems():
 *                     if Gi.has_key(t):
 */
      {
        PyObject *__pyx_save_exc_type, *__pyx_save_exc_value, *__pyx_save_exc_tb;
        __Pyx_ExceptionSave(&__pyx_save_exc_type, &__pyx_save_exc_value, &__pyx_save_exc_tb);
        __Pyx_XGOTREF(__pyx_save_exc_type);
        __Pyx_XGOTREF(__pyx_save_exc_value);
        __Pyx_XGOTREF(__pyx_save_exc_tb);
        /*try:*/ {

          /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":183
 *             doc_terms = deserialize_via_marshal(termlist)
 *             try:
 *                 for (t, tf) in doc_terms.iteritems():             # <<<<<<<<<<<<<<
 *                     if Gi.has_key(t):
 *                         Nj[j] = Nj.get(j, 0) + (Gi[t] * (logf(1 + tf[0]))) ** 2
 */
          __pyx_t_10 = PyObject_GetAttr(__pyx_v_doc_terms, __pyx_kp_iteritems); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 183; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
          __Pyx_GOTREF(__pyx_t_10);
          __pyx_t_14 = PyObject_Call(__pyx_t_10, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 183; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
          __Pyx_GOTREF(__pyx_t_14);
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          if (PyList_CheckExact(__pyx_t_14) || PyTuple_CheckExact(__pyx_t_14)) {
            __pyx_t_11 = 0; __pyx_t_10 = __pyx_t_14; __Pyx_INCREF(__pyx_t_10);
          } else {
            __pyx_t_11 = -1; __pyx_t_10 = PyObject_GetIter(__pyx_t_14); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 183; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
            __Pyx_GOTREF(__pyx_t_10);
          }
          __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
          for (;;) {
            if (likely(PyList_CheckExact(__pyx_t_10))) {
              if (__pyx_t_11 >= PyList_GET_SIZE(__pyx_t_10)) break;
              __pyx_t_14 = PyList_GET_ITEM(__pyx_t_10, __pyx_t_11); __Pyx_INCREF(__pyx_t_14); __pyx_t_11++;
            } else if (likely(PyTuple_CheckExact(__pyx_t_10))) {
              if (__pyx_t_11 >= PyTuple_GET_SIZE(__pyx_t_10)) break;
              __pyx_t_14 = PyTuple_GET_ITEM(__pyx_t_10, __pyx_t_11); __Pyx_INCREF(__pyx_t_14); __pyx_t_11++;
            } else {
              __pyx_t_14 = PyIter_Next(__pyx_t_10);
              if (!__pyx_t_14) {
                if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 183; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
                break;
              }
              __Pyx_GOTREF(__pyx_t_14);
            }
            if (PyTuple_CheckExact(__pyx_t_14) && likely(PyTuple_GET_SIZE(__pyx_t_14) == 2)) {
              PyObject* tuple = __pyx_t_14;
              __pyx_1 = PyTuple_GET_ITEM(tuple, 0); __Pyx_INCREF(__pyx_1);
              if (!(likely(PyString_CheckExact(__pyx_1)) || (__pyx_1) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected str, got %s", Py_TYPE(__pyx_1)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 183; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
              __pyx_2 = PyTuple_GET_ITEM(tuple, 1); __Pyx_INCREF(__pyx_2);
              if (!(likely(PyTuple_CheckExact(__pyx_2)) || (__pyx_2) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected tuple, got %s", Py_TYPE(__pyx_2)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 183; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
              __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
              __Pyx_DECREF(((PyObject *)__pyx_v_t));
              __pyx_v_t = ((PyObject *)__pyx_1);
              __pyx_1 = 0;
              __Pyx_DECREF(((PyObject *)__pyx_v_tf));
              __pyx_v_tf = ((PyObject *)__pyx_2);
              __pyx_2 = 0;
            } else {
              __pyx_3 = PyObject_GetIter(__pyx_t_14); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 183; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
              __Pyx_GOTREF(__pyx_3);
              __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
              __pyx_1 = __Pyx_UnpackItem(__pyx_3, 0); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 183; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
              __Pyx_GOTREF(__pyx_1);
              if (!(likely(PyString_CheckExact(__pyx_1)) || (__pyx_1) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected str, got %s", Py_TYPE(__pyx_1)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 183; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
              __pyx_2 = __Pyx_UnpackItem(__pyx_3, 1); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 183; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
              __Pyx_GOTREF(__pyx_2);
              if (!(likely(PyTuple_CheckExact(__pyx_2)) || (__pyx_2) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected tuple, got %s", Py_TYPE(__pyx_2)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 183; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
              if (__Pyx_EndUnpack(__pyx_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 183; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
              __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
              __Pyx_DECREF(((PyObject *)__pyx_v_t));
              __pyx_v_t = ((PyObject *)__pyx_1);
              __pyx_1 = 0;
              __Pyx_DECREF(((PyObject *)__pyx_v_tf));
              __pyx_v_tf = ((PyObject *)__pyx_2);
              __pyx_2 = 0;
            }

            /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":184
 *             try:
 *                 for (t, tf) in doc_terms.iteritems():
 *                     if Gi.has_key(t):             # <<<<<<<<<<<<<<
 *                         Nj[j] = Nj.get(j, 0) + (Gi[t] * (logf(1 + tf[0]))) ** 2
 *                         Git = <int>(floorf(Gi[t]*100))
 */
            __pyx_t_14 = PyObject_GetAttr(((PyObject *)__pyx_v_Gi), __pyx_kp_has_key); if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 184; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
            __Pyx_GOTREF(__pyx_t_14);
            __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 184; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
            __Pyx_GOTREF(((PyObject *)__pyx_t_3));
            __Pyx_INCREF(((PyObject *)__pyx_v_t));
            PyTuple_SET_ITEM(__pyx_t_3, 0, ((PyObject *)__pyx_v_t));
            __Pyx_GIVEREF(((PyObject *)__pyx_v_t));
            __pyx_t_9 = PyObject_Call(__pyx_t_14, ((PyObject *)__pyx_t_3), NULL); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 184; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
            __Pyx_GOTREF(__pyx_t_9);
            __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
            __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
            __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_9); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 184; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
            __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
            if (__pyx_t_5) {

              /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":185
 *                 for (t, tf) in doc_terms.iteritems():
 *                     if Gi.has_key(t):
 *                         Nj[j] = Nj.get(j, 0) + (Gi[t] * (logf(1 + tf[0]))) ** 2             # <<<<<<<<<<<<<<
 *                         Git = <int>(floorf(Gi[t]*100))
 *                         if Git >= 0:
 */
              __pyx_t_9 = PyObject_GetAttr(((PyObject *)__pyx_v_Nj), __pyx_kp_get); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 185; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
              __Pyx_GOTREF(__pyx_t_9);
              __pyx_t_3 = PyInt_FromLong(__pyx_v_j); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 185; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
              __Pyx_GOTREF(__pyx_t_3);
              __pyx_t_14 = PyTuple_New(2); if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 185; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
              __Pyx_GOTREF(((PyObject *)__pyx_t_14));
              PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_t_3);
              __Pyx_GIVEREF(__pyx_t_3);
              __Pyx_INCREF(__pyx_int_0);
              PyTuple_SET_ITEM(__pyx_t_14, 1, __pyx_int_0);
              __Pyx_GIVEREF(__pyx_int_0);
              __pyx_t_3 = 0;
              __pyx_t_3 = PyObject_Call(__pyx_t_9, ((PyObject *)__pyx_t_14), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 185; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
              __Pyx_GOTREF(__pyx_t_3);
              __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
              __Pyx_DECREF(((PyObject *)__pyx_t_14)); __pyx_t_14 = 0;
              __pyx_3 = PyObject_GetItem(((PyObject *)__pyx_v_Gi), ((PyObject *)__pyx_v_t)); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 185; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
              __Pyx_GOTREF(__pyx_3);
              __pyx_1 = __Pyx_GetItemInt_Tuple(((PyObject *)__pyx_v_tf), 0, sizeof(long), PyInt_FromLong); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 185; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
              __Pyx_GOTREF(__pyx_1);
              __pyx_t_14 = PyNumber_Add(__pyx_int_1, __pyx_1); if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 185; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
              __Pyx_GOTREF(__pyx_t_14);
              __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
              __pyx_t_2 = __pyx_PyFloat_AsDouble(__pyx_t_14); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 185; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
              __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
              __pyx_t_14 = PyFloat_FromDouble(logf(__pyx_t_2)); if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 185; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
              __Pyx_GOTREF(__pyx_t_14);
              __pyx_t_9 = PyNumber_Multiply(__pyx_3, __pyx_t_14); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 185; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
              __Pyx_GOTREF(__pyx_t_9);
              __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
              __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
              __pyx_t_14 = PyNumber_Power(__pyx_t_9, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 185; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
              __Pyx_GOTREF(__pyx_t_14);
              __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
              __pyx_t_9 = PyNumber_Add(__pyx_t_3, __pyx_t_14); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 185; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
              __Pyx_GOTREF(__pyx_t_9);
              __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
              __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
              if (__Pyx_SetItemInt(((PyObject *)__pyx_v_Nj), __pyx_v_j, __pyx_t_9, sizeof(int), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 185; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
              __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;

              /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":186
 *                     if Gi.has_key(t):
 *                         Nj[j] = Nj.get(j, 0) + (Gi[t] * (logf(1 + tf[0]))) ** 2
 *                         Git = <int>(floorf(Gi[t]*100))             # <<<<<<<<<<<<<<
 *                         if Git >= 0:
 *                             Git += 1
 */
              __pyx_2 = PyObject_GetItem(((PyObject *)__pyx_v_Gi), ((PyObject *)__pyx_v_t)); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 186; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
              __Pyx_GOTREF(__pyx_2);
              __pyx_t_9 = PyNumber_Multiply(__pyx_2, __pyx_int_100); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 186; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
              __Pyx_GOTREF(__pyx_t_9);
              __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
              __pyx_t_2 = __pyx_PyFloat_AsDouble(__pyx_t_9); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 186; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
              __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
              __pyx_t_9 = PyInt_FromLong(((int)floorf(__pyx_t_2))); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 186; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
              __Pyx_GOTREF(__pyx_t_9);
              __Pyx_DECREF(__pyx_v_Git);
              __pyx_v_Git = __pyx_t_9;
              __pyx_t_9 = 0;

              /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":187
 *                         Nj[j] = Nj.get(j, 0) + (Gi[t] * (logf(1 + tf[0]))) ** 2
 *                         Git = <int>(floorf(Gi[t]*100))
 *                         if Git >= 0:             # <<<<<<<<<<<<<<
 *                             Git += 1
 *                         doc_terms[t] = (tf[0], Git)
 */
              __pyx_t_9 = PyObject_RichCompare(__pyx_v_Git, __pyx_int_0, Py_GE); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 187; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
              __Pyx_GOTREF(__pyx_t_9);
              __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_9); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 187; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
              __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
              if (__pyx_t_5) {

                /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":188
 *                         Git = <int>(floorf(Gi[t]*100))
 *                         if Git >= 0:
 *                             Git += 1             # <<<<<<<<<<<<<<
 *                         doc_terms[t] = (tf[0], Git)
 *                     else:
 */
                __pyx_1 = PyNumber_InPlaceAdd(__pyx_v_Git, __pyx_int_1); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 188; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
                __Pyx_GOTREF(__pyx_1);
                __Pyx_DECREF(__pyx_v_Git);
                __pyx_v_Git = __pyx_1;
                __pyx_1 = 0;
                goto __pyx_L64;
              }
              __pyx_L64:;

              /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":189
 *                         if Git >= 0:
 *                             Git += 1
 *                         doc_terms[t] = (tf[0], Git)             # <<<<<<<<<<<<<<
 *                     else:
 *                         Nj[j] = Nj.get(j, 0) + (tf[1] * (logf(1 + tf[0]))) ** 2
 */
              __pyx_3 = __Pyx_GetItemInt_Tuple(((PyObject *)__pyx_v_tf), 0, sizeof(long), PyInt_FromLong); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 189; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
              __Pyx_GOTREF(__pyx_3);
              __pyx_t_9 = PyTuple_New(2); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 189; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
              __Pyx_GOTREF(((PyObject *)__pyx_t_9));
              PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_3);
              __Pyx_GIVEREF(__pyx_3);
              __Pyx_INCREF(__pyx_v_Git);
              PyTuple_SET_ITEM(__pyx_t_9, 1, __pyx_v_Git);
              __Pyx_GIVEREF(__pyx_v_Git);
              __pyx_3 = 0;
              if (PyObject_SetItem(__pyx_v_doc_terms, ((PyObject *)__pyx_v_t), ((PyObject *)__pyx_t_9)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 189; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
              __Pyx_DECREF(((PyObject *)__pyx_t_9)); __pyx_t_9 = 0;
              goto __pyx_L63;
            }
            /*else*/ {

              /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":191
 *                         doc_terms[t] = (tf[0], Git)
 *                     else:
 *                         Nj[j] = Nj.get(j, 0) + (tf[1] * (logf(1 + tf[0]))) ** 2             # <<<<<<<<<<<<<<
 *                 Nj[j] = 1.0 / sqrtf(Nj[j])
 *                 Nj[j] = <int>(Nj[j] * 100)
 */
              __pyx_t_9 = PyObject_GetAttr(((PyObject *)__pyx_v_Nj), __pyx_kp_get); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 191; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
              __Pyx_GOTREF(__pyx_t_9);
              __pyx_t_14 = PyInt_FromLong(__pyx_v_j); if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 191; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
              __Pyx_GOTREF(__pyx_t_14);
              __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 191; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
              __Pyx_GOTREF(((PyObject *)__pyx_t_3));
              PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_14);
              __Pyx_GIVEREF(__pyx_t_14);
              __Pyx_INCREF(__pyx_int_0);
              PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_int_0);
              __Pyx_GIVEREF(__pyx_int_0);
              __pyx_t_14 = 0;
              __pyx_t_14 = PyObject_Call(__pyx_t_9, ((PyObject *)__pyx_t_3), NULL); if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 191; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
              __Pyx_GOTREF(__pyx_t_14);
              __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
              __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
              __pyx_2 = __Pyx_GetItemInt_Tuple(((PyObject *)__pyx_v_tf), 1, sizeof(long), PyInt_FromLong); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 191; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
              __Pyx_GOTREF(__pyx_2);
              __pyx_1 = __Pyx_GetItemInt_Tuple(((PyObject *)__pyx_v_tf), 0, sizeof(long), PyInt_FromLong); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 191; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
              __Pyx_GOTREF(__pyx_1);
              __pyx_t_3 = PyNumber_Add(__pyx_int_1, __pyx_1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 191; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
              __Pyx_GOTREF(__pyx_t_3);
              __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
              __pyx_t_2 = __pyx_PyFloat_AsDouble(__pyx_t_3); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 191; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
              __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
              __pyx_t_3 = PyFloat_FromDouble(logf(__pyx_t_2)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 191; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
              __Pyx_GOTREF(__pyx_t_3);
              __pyx_t_9 = PyNumber_Multiply(__pyx_2, __pyx_t_3); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 191; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
              __Pyx_GOTREF(__pyx_t_9);
              __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
              __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
              __pyx_t_3 = PyNumber_Power(__pyx_t_9, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 191; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
              __Pyx_GOTREF(__pyx_t_3);
              __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
              __pyx_t_9 = PyNumber_Add(__pyx_t_14, __pyx_t_3); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 191; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
              __Pyx_GOTREF(__pyx_t_9);
              __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
              __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
              if (__Pyx_SetItemInt(((PyObject *)__pyx_v_Nj), __pyx_v_j, __pyx_t_9, sizeof(int), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 191; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
              __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
            }
            __pyx_L63:;
          }
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

          /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":192
 *                     else:
 *                         Nj[j] = Nj.get(j, 0) + (tf[1] * (logf(1 + tf[0]))) ** 2
 *                 Nj[j] = 1.0 / sqrtf(Nj[j])             # <<<<<<<<<<<<<<
 *                 Nj[j] = <int>(Nj[j] * 100)
 *                 if Nj[j] >= 0:
 */
          __pyx_3 = __Pyx_GetItemInt(((PyObject *)__pyx_v_Nj), __pyx_v_j, sizeof(int), PyInt_FromLong); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 192; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
          __Pyx_GOTREF(__pyx_3);
          __pyx_t_2 = __pyx_PyFloat_AsDouble(__pyx_3); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 192; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
          __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
          __pyx_t_10 = PyFloat_FromDouble((1.0 / sqrtf(__pyx_t_2))); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 192; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
          __Pyx_GOTREF(__pyx_t_10);
          if (__Pyx_SetItemInt(((PyObject *)__pyx_v_Nj), __pyx_v_j, __pyx_t_10, sizeof(int), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 192; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

          /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":193
 *                         Nj[j] = Nj.get(j, 0) + (tf[1] * (logf(1 + tf[0]))) ** 2
 *                 Nj[j] = 1.0 / sqrtf(Nj[j])
 *                 Nj[j] = <int>(Nj[j] * 100)             # <<<<<<<<<<<<<<
 *                 if Nj[j] >= 0:
 *                     Nj[j] += 1
 */
          __pyx_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_Nj), __pyx_v_j, sizeof(int), PyInt_FromLong); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 193; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
          __Pyx_GOTREF(__pyx_1);
          __pyx_t_10 = PyNumber_Multiply(__pyx_1, __pyx_int_100); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 193; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
          __Pyx_GOTREF(__pyx_t_10);
          __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
          __pyx_t_4 = __Pyx_PyInt_AsInt(__pyx_t_10); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 193; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          __pyx_t_10 = PyInt_FromLong(((int)__pyx_t_4)); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 193; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
          __Pyx_GOTREF(__pyx_t_10);
          if (__Pyx_SetItemInt(((PyObject *)__pyx_v_Nj), __pyx_v_j, __pyx_t_10, sizeof(int), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 193; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

          /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":194
 *                 Nj[j] = 1.0 / sqrtf(Nj[j])
 *                 Nj[j] = <int>(Nj[j] * 100)
 *                 if Nj[j] >= 0:             # <<<<<<<<<<<<<<
 *                     Nj[j] += 1
 *                 run_sql("UPDATE %sR SET termlist=%%s WHERE id_bibrec=%%s" % table[:-1],
 */
          __pyx_2 = __Pyx_GetItemInt(((PyObject *)__pyx_v_Nj), __pyx_v_j, sizeof(int), PyInt_FromLong); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 194; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
          __Pyx_GOTREF(__pyx_2);
          __pyx_t_10 = PyObject_RichCompare(__pyx_2, __pyx_int_0, Py_GE); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 194; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
          __Pyx_GOTREF(__pyx_t_10);
          __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
          __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_10); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 194; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          if (__pyx_t_5) {

            /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":195
 *                 Nj[j] = <int>(Nj[j] * 100)
 *                 if Nj[j] >= 0:
 *                     Nj[j] += 1             # <<<<<<<<<<<<<<
 *                 run_sql("UPDATE %sR SET termlist=%%s WHERE id_bibrec=%%s" % table[:-1],
 *                         (serialize_via_marshal(doc_terms), j))
 */
            __pyx_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_Nj), __pyx_v_j, sizeof(int), PyInt_FromLong); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 195; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
            __Pyx_GOTREF(__pyx_1);
            __pyx_3 = PyNumber_InPlaceAdd(__pyx_1, __pyx_int_1); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 195; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
            __Pyx_GOTREF(__pyx_3);
            __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
            if (__Pyx_SetItemInt(((PyObject *)__pyx_v_Nj), __pyx_v_j, __pyx_3, sizeof(int), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 195; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
            __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
            goto __pyx_L65;
          }
          __pyx_L65:;

          /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":196
 *                 if Nj[j] >= 0:
 *                     Nj[j] += 1
 *                 run_sql("UPDATE %sR SET termlist=%%s WHERE id_bibrec=%%s" % table[:-1],             # <<<<<<<<<<<<<<
 *                         (serialize_via_marshal(doc_terms), j))
 *             except (ZeroDivisionError, OverflowError), e:
 */
          __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_kp_run_sql); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
          __Pyx_GOTREF(__pyx_2);
          __pyx_1 = PySequence_GetSlice(((PyObject *)__pyx_v_table), 0, -1); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
          __Pyx_GOTREF(((PyObject *)__pyx_1));
          __pyx_t_10 = PyNumber_Remainder(__pyx_kp_55, ((PyObject *)__pyx_1)); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
          __Pyx_GOTREF(__pyx_t_10);
          __Pyx_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;

          /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":197
 *                     Nj[j] += 1
 *                 run_sql("UPDATE %sR SET termlist=%%s WHERE id_bibrec=%%s" % table[:-1],
 *                         (serialize_via_marshal(doc_terms), j))             # <<<<<<<<<<<<<<
 *             except (ZeroDivisionError, OverflowError), e:
 *                 ## This is to try to isolate division by zero errors.
 */
          __pyx_t_9 = __pyx_f_22bibrank_word_indexer_c_serialize_via_marshal(__pyx_v_doc_terms); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 197; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
          __Pyx_GOTREF(__pyx_t_9);
          __pyx_t_3 = PyInt_FromLong(__pyx_v_j); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 197; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
          __Pyx_GOTREF(__pyx_t_3);
          __pyx_t_14 = PyTuple_New(2); if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 197; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
          __Pyx_GOTREF(((PyObject *)__pyx_t_14));
          PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_t_9);
          __Pyx_GIVEREF(__pyx_t_9);
          PyTuple_SET_ITEM(__pyx_t_14, 1, __pyx_t_3);
          __Pyx_GIVEREF(__pyx_t_3);
          __pyx_t_9 = 0;
          __pyx_t_3 = 0;
          __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
          __Pyx_GOTREF(((PyObject *)__pyx_t_3));
          PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_10);
          __Pyx_GIVEREF(__pyx_t_10);
          PyTuple_SET_ITEM(__pyx_t_3, 1, ((PyObject *)__pyx_t_14));
          __Pyx_GIVEREF(((PyObject *)__pyx_t_14));
          __pyx_t_10 = 0;
          __pyx_t_14 = 0;
          __pyx_t_14 = PyObject_Call(__pyx_2, ((PyObject *)__pyx_t_3), NULL); if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L53_error;}
          __Pyx_GOTREF(__pyx_t_14);
          __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
          __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
          __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
        }
        __Pyx_XDECREF(__pyx_save_exc_type); __pyx_save_exc_type = 0;
        __Pyx_XDECREF(__pyx_save_exc_value); __pyx_save_exc_value = 0;
        __Pyx_XDECREF(__pyx_save_exc_tb); __pyx_save_exc_tb = 0;
        goto __pyx_L60_try_end;
        __pyx_L53_error:;
        __Pyx_XDECREF(__pyx_3); __pyx_3 = 0;
        __Pyx_XDECREF(__pyx_1); __pyx_1 = 0;
        __Pyx_XDECREF(__pyx_2); __pyx_2 = 0;
        __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
        __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
        __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;

        /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":198
 *                 run_sql("UPDATE %sR SET termlist=%%s WHERE id_bibrec=%%s" % table[:-1],
 *                         (serialize_via_marshal(doc_terms), j))
 *             except (ZeroDivisionError, OverflowError), e:             # <<<<<<<<<<<<<<
 *                 ## This is to try to isolate division by zero errors.
 *                 register_exception(prefix="Error when analysing the record %s (%s): %s\n" % (j, repr(docs_terms), e), alert_admin=True)
 */
        __pyx_t_14 = PyTuple_New(2); if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 198; __pyx_clineno = __LINE__; goto __pyx_L55_except_error;}
        __Pyx_GOTREF(((PyObject *)__pyx_t_14));
        __Pyx_INCREF(__pyx_builtin_ZeroDivisionError);
        PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_builtin_ZeroDivisionError);
        __Pyx_GIVEREF(__pyx_builtin_ZeroDivisionError);
        __Pyx_INCREF(__pyx_builtin_OverflowError);
        PyTuple_SET_ITEM(__pyx_t_14, 1, __pyx_builtin_OverflowError);
        __Pyx_GIVEREF(__pyx_builtin_OverflowError);
        __pyx_4 = PyErr_ExceptionMatches(((PyObject *)__pyx_t_14));
        __Pyx_DECREF(((PyObject *)__pyx_t_14)); __pyx_t_14 = 0;
        if (__pyx_4) {
          __Pyx_AddTraceback("bibrank_word_indexer_c.update_rnkWORD");
          if (__Pyx_GetException(&__pyx_3, &__pyx_1, &__pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 198; __pyx_clineno = __LINE__; goto __pyx_L55_except_error;}
          __Pyx_GOTREF(__pyx_3);
          __Pyx_GOTREF(__pyx_1);
          __Pyx_GOTREF(__pyx_2);
          __Pyx_INCREF(__pyx_1);
          __Pyx_DECREF(__pyx_v_e);
          __pyx_v_e = __pyx_1;

          /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":200
 *             except (ZeroDivisionError, OverflowError), e:
 *                 ## This is to try to isolate division by zero errors.
 *                 register_exception(prefix="Error when analysing the record %s (%s): %s\n" % (j, repr(docs_terms), e), alert_admin=True)             # <<<<<<<<<<<<<<
 *         write_message("Phase 4: ......processed %s/%s records" % ((i+5000>len(records) and len(records) or (i+5000)), len(records)))
 *         task_update_progress("Post-processing phase 4: %s/%s records" % ((i+5000>len(records) and len(records) or (i+5000)), len(records)))
 */
          __pyx_5 = __Pyx_GetName(__pyx_m, __pyx_kp_register_exception); if (unlikely(!__pyx_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 200; __pyx_clineno = __LINE__; goto __pyx_L55_except_error;}
          __Pyx_GOTREF(__pyx_5);
          __pyx_6 = PyDict_New(); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 200; __pyx_clineno = __LINE__; goto __pyx_L55_except_error;}
          __Pyx_GOTREF(((PyObject *)__pyx_6));
          __pyx_t_14 = PyInt_FromLong(__pyx_v_j); if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 200; __pyx_clineno = __LINE__; goto __pyx_L55_except_error;}
          __Pyx_GOTREF(__pyx_t_14);
          __pyx_t_3 = PyObject_Repr(((PyObject *)__pyx_v_docs_terms)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 200; __pyx_clineno = __LINE__; goto __pyx_L55_except_error;}
          __Pyx_GOTREF(__pyx_t_3);
          __pyx_t_10 = PyTuple_New(3); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 200; __pyx_clineno = __LINE__; goto __pyx_L55_except_error;}
          __Pyx_GOTREF(((PyObject *)__pyx_t_10));
          PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_14);
          __Pyx_GIVEREF(__pyx_t_14);
          PyTuple_SET_ITEM(__pyx_t_10, 1, __pyx_t_3);
          __Pyx_GIVEREF(__pyx_t_3);
          __Pyx_INCREF(__pyx_v_e);
          PyTuple_SET_ITEM(__pyx_t_10, 2, __pyx_v_e);
          __Pyx_GIVEREF(__pyx_v_e);
          __pyx_t_14 = 0;
          __pyx_t_3 = 0;
          __pyx_t_3 = PyNumber_Remainder(__pyx_kp_56, ((PyObject *)__pyx_t_10)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 200; __pyx_clineno = __LINE__; goto __pyx_L55_except_error;}
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_DECREF(((PyObject *)__pyx_t_10)); __pyx_t_10 = 0;
          if (PyDict_SetItem(__pyx_6, __pyx_kp_prefix, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 200; __pyx_clineno = __LINE__; goto __pyx_L55_except_error;}
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_t_3 = __Pyx_PyBool_FromLong(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 200; __pyx_clineno = __LINE__; goto __pyx_L55_except_error;}
          __Pyx_GOTREF(__pyx_t_3);
          if (PyDict_SetItem(__pyx_6, __pyx_kp_alert_admin, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 200; __pyx_clineno = __LINE__; goto __pyx_L55_except_error;}
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_t_3 = PyEval_CallObjectWithKeywords(__pyx_5, ((PyObject *)__pyx_empty_tuple), ((PyObject *)__pyx_6)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 200; __pyx_clineno = __LINE__; goto __pyx_L55_except_error;}
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_DECREF(__pyx_5); __pyx_5 = 0;
          __Pyx_DECREF(((PyObject *)__pyx_6)); __pyx_6 = 0;
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
          __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
          __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
          goto __pyx_L54_exception_handled;
        }
        __pyx_L55_except_error:;
        __Pyx_XDECREF(__pyx_save_exc_type);
        __Pyx_XDECREF(__pyx_save_exc_value);
        __Pyx_XDECREF(__pyx_save_exc_tb);
        goto __pyx_L1_error;
        __pyx_L54_exception_handled:;
        __Pyx_XGIVEREF(__pyx_save_exc_type);
        __Pyx_XGIVEREF(__pyx_save_exc_value);
        __Pyx_XGIVEREF(__pyx_save_exc_tb);
        __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
        __pyx_L60_try_end:;
      }
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":201
 *                 ## This is to try to isolate division by zero errors.
 *                 register_exception(prefix="Error when analysing the record %s (%s): %s\n" % (j, repr(docs_terms), e), alert_admin=True)
 *         write_message("Phase 4: ......processed %s/%s records" % ((i+5000>len(records) and len(records) or (i+5000)), len(records)))             # <<<<<<<<<<<<<<
 *         task_update_progress("Post-processing phase 4: %s/%s records" % ((i+5000>len(records) and len(records) or (i+5000)), len(records)))
 *         i += 5000
 */
    __pyx_5 = __Pyx_GetName(__pyx_m, __pyx_kp_write_message); if (unlikely(!__pyx_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 201; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_5);
    __pyx_t_8 = PyObject_Length(((PyObject *)__pyx_v_records)); if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 201; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    if (((__pyx_v_i + 5000) > __pyx_t_8)) {
      __pyx_t_11 = PyObject_Length(((PyObject *)__pyx_v_records)); if (unlikely(__pyx_t_11 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 201; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_t_5 = __pyx_t_11;
    } else {
      __pyx_t_5 = ((__pyx_v_i + 5000) > __pyx_t_8);
    }
    if (!__pyx_t_5) {
      __pyx_t_7 = (__pyx_v_i + 5000);
    } else {
      __pyx_t_7 = __pyx_t_5;
    }
    __pyx_t_1 = __Pyx_PyBool_FromLong(__pyx_t_7); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 201; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_8 = PyObject_Length(((PyObject *)__pyx_v_records)); if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 201; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_3 = PyInt_FromSsize_t(__pyx_t_8); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 201; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_10 = PyTuple_New(2); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 201; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_10));
    PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_1);
    __Pyx_GIVEREF(__pyx_t_1);
    PyTuple_SET_ITEM(__pyx_t_10, 1, __pyx_t_3);
    __Pyx_GIVEREF(__pyx_t_3);
    __pyx_t_1 = 0;
    __pyx_t_3 = 0;
    __pyx_t_3 = PyNumber_Remainder(__pyx_kp_57, ((PyObject *)__pyx_t_10)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 201; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(((PyObject *)__pyx_t_10)); __pyx_t_10 = 0;
    __pyx_t_10 = PyTuple_New(1); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 201; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_10));
    PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_3);
    __Pyx_GIVEREF(__pyx_t_3);
    __pyx_t_3 = 0;
    __pyx_t_3 = PyObject_Call(__pyx_5, ((PyObject *)__pyx_t_10), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 201; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_5); __pyx_5 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_10)); __pyx_t_10 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":202
 *                 register_exception(prefix="Error when analysing the record %s (%s): %s\n" % (j, repr(docs_terms), e), alert_admin=True)
 *         write_message("Phase 4: ......processed %s/%s records" % ((i+5000>len(records) and len(records) or (i+5000)), len(records)))
 *         task_update_progress("Post-processing phase 4: %s/%s records" % ((i+5000>len(records) and len(records) or (i+5000)), len(records)))             # <<<<<<<<<<<<<<
 *         i += 5000
 *         task_sleep_now_if_required()
 */
    __pyx_6 = __Pyx_GetName(__pyx_m, __pyx_kp_5); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_6);
    __pyx_t_8 = PyObject_Length(((PyObject *)__pyx_v_records)); if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    if (((__pyx_v_i + 5000) > __pyx_t_8)) {
      __pyx_t_11 = PyObject_Length(((PyObject *)__pyx_v_records)); if (unlikely(__pyx_t_11 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_t_7 = __pyx_t_11;
    } else {
      __pyx_t_7 = ((__pyx_v_i + 5000) > __pyx_t_8);
    }
    if (!__pyx_t_7) {
      __pyx_t_5 = (__pyx_v_i + 5000);
    } else {
      __pyx_t_5 = __pyx_t_7;
    }
    __pyx_t_3 = __Pyx_PyBool_FromLong(__pyx_t_5); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_8 = PyObject_Length(((PyObject *)__pyx_v_records)); if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_10 = PyInt_FromSsize_t(__pyx_t_8); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_10);
    __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_3);
    __Pyx_GIVEREF(__pyx_t_3);
    PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_10);
    __Pyx_GIVEREF(__pyx_t_10);
    __pyx_t_3 = 0;
    __pyx_t_10 = 0;
    __pyx_t_10 = PyNumber_Remainder(__pyx_kp_58, ((PyObject *)__pyx_t_1)); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_10);
    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_10);
    __Pyx_GIVEREF(__pyx_t_10);
    __pyx_t_10 = 0;
    __pyx_t_10 = PyObject_Call(__pyx_6, ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_10);
    __Pyx_DECREF(__pyx_6); __pyx_6 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

    /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":203
 *         write_message("Phase 4: ......processed %s/%s records" % ((i+5000>len(records) and len(records) or (i+5000)), len(records)))
 *         task_update_progress("Post-processing phase 4: %s/%s records" % ((i+5000>len(records) and len(records) or (i+5000)), len(records)))
 *         i += 5000             # <<<<<<<<<<<<<<
 *         task_sleep_now_if_required()
 *     write_message("Phase 4: Finished calculating normalization value for all affected records and updating %sR" % table[:-1])
 */
    __pyx_v_i += 5000;

    /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":204
 *         task_update_progress("Post-processing phase 4: %s/%s records" % ((i+5000>len(records) and len(records) or (i+5000)), len(records)))
 *         i += 5000
 *         task_sleep_now_if_required()             # <<<<<<<<<<<<<<
 *     write_message("Phase 4: Finished calculating normalization value for all affected records and updating %sR" % table[:-1])
 *     task_sleep_now_if_required()
 */
    __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_kp_6); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 204; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_3);
    __pyx_t_10 = PyObject_Call(__pyx_3, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 204; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_10);
    __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
  }

  /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":205
 *         i += 5000
 *         task_sleep_now_if_required()
 *     write_message("Phase 4: Finished calculating normalization value for all affected records and updating %sR" % table[:-1])             # <<<<<<<<<<<<<<
 *     task_sleep_now_if_required()
 *     write_message("Phase 5: Updating %s with new normalization values" % table)
 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_write_message); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __pyx_2 = PySequence_GetSlice(((PyObject *)__pyx_v_table), 0, -1); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_2));
  __pyx_t_10 = PyNumber_Remainder(__pyx_kp_59, ((PyObject *)__pyx_2)); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_10);
  __Pyx_DECREF(((PyObject *)__pyx_2)); __pyx_2 = 0;
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_10);
  __Pyx_GIVEREF(__pyx_t_10);
  __pyx_t_10 = 0;
  __pyx_t_10 = PyObject_Call(__pyx_1, ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_10);
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

  /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":206
 *         task_sleep_now_if_required()
 *     write_message("Phase 4: Finished calculating normalization value for all affected records and updating %sR" % table[:-1])
 *     task_sleep_now_if_required()             # <<<<<<<<<<<<<<
 *     write_message("Phase 5: Updating %s with new normalization values" % table)
 *     i = 0
 */
  __pyx_5 = __Pyx_GetName(__pyx_m, __pyx_kp_6); if (unlikely(!__pyx_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 206; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_5);
  __pyx_t_10 = PyObject_Call(__pyx_5, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 206; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_10);
  __Pyx_DECREF(__pyx_5); __pyx_5 = 0;
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

  /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":207
 *     write_message("Phase 4: Finished calculating normalization value for all affected records and updating %sR" % table[:-1])
 *     task_sleep_now_if_required()
 *     write_message("Phase 5: Updating %s with new normalization values" % table)             # <<<<<<<<<<<<<<
 *     i = 0
 *     terms = Gi.keys()
 */
  __pyx_6 = __Pyx_GetName(__pyx_m, __pyx_kp_write_message); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 207; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_6);
  __pyx_t_10 = PyNumber_Remainder(__pyx_kp_60, ((PyObject *)__pyx_v_table)); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 207; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_10);
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 207; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_10);
  __Pyx_GIVEREF(__pyx_t_10);
  __pyx_t_10 = 0;
  __pyx_t_10 = PyObject_Call(__pyx_6, ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 207; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_10);
  __Pyx_DECREF(__pyx_6); __pyx_6 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

  /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":208
 *     task_sleep_now_if_required()
 *     write_message("Phase 5: Updating %s with new normalization values" % table)
 *     i = 0             # <<<<<<<<<<<<<<
 *     terms = Gi.keys()
 *     while i < len(terms):
 */
  __pyx_v_i = 0;

  /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":209
 *     write_message("Phase 5: Updating %s with new normalization values" % table)
 *     i = 0
 *     terms = Gi.keys()             # <<<<<<<<<<<<<<
 *     while i < len(terms):
 *         #Adding the Gi value to each term, and adding the normalization value to each term in each document.
 */
  __pyx_t_10 = PyDict_Keys(((PyObject *)__pyx_v_Gi)); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 209; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_10);
  if (!(likely(PyList_CheckExact(__pyx_t_10)) || (__pyx_t_10) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected list, got %s", Py_TYPE(__pyx_t_10)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 209; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(((PyObject *)__pyx_v_terms));
  __pyx_v_terms = ((PyObject *)__pyx_t_10);
  __pyx_t_10 = 0;

  /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":210
 *     i = 0
 *     terms = Gi.keys()
 *     while i < len(terms):             # <<<<<<<<<<<<<<
 *         #Adding the Gi value to each term, and adding the normalization value to each term in each document.
 *         terms_docs = get_from_forward_index(terms, i, (i+5000), table)
 */
  while (1) {
    __pyx_t_8 = PyObject_Length(((PyObject *)__pyx_v_terms)); if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 210; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_5 = (__pyx_v_i < __pyx_t_8);
    if (!__pyx_t_5) break;

    /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":212
 *     while i < len(terms):
 *         #Adding the Gi value to each term, and adding the normalization value to each term in each document.
 *         terms_docs = get_from_forward_index(terms, i, (i+5000), table)             # <<<<<<<<<<<<<<
 *         for (t, hitlist) in terms_docs:
 *             try:
 */
    __pyx_t_10 = __pyx_f_22bibrank_word_indexer_c_get_from_forward_index(__pyx_v_terms, __pyx_v_i, (__pyx_v_i + 5000), __pyx_v_table, 0); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 212; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_10);
    if (!(likely(PyTuple_CheckExact(__pyx_t_10)) || (__pyx_t_10) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected tuple, got %s", Py_TYPE(__pyx_t_10)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 212; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(((PyObject *)__pyx_v_terms_docs));
    __pyx_v_terms_docs = ((PyObject *)__pyx_t_10);
    __pyx_t_10 = 0;

    /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":213
 *         #Adding the Gi value to each term, and adding the normalization value to each term in each document.
 *         terms_docs = get_from_forward_index(terms, i, (i+5000), table)
 *         for (t, hitlist) in terms_docs:             # <<<<<<<<<<<<<<
 *             try:
 *                 term_docs = deserialize_via_marshal(hitlist)
 */
    if (likely(((PyObject *)__pyx_v_terms_docs) != Py_None)) {
      __pyx_t_8 = 0; __pyx_t_10 = ((PyObject *)__pyx_v_terms_docs); __Pyx_INCREF(__pyx_t_10);
    } else {
      PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable"); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    }
    for (;;) {
      if (__pyx_t_8 >= PyTuple_GET_SIZE(__pyx_t_10)) break;
      __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_10, __pyx_t_8); __Pyx_INCREF(__pyx_t_1); __pyx_t_8++;
      if (PyTuple_CheckExact(__pyx_t_1) && likely(PyTuple_GET_SIZE(__pyx_t_1) == 2)) {
        PyObject* tuple = __pyx_t_1;
        __pyx_2 = PyTuple_GET_ITEM(tuple, 0); __Pyx_INCREF(__pyx_2);
        if (!(likely(PyString_CheckExact(__pyx_2)) || (__pyx_2) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected str, got %s", Py_TYPE(__pyx_2)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __pyx_1 = PyTuple_GET_ITEM(tuple, 1); __Pyx_INCREF(__pyx_1);
        if (!(likely(PyString_CheckExact(__pyx_1)) || (__pyx_1) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected str, got %s", Py_TYPE(__pyx_1)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __Pyx_DECREF(((PyObject *)__pyx_v_t));
        __pyx_v_t = ((PyObject *)__pyx_2);
        __pyx_2 = 0;
        __Pyx_DECREF(((PyObject *)__pyx_v_hitlist));
        __pyx_v_hitlist = ((PyObject *)__pyx_1);
        __pyx_1 = 0;
      } else {
        __pyx_3 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_3);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_2 = __Pyx_UnpackItem(__pyx_3, 0); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_2);
        if (!(likely(PyString_CheckExact(__pyx_2)) || (__pyx_2) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected str, got %s", Py_TYPE(__pyx_2)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __pyx_1 = __Pyx_UnpackItem(__pyx_3, 1); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_GOTREF(__pyx_1);
        if (!(likely(PyString_CheckExact(__pyx_1)) || (__pyx_1) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected str, got %s", Py_TYPE(__pyx_1)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        if (__Pyx_EndUnpack(__pyx_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
        __Pyx_DECREF(((PyObject *)__pyx_v_t));
        __pyx_v_t = ((PyObject *)__pyx_2);
        __pyx_2 = 0;
        __Pyx_DECREF(((PyObject *)__pyx_v_hitlist));
        __pyx_v_hitlist = ((PyObject *)__pyx_1);
        __pyx_1 = 0;
      }

      /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":214
 *         terms_docs = get_from_forward_index(terms, i, (i+5000), table)
 *         for (t, hitlist) in terms_docs:
 *             try:             # <<<<<<<<<<<<<<
 *                 term_docs = deserialize_via_marshal(hitlist)
 *                 if term_docs.has_key("Gi"):
 */
      {
        PyObject *__pyx_save_exc_type, *__pyx_save_exc_value, *__pyx_save_exc_tb;
        __Pyx_ExceptionSave(&__pyx_save_exc_type, &__pyx_save_exc_value, &__pyx_save_exc_tb);
        __Pyx_XGOTREF(__pyx_save_exc_type);
        __Pyx_XGOTREF(__pyx_save_exc_value);
        __Pyx_XGOTREF(__pyx_save_exc_tb);
        /*try:*/ {

          /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":215
 *         for (t, hitlist) in terms_docs:
 *             try:
 *                 term_docs = deserialize_via_marshal(hitlist)             # <<<<<<<<<<<<<<
 *                 if term_docs.has_key("Gi"):
 *                     del term_docs["Gi"]
 */
          __pyx_t_1 = __pyx_f_22bibrank_word_indexer_c_deserialize_via_marshal(__pyx_v_hitlist); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 215; __pyx_clineno = __LINE__; goto __pyx_L72_error;}
          __Pyx_GOTREF(__pyx_t_1);
          if (!(likely(PyDict_CheckExact(__pyx_t_1)) || (__pyx_t_1) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected dict, got %s", Py_TYPE(__pyx_t_1)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 215; __pyx_clineno = __LINE__; goto __pyx_L72_error;}
          __Pyx_DECREF(((PyObject *)__pyx_v_term_docs));
          __pyx_v_term_docs = ((PyObject *)__pyx_t_1);
          __pyx_t_1 = 0;

          /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":216
 *             try:
 *                 term_docs = deserialize_via_marshal(hitlist)
 *                 if term_docs.has_key("Gi"):             # <<<<<<<<<<<<<<
 *                     del term_docs["Gi"]
 *                 for (j, tf) in term_docs.iteritems():
 */
          __pyx_t_1 = PyObject_GetAttr(((PyObject *)__pyx_v_term_docs), __pyx_kp_has_key); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 216; __pyx_clineno = __LINE__; goto __pyx_L72_error;}
          __Pyx_GOTREF(__pyx_t_1);
          __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 216; __pyx_clineno = __LINE__; goto __pyx_L72_error;}
          __Pyx_GOTREF(((PyObject *)__pyx_t_3));
          __Pyx_INCREF(__pyx_kp_61);
          PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_kp_61);
          __Pyx_GIVEREF(__pyx_kp_61);
          __pyx_t_14 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_3), NULL); if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 216; __pyx_clineno = __LINE__; goto __pyx_L72_error;}
          __Pyx_GOTREF(__pyx_t_14);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
          __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_14); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 216; __pyx_clineno = __LINE__; goto __pyx_L72_error;}
          __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
          if (__pyx_t_5) {

            /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":217
 *                 term_docs = deserialize_via_marshal(hitlist)
 *                 if term_docs.has_key("Gi"):
 *                     del term_docs["Gi"]             # <<<<<<<<<<<<<<
 *                 for (j, tf) in term_docs.iteritems():
 *                     if Nj.has_key(j):
 */
            if (PyDict_DelItem(((PyObject *)__pyx_v_term_docs), __pyx_kp_62) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 217; __pyx_clineno = __LINE__; goto __pyx_L72_error;}
            goto __pyx_L80;
          }
          __pyx_L80:;

          /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":218
 *                 if term_docs.has_key("Gi"):
 *                     del term_docs["Gi"]
 *                 for (j, tf) in term_docs.iteritems():             # <<<<<<<<<<<<<<
 *                     if Nj.has_key(j):
 *                         term_docs[j] = (tf[0], Nj[j])
 */
          __Pyx_INCREF(((PyObject *)__pyx_v_term_docs));
          __Pyx_XDECREF(__pyx_t_14);
          __pyx_t_14 = ((PyObject *)__pyx_v_term_docs);
          __pyx_t_11 = 0;
          while (1) {
            if (!PyDict_Next(__pyx_t_14, (&__pyx_t_11), ((PyObject **)(&__pyx_t_12)), ((PyObject **)(&__pyx_t_13)))) break;
            __pyx_t_4 = __Pyx_PyInt_AsInt(((PyObject *)__pyx_t_12)); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 218; __pyx_clineno = __LINE__; goto __pyx_L72_error;}
            __pyx_v_j = __pyx_t_4;
            if (!(likely(PyTuple_CheckExact(((PyObject *)__pyx_t_13))) || (((PyObject *)__pyx_t_13)) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected tuple, got %s", Py_TYPE(((PyObject *)__pyx_t_13))->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 218; __pyx_clineno = __LINE__; goto __pyx_L72_error;}
            __Pyx_INCREF(((PyObject *)((PyObject *)__pyx_t_13)));
            __Pyx_DECREF(((PyObject *)__pyx_v_tf));
            __pyx_v_tf = ((PyObject *)__pyx_t_13);

            /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":219
 *                     del term_docs["Gi"]
 *                 for (j, tf) in term_docs.iteritems():
 *                     if Nj.has_key(j):             # <<<<<<<<<<<<<<
 *                         term_docs[j] = (tf[0], Nj[j])
 *                 Git = <int>(floorf(Gi[t]*100))
 */
            __pyx_t_3 = PyObject_GetAttr(((PyObject *)__pyx_v_Nj), __pyx_kp_has_key); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 219; __pyx_clineno = __LINE__; goto __pyx_L72_error;}
            __Pyx_GOTREF(__pyx_t_3);
            __pyx_t_1 = PyInt_FromLong(__pyx_v_j); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 219; __pyx_clineno = __LINE__; goto __pyx_L72_error;}
            __Pyx_GOTREF(__pyx_t_1);
            __pyx_t_9 = PyTuple_New(1); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 219; __pyx_clineno = __LINE__; goto __pyx_L72_error;}
            __Pyx_GOTREF(((PyObject *)__pyx_t_9));
            PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_1);
            __Pyx_GIVEREF(__pyx_t_1);
            __pyx_t_1 = 0;
            __pyx_t_1 = PyObject_Call(__pyx_t_3, ((PyObject *)__pyx_t_9), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 219; __pyx_clineno = __LINE__; goto __pyx_L72_error;}
            __Pyx_GOTREF(__pyx_t_1);
            __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
            __Pyx_DECREF(((PyObject *)__pyx_t_9)); __pyx_t_9 = 0;
            __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 219; __pyx_clineno = __LINE__; goto __pyx_L72_error;}
            __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
            if (__pyx_t_5) {

              /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":220
 *                 for (j, tf) in term_docs.iteritems():
 *                     if Nj.has_key(j):
 *                         term_docs[j] = (tf[0], Nj[j])             # <<<<<<<<<<<<<<
 *                 Git = <int>(floorf(Gi[t]*100))
 *                 if Git >= 0:
 */
              __pyx_2 = __Pyx_GetItemInt_Tuple(((PyObject *)__pyx_v_tf), 0, sizeof(long), PyInt_FromLong); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 220; __pyx_clineno = __LINE__; goto __pyx_L72_error;}
              __Pyx_GOTREF(__pyx_2);
              __pyx_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_Nj), __pyx_v_j, sizeof(int), PyInt_FromLong); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 220; __pyx_clineno = __LINE__; goto __pyx_L72_error;}
              __Pyx_GOTREF(__pyx_1);
              __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 220; __pyx_clineno = __LINE__; goto __pyx_L72_error;}
              __Pyx_GOTREF(((PyObject *)__pyx_t_1));
              PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_2);
              __Pyx_GIVEREF(__pyx_2);
              PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_1);
              __Pyx_GIVEREF(__pyx_1);
              __pyx_2 = 0;
              __pyx_1 = 0;
              if (__Pyx_SetItemInt(((PyObject *)__pyx_v_term_docs), __pyx_v_j, ((PyObject *)__pyx_t_1), sizeof(int), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 220; __pyx_clineno = __LINE__; goto __pyx_L72_error;}
              __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
              goto __pyx_L83;
            }
            __pyx_L83:;
          }
          __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;

          /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":221
 *                     if Nj.has_key(j):
 *                         term_docs[j] = (tf[0], Nj[j])
 *                 Git = <int>(floorf(Gi[t]*100))             # <<<<<<<<<<<<<<
 *                 if Git >= 0:
 *                     Git += 1
 */
          __pyx_6 = PyObject_GetItem(((PyObject *)__pyx_v_Gi), ((PyObject *)__pyx_v_t)); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 221; __pyx_clineno = __LINE__; goto __pyx_L72_error;}
          __Pyx_GOTREF(__pyx_6);
          __pyx_t_14 = PyNumber_Multiply(__pyx_6, __pyx_int_100); if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 221; __pyx_clineno = __LINE__; goto __pyx_L72_error;}
          __Pyx_GOTREF(__pyx_t_14);
          __Pyx_DECREF(__pyx_6); __pyx_6 = 0;
          __pyx_t_2 = __pyx_PyFloat_AsDouble(__pyx_t_14); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 221; __pyx_clineno = __LINE__; goto __pyx_L72_error;}
          __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
          __pyx_t_14 = PyInt_FromLong(((int)floorf(__pyx_t_2))); if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 221; __pyx_clineno = __LINE__; goto __pyx_L72_error;}
          __Pyx_GOTREF(__pyx_t_14);
          __Pyx_DECREF(__pyx_v_Git);
          __pyx_v_Git = __pyx_t_14;
          __pyx_t_14 = 0;

          /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":222
 *                         term_docs[j] = (tf[0], Nj[j])
 *                 Git = <int>(floorf(Gi[t]*100))
 *                 if Git >= 0:             # <<<<<<<<<<<<<<
 *                     Git += 1
 *                 term_docs["Gi"] = (0, Git)
 */
          __pyx_t_14 = PyObject_RichCompare(__pyx_v_Git, __pyx_int_0, Py_GE); if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 222; __pyx_clineno = __LINE__; goto __pyx_L72_error;}
          __Pyx_GOTREF(__pyx_t_14);
          __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_14); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 222; __pyx_clineno = __LINE__; goto __pyx_L72_error;}
          __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
          if (__pyx_t_5) {

            /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":223
 *                 Git = <int>(floorf(Gi[t]*100))
 *                 if Git >= 0:
 *                     Git += 1             # <<<<<<<<<<<<<<
 *                 term_docs["Gi"] = (0, Git)
 *                 run_sql("UPDATE %s SET hitlist=%%s WHERE term=%%s" % table,
 */
            __pyx_5 = PyNumber_InPlaceAdd(__pyx_v_Git, __pyx_int_1); if (unlikely(!__pyx_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 223; __pyx_clineno = __LINE__; goto __pyx_L72_error;}
            __Pyx_GOTREF(__pyx_5);
            __Pyx_DECREF(__pyx_v_Git);
            __pyx_v_Git = __pyx_5;
            __pyx_5 = 0;
            goto __pyx_L84;
          }
          __pyx_L84:;

          /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":224
 *                 if Git >= 0:
 *                     Git += 1
 *                 term_docs["Gi"] = (0, Git)             # <<<<<<<<<<<<<<
 *                 run_sql("UPDATE %s SET hitlist=%%s WHERE term=%%s" % table,
 *                         (serialize_via_marshal(term_docs), t))
 */
          __pyx_t_14 = PyTuple_New(2); if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 224; __pyx_clineno = __LINE__; goto __pyx_L72_error;}
          __Pyx_GOTREF(((PyObject *)__pyx_t_14));
          __Pyx_INCREF(__pyx_int_0);
          PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_int_0);
          __Pyx_GIVEREF(__pyx_int_0);
          __Pyx_INCREF(__pyx_v_Git);
          PyTuple_SET_ITEM(__pyx_t_14, 1, __pyx_v_Git);
          __Pyx_GIVEREF(__pyx_v_Git);
          if (PyDict_SetItem(((PyObject *)__pyx_v_term_docs), __pyx_kp_63, ((PyObject *)__pyx_t_14)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 224; __pyx_clineno = __LINE__; goto __pyx_L72_error;}
          __Pyx_DECREF(((PyObject *)__pyx_t_14)); __pyx_t_14 = 0;

          /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":225
 *                     Git += 1
 *                 term_docs["Gi"] = (0, Git)
 *                 run_sql("UPDATE %s SET hitlist=%%s WHERE term=%%s" % table,             # <<<<<<<<<<<<<<
 *                         (serialize_via_marshal(term_docs), t))
 *             except (ZeroDivisionError, OverflowError), e:
 */
          __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_kp_run_sql); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L72_error;}
          __Pyx_GOTREF(__pyx_3);
          __pyx_t_14 = PyNumber_Remainder(__pyx_kp_64, ((PyObject *)__pyx_v_table)); if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L72_error;}
          __Pyx_GOTREF(__pyx_t_14);

          /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":226
 *                 term_docs["Gi"] = (0, Git)
 *                 run_sql("UPDATE %s SET hitlist=%%s WHERE term=%%s" % table,
 *                         (serialize_via_marshal(term_docs), t))             # <<<<<<<<<<<<<<
 *             except (ZeroDivisionError, OverflowError), e:
 *                 register_exception(prefix="Error when analysing the term %s (%s): %s\n" % (t, repr(terms_docs), e), alert_admin=True)
 */
          __pyx_t_1 = __pyx_f_22bibrank_word_indexer_c_serialize_via_marshal(((PyObject *)__pyx_v_term_docs)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 226; __pyx_clineno = __LINE__; goto __pyx_L72_error;}
          __Pyx_GOTREF(__pyx_t_1);
          __pyx_t_9 = PyTuple_New(2); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 226; __pyx_clineno = __LINE__; goto __pyx_L72_error;}
          __Pyx_GOTREF(((PyObject *)__pyx_t_9));
          PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_1);
          __Pyx_GIVEREF(__pyx_t_1);
          __Pyx_INCREF(((PyObject *)__pyx_v_t));
          PyTuple_SET_ITEM(__pyx_t_9, 1, ((PyObject *)__pyx_v_t));
          __Pyx_GIVEREF(((PyObject *)__pyx_v_t));
          __pyx_t_1 = 0;
          __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L72_error;}
          __Pyx_GOTREF(((PyObject *)__pyx_t_1));
          PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_14);
          __Pyx_GIVEREF(__pyx_t_14);
          PyTuple_SET_ITEM(__pyx_t_1, 1, ((PyObject *)__pyx_t_9));
          __Pyx_GIVEREF(((PyObject *)__pyx_t_9));
          __pyx_t_14 = 0;
          __pyx_t_9 = 0;
          __pyx_t_9 = PyObject_Call(__pyx_3, ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L72_error;}
          __Pyx_GOTREF(__pyx_t_9);
          __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
          __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
          __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
        }
        __Pyx_XDECREF(__pyx_save_exc_type); __pyx_save_exc_type = 0;
        __Pyx_XDECREF(__pyx_save_exc_value); __pyx_save_exc_value = 0;
        __Pyx_XDECREF(__pyx_save_exc_tb); __pyx_save_exc_tb = 0;
        goto __pyx_L79_try_end;
        __pyx_L72_error:;
        __Pyx_XDECREF(__pyx_2); __pyx_2 = 0;
        __Pyx_XDECREF(__pyx_1); __pyx_1 = 0;
        __Pyx_XDECREF(__pyx_6); __pyx_6 = 0;
        __Pyx_XDECREF(__pyx_5); __pyx_5 = 0;
        __Pyx_XDECREF(__pyx_3); __pyx_3 = 0;
        __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
        __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
        __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;

        /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":227
 *                 run_sql("UPDATE %s SET hitlist=%%s WHERE term=%%s" % table,
 *                         (serialize_via_marshal(term_docs), t))
 *             except (ZeroDivisionError, OverflowError), e:             # <<<<<<<<<<<<<<
 *                 register_exception(prefix="Error when analysing the term %s (%s): %s\n" % (t, repr(terms_docs), e), alert_admin=True)
 *         write_message("Phase 5: ......processed %s/%s terms" % ((i+5000>len(terms) and len(terms) or (i+5000)), len(terms)))
 */
        __pyx_t_9 = PyTuple_New(2); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 227; __pyx_clineno = __LINE__; goto __pyx_L74_except_error;}
        __Pyx_GOTREF(((PyObject *)__pyx_t_9));
        __Pyx_INCREF(__pyx_builtin_ZeroDivisionError);
        PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_builtin_ZeroDivisionError);
        __Pyx_GIVEREF(__pyx_builtin_ZeroDivisionError);
        __Pyx_INCREF(__pyx_builtin_OverflowError);
        PyTuple_SET_ITEM(__pyx_t_9, 1, __pyx_builtin_OverflowError);
        __Pyx_GIVEREF(__pyx_builtin_OverflowError);
        __pyx_4 = PyErr_ExceptionMatches(((PyObject *)__pyx_t_9));
        __Pyx_DECREF(((PyObject *)__pyx_t_9)); __pyx_t_9 = 0;
        if (__pyx_4) {
          __Pyx_AddTraceback("bibrank_word_indexer_c.update_rnkWORD");
          if (__Pyx_GetException(&__pyx_2, &__pyx_1, &__pyx_6) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 227; __pyx_clineno = __LINE__; goto __pyx_L74_except_error;}
          __Pyx_GOTREF(__pyx_2);
          __Pyx_GOTREF(__pyx_1);
          __Pyx_GOTREF(__pyx_6);
          __Pyx_INCREF(__pyx_1);
          __Pyx_DECREF(__pyx_v_e);
          __pyx_v_e = __pyx_1;

          /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":228
 *                         (serialize_via_marshal(term_docs), t))
 *             except (ZeroDivisionError, OverflowError), e:
 *                 register_exception(prefix="Error when analysing the term %s (%s): %s\n" % (t, repr(terms_docs), e), alert_admin=True)             # <<<<<<<<<<<<<<
 *         write_message("Phase 5: ......processed %s/%s terms" % ((i+5000>len(terms) and len(terms) or (i+5000)), len(terms)))
 *         task_update_progress("Post-processing phase 5: %s/%s terms" % ((i+5000>len(terms) and len(terms) or (i+5000)), len(terms)))
 */
          __pyx_5 = __Pyx_GetName(__pyx_m, __pyx_kp_register_exception); if (unlikely(!__pyx_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 228; __pyx_clineno = __LINE__; goto __pyx_L74_except_error;}
          __Pyx_GOTREF(__pyx_5);
          __pyx_3 = PyDict_New(); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 228; __pyx_clineno = __LINE__; goto __pyx_L74_except_error;}
          __Pyx_GOTREF(((PyObject *)__pyx_3));
          __pyx_t_9 = PyObject_Repr(((PyObject *)__pyx_v_terms_docs)); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 228; __pyx_clineno = __LINE__; goto __pyx_L74_except_error;}
          __Pyx_GOTREF(__pyx_t_9);
          __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 228; __pyx_clineno = __LINE__; goto __pyx_L74_except_error;}
          __Pyx_GOTREF(((PyObject *)__pyx_t_1));
          __Pyx_INCREF(((PyObject *)__pyx_v_t));
          PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_v_t));
          __Pyx_GIVEREF(((PyObject *)__pyx_v_t));
          PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_9);
          __Pyx_GIVEREF(__pyx_t_9);
          __Pyx_INCREF(__pyx_v_e);
          PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_v_e);
          __Pyx_GIVEREF(__pyx_v_e);
          __pyx_t_9 = 0;
          __pyx_t_9 = PyNumber_Remainder(__pyx_kp_65, ((PyObject *)__pyx_t_1)); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 228; __pyx_clineno = __LINE__; goto __pyx_L74_except_error;}
          __Pyx_GOTREF(__pyx_t_9);
          __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
          if (PyDict_SetItem(__pyx_3, __pyx_kp_prefix, __pyx_t_9) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 228; __pyx_clineno = __LINE__; goto __pyx_L74_except_error;}
          __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
          __pyx_t_9 = __Pyx_PyBool_FromLong(1); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 228; __pyx_clineno = __LINE__; goto __pyx_L74_except_error;}
          __Pyx_GOTREF(__pyx_t_9);
          if (PyDict_SetItem(__pyx_3, __pyx_kp_alert_admin, __pyx_t_9) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 228; __pyx_clineno = __LINE__; goto __pyx_L74_except_error;}
          __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
          __pyx_t_9 = PyEval_CallObjectWithKeywords(__pyx_5, ((PyObject *)__pyx_empty_tuple), ((PyObject *)__pyx_3)); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 228; __pyx_clineno = __LINE__; goto __pyx_L74_except_error;}
          __Pyx_GOTREF(__pyx_t_9);
          __Pyx_DECREF(__pyx_5); __pyx_5 = 0;
          __Pyx_DECREF(((PyObject *)__pyx_3)); __pyx_3 = 0;
          __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
          __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
          __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
          __Pyx_DECREF(__pyx_6); __pyx_6 = 0;
          goto __pyx_L73_exception_handled;
        }
        __pyx_L74_except_error:;
        __Pyx_XDECREF(__pyx_save_exc_type);
        __Pyx_XDECREF(__pyx_save_exc_value);
        __Pyx_XDECREF(__pyx_save_exc_tb);
        goto __pyx_L1_error;
        __pyx_L73_exception_handled:;
        __Pyx_XGIVEREF(__pyx_save_exc_type);
        __Pyx_XGIVEREF(__pyx_save_exc_value);
        __Pyx_XGIVEREF(__pyx_save_exc_tb);
        __Pyx_ExceptionReset(__pyx_save_exc_type, __pyx_save_exc_value, __pyx_save_exc_tb);
        __pyx_L79_try_end:;
      }
    }
    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

    /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":229
 *             except (ZeroDivisionError, OverflowError), e:
 *                 register_exception(prefix="Error when analysing the term %s (%s): %s\n" % (t, repr(terms_docs), e), alert_admin=True)
 *         write_message("Phase 5: ......processed %s/%s terms" % ((i+5000>len(terms) and len(terms) or (i+5000)), len(terms)))             # <<<<<<<<<<<<<<
 *         task_update_progress("Post-processing phase 5: %s/%s terms" % ((i+5000>len(terms) and len(terms) or (i+5000)), len(terms)))
 *         i += 5000
 */
    __pyx_5 = __Pyx_GetName(__pyx_m, __pyx_kp_write_message); if (unlikely(!__pyx_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 229; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_5);
    __pyx_t_8 = PyObject_Length(((PyObject *)__pyx_v_terms)); if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 229; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    if (((__pyx_v_i + 5000) > __pyx_t_8)) {
      __pyx_t_11 = PyObject_Length(((PyObject *)__pyx_v_terms)); if (unlikely(__pyx_t_11 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 229; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_t_5 = __pyx_t_11;
    } else {
      __pyx_t_5 = ((__pyx_v_i + 5000) > __pyx_t_8);
    }
    if (!__pyx_t_5) {
      __pyx_t_7 = (__pyx_v_i + 5000);
    } else {
      __pyx_t_7 = __pyx_t_5;
    }
    __pyx_t_10 = __Pyx_PyBool_FromLong(__pyx_t_7); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 229; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_10);
    __pyx_t_8 = PyObject_Length(((PyObject *)__pyx_v_terms)); if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 229; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_9 = PyInt_FromSsize_t(__pyx_t_8); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 229; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_9);
    __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 229; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_10);
    __Pyx_GIVEREF(__pyx_t_10);
    PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_9);
    __Pyx_GIVEREF(__pyx_t_9);
    __pyx_t_10 = 0;
    __pyx_t_9 = 0;
    __pyx_t_9 = PyNumber_Remainder(__pyx_kp_66, ((PyObject *)__pyx_t_1)); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 229; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 229; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_9);
    __Pyx_GIVEREF(__pyx_t_9);
    __pyx_t_9 = 0;
    __pyx_t_9 = PyObject_Call(__pyx_5, ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 229; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_DECREF(__pyx_5); __pyx_5 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;

    /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":230
 *                 register_exception(prefix="Error when analysing the term %s (%s): %s\n" % (t, repr(terms_docs), e), alert_admin=True)
 *         write_message("Phase 5: ......processed %s/%s terms" % ((i+5000>len(terms) and len(terms) or (i+5000)), len(terms)))
 *         task_update_progress("Post-processing phase 5: %s/%s terms" % ((i+5000>len(terms) and len(terms) or (i+5000)), len(terms)))             # <<<<<<<<<<<<<<
 *         i += 5000
 *         task_sleep_now_if_required()
 */
    __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_kp_5); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 230; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_3);
    __pyx_t_8 = PyObject_Length(((PyObject *)__pyx_v_terms)); if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 230; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    if (((__pyx_v_i + 5000) > __pyx_t_8)) {
      __pyx_t_11 = PyObject_Length(((PyObject *)__pyx_v_terms)); if (unlikely(__pyx_t_11 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 230; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_t_7 = __pyx_t_11;
    } else {
      __pyx_t_7 = ((__pyx_v_i + 5000) > __pyx_t_8);
    }
    if (!__pyx_t_7) {
      __pyx_t_5 = (__pyx_v_i + 5000);
    } else {
      __pyx_t_5 = __pyx_t_7;
    }
    __pyx_t_9 = __Pyx_PyBool_FromLong(__pyx_t_5); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 230; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_9);
    __pyx_t_8 = PyObject_Length(((PyObject *)__pyx_v_terms)); if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 230; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_8); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 230; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_10 = PyTuple_New(2); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 230; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_10));
    PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_9);
    __Pyx_GIVEREF(__pyx_t_9);
    PyTuple_SET_ITEM(__pyx_t_10, 1, __pyx_t_1);
    __Pyx_GIVEREF(__pyx_t_1);
    __pyx_t_9 = 0;
    __pyx_t_1 = 0;
    __pyx_t_1 = PyNumber_Remainder(__pyx_kp_67, ((PyObject *)__pyx_t_10)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 230; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(((PyObject *)__pyx_t_10)); __pyx_t_10 = 0;
    __pyx_t_10 = PyTuple_New(1); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 230; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_10));
    PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_1);
    __Pyx_GIVEREF(__pyx_t_1);
    __pyx_t_1 = 0;
    __pyx_t_1 = PyObject_Call(__pyx_3, ((PyObject *)__pyx_t_10), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 230; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_10)); __pyx_t_10 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":231
 *         write_message("Phase 5: ......processed %s/%s terms" % ((i+5000>len(terms) and len(terms) or (i+5000)), len(terms)))
 *         task_update_progress("Post-processing phase 5: %s/%s terms" % ((i+5000>len(terms) and len(terms) or (i+5000)), len(terms)))
 *         i += 5000             # <<<<<<<<<<<<<<
 *         task_sleep_now_if_required()
 *     write_message("Phase 5:  Finished updating %s with new normalization values" % table)
 */
    __pyx_v_i += 5000;

    /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":232
 *         task_update_progress("Post-processing phase 5: %s/%s terms" % ((i+5000>len(terms) and len(terms) or (i+5000)), len(terms)))
 *         i += 5000
 *         task_sleep_now_if_required()             # <<<<<<<<<<<<<<
 *     write_message("Phase 5:  Finished updating %s with new normalization values" % table)
 *     write_message("Time used for post-processing: %.1fmin" % ((time() - stime) / 60))
 */
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_kp_6); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 232; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_2);
    __pyx_t_1 = PyObject_Call(__pyx_2, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 232; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  }

  /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":233
 *         i += 5000
 *         task_sleep_now_if_required()
 *     write_message("Phase 5:  Finished updating %s with new normalization values" % table)             # <<<<<<<<<<<<<<
 *     write_message("Time used for post-processing: %.1fmin" % ((time() - stime) / 60))
 *     write_message("Finished post-processing")
 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_write_message); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 233; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __pyx_t_1 = PyNumber_Remainder(__pyx_kp_68, ((PyObject *)__pyx_v_table)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 233; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_10 = PyTuple_New(1); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 233; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_10));
  PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = PyObject_Call(__pyx_1, ((PyObject *)__pyx_t_10), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 233; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_10)); __pyx_t_10 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":234
 *         task_sleep_now_if_required()
 *     write_message("Phase 5:  Finished updating %s with new normalization values" % table)
 *     write_message("Time used for post-processing: %.1fmin" % ((time() - stime) / 60))             # <<<<<<<<<<<<<<
 *     write_message("Finished post-processing")
 *     task_update_progress("Post-processing done")
 */
  __pyx_6 = __Pyx_GetName(__pyx_m, __pyx_kp_write_message); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 234; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_6);
  __pyx_5 = __Pyx_GetName(__pyx_m, __pyx_kp_time); if (unlikely(!__pyx_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 234; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_5);
  __pyx_t_1 = PyObject_Call(__pyx_5, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 234; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_5); __pyx_5 = 0;
  __pyx_t_10 = PyFloat_FromDouble(__pyx_v_stime); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 234; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_10);
  __pyx_t_9 = PyNumber_Subtract(__pyx_t_1, __pyx_t_10); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 234; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_9);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
  __pyx_t_10 = __Pyx_PyNumber_Divide(__pyx_t_9, __pyx_int_60); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 234; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_10);
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  __pyx_t_9 = PyNumber_Remainder(__pyx_kp_69, __pyx_t_10); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 234; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_9);
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
  __pyx_t_10 = PyTuple_New(1); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 234; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_10));
  PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_9);
  __Pyx_GIVEREF(__pyx_t_9);
  __pyx_t_9 = 0;
  __pyx_t_9 = PyObject_Call(__pyx_6, ((PyObject *)__pyx_t_10), NULL); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 234; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_9);
  __Pyx_DECREF(__pyx_6); __pyx_6 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_10)); __pyx_t_10 = 0;
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;

  /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":235
 *     write_message("Phase 5:  Finished updating %s with new normalization values" % table)
 *     write_message("Time used for post-processing: %.1fmin" % ((time() - stime) / 60))
 *     write_message("Finished post-processing")             # <<<<<<<<<<<<<<
 *     task_update_progress("Post-processing done")
 * 
 */
  __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_kp_write_message); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 235; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_3);
  __pyx_t_9 = PyTuple_New(1); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 235; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_9));
  __Pyx_INCREF(__pyx_kp_70);
  PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_kp_70);
  __Pyx_GIVEREF(__pyx_kp_70);
  __pyx_t_10 = PyObject_Call(__pyx_3, ((PyObject *)__pyx_t_9), NULL); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 235; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_10);
  __Pyx_DECREF(__pyx_3); __pyx_3 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_9)); __pyx_t_9 = 0;
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

  /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":236
 *     write_message("Time used for post-processing: %.1fmin" % ((time() - stime) / 60))
 *     write_message("Finished post-processing")
 *     task_update_progress("Post-processing done")             # <<<<<<<<<<<<<<
 * 
 * cpdef get_from_forward_index(list terms, int start, int stop, str table):
 */
  __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_kp_5); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 236; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_2);
  __pyx_t_10 = PyTuple_New(1); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 236; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_10));
  __Pyx_INCREF(__pyx_kp_71);
  PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_kp_71);
  __Pyx_GIVEREF(__pyx_kp_71);
  __pyx_t_9 = PyObject_Call(__pyx_2, ((PyObject *)__pyx_t_10), NULL); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 236; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_9);
  __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_10)); __pyx_t_10 = 0;
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_1);
  __Pyx_XDECREF(__pyx_2);
  __Pyx_XDECREF(__pyx_3);
  __Pyx_XDECREF(__pyx_5);
  __Pyx_XDECREF(__pyx_6);
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_XDECREF(__pyx_t_14);
  __Pyx_AddTraceback("bibrank_word_indexer_c.update_rnkWORD");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_Gi);
  __Pyx_XDECREF(__pyx_v_Nj);
  __Pyx_DECREF(__pyx_v_terms_docs);
  __Pyx_DECREF(__pyx_v_docs_terms);
  __Pyx_DECREF(__pyx_v_hitlist);
  __Pyx_DECREF(__pyx_v_t);
  __Pyx_DECREF(__pyx_v_termlist);
  __Pyx_DECREF(__pyx_v_term_docs);
  __Pyx_DECREF(__pyx_v_tf);
  __Pyx_DECREF(__pyx_v_records);
  __Pyx_DECREF(__pyx_v_doc_terms);
  __Pyx_DECREF(__pyx_v_Fi);
  __Pyx_DECREF(__pyx_v_Git);
  __Pyx_DECREF(__pyx_v_e);
  __Pyx_DECREF(__pyx_v_terms);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_FinishRefcountContext();
  return __pyx_r;
}

/* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":238
 *     task_update_progress("Post-processing done")
 * 
 * cpdef get_from_forward_index(list terms, int start, int stop, str table):             # <<<<<<<<<<<<<<
 *     cdef int j
 *     cdef tuple terms_docs = ()
 */

static PyObject *__pyx_pf_22bibrank_word_indexer_c_get_from_forward_index(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static  PyObject *__pyx_f_22bibrank_word_indexer_c_get_from_forward_index(PyObject *__pyx_v_terms, int __pyx_v_start, int __pyx_v_stop, PyObject *__pyx_v_table, int __pyx_skip_dispatch) {
  int __pyx_v_j;
  PyObject *__pyx_v_terms_docs = 0;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  Py_ssize_t __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  __Pyx_SetupRefcountContext("get_from_forward_index");

  /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":240
 * cpdef get_from_forward_index(list terms, int start, int stop, str table):
 *     cdef int j
 *     cdef tuple terms_docs = ()             # <<<<<<<<<<<<<<
 *     stop = min(len(terms), stop)
 *     for j from start <= j < stop:
 */
  __Pyx_INCREF(((PyObject *)__pyx_empty_tuple));
  __pyx_v_terms_docs = __pyx_empty_tuple;

  /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":241
 *     cdef int j
 *     cdef tuple terms_docs = ()
 *     stop = min(len(terms), stop)             # <<<<<<<<<<<<<<
 *     for j from start <= j < stop:
 *         terms_docs += run_sql("SELECT term, hitlist FROM %s WHERE term=%%s" % table, (terms[j],))
 */
  __pyx_t_1 = PyObject_Length(((PyObject *)__pyx_v_terms)); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 241; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_2 = PyInt_FromSsize_t(__pyx_t_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 241; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyInt_FromLong(__pyx_v_stop); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 241; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 241; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_4));
  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_3);
  __pyx_t_2 = 0;
  __pyx_t_3 = 0;
  __pyx_t_3 = PyObject_Call(__pyx_builtin_min, ((PyObject *)__pyx_t_4), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 241; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
  __pyx_t_5 = __Pyx_PyInt_AsInt(__pyx_t_3); if (unlikely((__pyx_t_5 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 241; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_stop = __pyx_t_5;

  /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":242
 *     cdef tuple terms_docs = ()
 *     stop = min(len(terms), stop)
 *     for j from start <= j < stop:             # <<<<<<<<<<<<<<
 *         terms_docs += run_sql("SELECT term, hitlist FROM %s WHERE term=%%s" % table, (terms[j],))
 *     return terms_docs
 */
  __pyx_t_5 = __pyx_v_stop;
  for (__pyx_v_j = __pyx_v_start; __pyx_v_j < __pyx_t_5; __pyx_v_j++) {

    /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":243
 *     stop = min(len(terms), stop)
 *     for j from start <= j < stop:
 *         terms_docs += run_sql("SELECT term, hitlist FROM %s WHERE term=%%s" % table, (terms[j],))             # <<<<<<<<<<<<<<
 *     return terms_docs
 * 
 */
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_kp_run_sql); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 243; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_2);
    __pyx_t_3 = PyNumber_Remainder(__pyx_kp_72, ((PyObject *)__pyx_v_table)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 243; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_3 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_terms), __pyx_v_j, sizeof(int), PyInt_FromLong); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 243; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_3);
    __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 243; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_4));
    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_3);
    __Pyx_GIVEREF(__pyx_3);
    __pyx_3 = 0;
    __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 243; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(((PyObject *)__pyx_t_2));
    PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_3);
    __Pyx_GIVEREF(__pyx_t_3);
    PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_t_4));
    __Pyx_GIVEREF(((PyObject *)__pyx_t_4));
    __pyx_t_3 = 0;
    __pyx_t_4 = 0;
    __pyx_t_4 = PyObject_Call(__pyx_2, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 243; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
    __pyx_1 = PyNumber_InPlaceAdd(((PyObject *)__pyx_v_terms_docs), __pyx_t_4); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 243; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_GOTREF(__pyx_1);
    if (!(likely(PyTuple_CheckExact(__pyx_1)) || (__pyx_1) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected tuple, got %s", Py_TYPE(__pyx_1)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 243; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(((PyObject *)__pyx_v_terms_docs));
    __pyx_v_terms_docs = ((PyObject *)__pyx_1);
    __pyx_1 = 0;
  }

  /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":244
 *     for j from start <= j < stop:
 *         terms_docs += run_sql("SELECT term, hitlist FROM %s WHERE term=%%s" % table, (terms[j],))
 *     return terms_docs             # <<<<<<<<<<<<<<
 * 
 * cpdef get_from_forward_index_with_id(int start, int stop, str table):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(((PyObject *)__pyx_v_terms_docs));
  __pyx_r = ((PyObject *)__pyx_v_terms_docs);
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_1);
  __Pyx_XDECREF(__pyx_2);
  __Pyx_XDECREF(__pyx_3);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("bibrank_word_indexer_c.get_from_forward_index");
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_terms_docs);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_FinishRefcountContext();
  return __pyx_r;
}

/* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":238
 *     task_update_progress("Post-processing done")
 * 
 * cpdef get_from_forward_index(list terms, int start, int stop, str table):             # <<<<<<<<<<<<<<
 *     cdef int j
 *     cdef tuple terms_docs = ()
 */

static PyObject *__pyx_pf_22bibrank_word_indexer_c_get_from_forward_index(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pf_22bibrank_word_indexer_c_get_from_forward_index(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_terms = 0;
  int __pyx_v_start;
  int __pyx_v_stop;
  PyObject *__pyx_v_table = 0;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  static PyObject **__pyx_pyargnames[] = {&__pyx_kp_terms,&__pyx_kp_start,&__pyx_kp_stop,&__pyx_kp_table,0};
  __Pyx_SetupRefcountContext("get_from_forward_index");
  __pyx_self = __pyx_self;
  if (unlikely(__pyx_kwds)) {
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[4] = {0,0,0,0};
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
      case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_kp_terms);
      if (likely(values[0])) kw_args--;
      else goto __pyx_L5_argtuple_error;
      case  1:
      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_kp_start);
      if (likely(values[1])) kw_args--;
      else {
        __Pyx_RaiseArgtupleInvalid("get_from_forward_index", 1, 4, 4, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 238; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
      case  2:
      values[2] = PyDict_GetItem(__pyx_kwds, __pyx_kp_stop);
      if (likely(values[2])) kw_args--;
      else {
        __Pyx_RaiseArgtupleInvalid("get_from_forward_index", 1, 4, 4, 2); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 238; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
      case  3:
      values[3] = PyDict_GetItem(__pyx_kwds, __pyx_kp_table);
      if (likely(values[3])) kw_args--;
      else {
        __Pyx_RaiseArgtupleInvalid("get_from_forward_index", 1, 4, 4, 3); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 238; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "get_from_forward_index") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 238; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    __pyx_v_terms = ((PyObject *)values[0]);
    __pyx_v_start = __Pyx_PyInt_AsInt(values[1]); if (unlikely((__pyx_v_start == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 238; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    __pyx_v_stop = __Pyx_PyInt_AsInt(values[2]); if (unlikely((__pyx_v_stop == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 238; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    __pyx_v_table = ((PyObject *)values[3]);
  } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
    goto __pyx_L5_argtuple_error;
  } else {
    __pyx_v_terms = ((PyObject *)PyTuple_GET_ITEM(__pyx_args, 0));
    __pyx_v_start = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 1)); if (unlikely((__pyx_v_start == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 238; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    __pyx_v_stop = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 2)); if (unlikely((__pyx_v_stop == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 238; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    __pyx_v_table = ((PyObject *)PyTuple_GET_ITEM(__pyx_args, 3));
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("get_from_forward_index", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 238; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("bibrank_word_indexer_c.get_from_forward_index");
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_terms), &PyList_Type, 1, "terms", 1))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 238; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_table), &PyString_Type, 1, "table", 1))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 238; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __pyx_f_22bibrank_word_indexer_c_get_from_forward_index(__pyx_v_terms, __pyx_v_start, __pyx_v_stop, __pyx_v_table, 0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 238; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("bibrank_word_indexer_c.get_from_forward_index");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_FinishRefcountContext();
  return __pyx_r;
}

/* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":246
 *     return terms_docs
 * 
 * cpdef get_from_forward_index_with_id(int start, int stop, str table):             # <<<<<<<<<<<<<<
 *     cdef tuple terms_docs = run_sql("SELECT term, hitlist FROM %s WHERE id BETWEEN %%s AND %%s" % table, (start, stop))
 *     return terms_docs
 */

static PyObject *__pyx_pf_22bibrank_word_indexer_c_get_from_forward_index_with_id(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static  PyObject *__pyx_f_22bibrank_word_indexer_c_get_from_forward_index_with_id(int __pyx_v_start, int __pyx_v_stop, PyObject *__pyx_v_table, int __pyx_skip_dispatch) {
  PyObject *__pyx_v_terms_docs = 0;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  __Pyx_SetupRefcountContext("get_from_forward_index_with_id");

  /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":247
 * 
 * cpdef get_from_forward_index_with_id(int start, int stop, str table):
 *     cdef tuple terms_docs = run_sql("SELECT term, hitlist FROM %s WHERE id BETWEEN %%s AND %%s" % table, (start, stop))             # <<<<<<<<<<<<<<
 *     return terms_docs
 * 
 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_run_sql); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 247; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __pyx_t_1 = PyNumber_Remainder(__pyx_kp_73, ((PyObject *)__pyx_v_table)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 247; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyInt_FromLong(__pyx_v_start); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 247; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyInt_FromLong(__pyx_v_stop); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 247; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 247; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_4));
  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_3);
  __pyx_t_2 = 0;
  __pyx_t_3 = 0;
  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 247; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_3));
  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_3, 1, ((PyObject *)__pyx_t_4));
  __Pyx_GIVEREF(((PyObject *)__pyx_t_4));
  __pyx_t_1 = 0;
  __pyx_t_4 = 0;
  __pyx_t_4 = PyObject_Call(__pyx_1, ((PyObject *)__pyx_t_3), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 247; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  if (!(likely(PyTuple_CheckExact(__pyx_t_4)) || (__pyx_t_4) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected tuple, got %s", Py_TYPE(__pyx_t_4)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 247; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v_terms_docs = ((PyObject *)__pyx_t_4);
  __pyx_t_4 = 0;

  /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":248
 * cpdef get_from_forward_index_with_id(int start, int stop, str table):
 *     cdef tuple terms_docs = run_sql("SELECT term, hitlist FROM %s WHERE id BETWEEN %%s AND %%s" % table, (start, stop))
 *     return terms_docs             # <<<<<<<<<<<<<<
 * 
 * cpdef get_from_reverse_index(list records, int start, int stop, str table):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(((PyObject *)__pyx_v_terms_docs));
  __pyx_r = ((PyObject *)__pyx_v_terms_docs);
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_1);
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("bibrank_word_indexer_c.get_from_forward_index_with_id");
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_terms_docs);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_FinishRefcountContext();
  return __pyx_r;
}

/* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":246
 *     return terms_docs
 * 
 * cpdef get_from_forward_index_with_id(int start, int stop, str table):             # <<<<<<<<<<<<<<
 *     cdef tuple terms_docs = run_sql("SELECT term, hitlist FROM %s WHERE id BETWEEN %%s AND %%s" % table, (start, stop))
 *     return terms_docs
 */

static PyObject *__pyx_pf_22bibrank_word_indexer_c_get_from_forward_index_with_id(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pf_22bibrank_word_indexer_c_get_from_forward_index_with_id(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_start;
  int __pyx_v_stop;
  PyObject *__pyx_v_table = 0;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  static PyObject **__pyx_pyargnames[] = {&__pyx_kp_start,&__pyx_kp_stop,&__pyx_kp_table,0};
  __Pyx_SetupRefcountContext("get_from_forward_index_with_id");
  __pyx_self = __pyx_self;
  if (unlikely(__pyx_kwds)) {
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[3] = {0,0,0};
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_kp_start);
      if (likely(values[0])) kw_args--;
      else goto __pyx_L5_argtuple_error;
      case  1:
      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_kp_stop);
      if (likely(values[1])) kw_args--;
      else {
        __Pyx_RaiseArgtupleInvalid("get_from_forward_index_with_id", 1, 3, 3, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 246; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
      case  2:
      values[2] = PyDict_GetItem(__pyx_kwds, __pyx_kp_table);
      if (likely(values[2])) kw_args--;
      else {
        __Pyx_RaiseArgtupleInvalid("get_from_forward_index_with_id", 1, 3, 3, 2); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 246; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "get_from_forward_index_with_id") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 246; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    __pyx_v_start = __Pyx_PyInt_AsInt(values[0]); if (unlikely((__pyx_v_start == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 246; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    __pyx_v_stop = __Pyx_PyInt_AsInt(values[1]); if (unlikely((__pyx_v_stop == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 246; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    __pyx_v_table = ((PyObject *)values[2]);
  } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
    goto __pyx_L5_argtuple_error;
  } else {
    __pyx_v_start = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 0)); if (unlikely((__pyx_v_start == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 246; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    __pyx_v_stop = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 1)); if (unlikely((__pyx_v_stop == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 246; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    __pyx_v_table = ((PyObject *)PyTuple_GET_ITEM(__pyx_args, 2));
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("get_from_forward_index_with_id", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 246; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("bibrank_word_indexer_c.get_from_forward_index_with_id");
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_table), &PyString_Type, 1, "table", 1))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 246; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __pyx_f_22bibrank_word_indexer_c_get_from_forward_index_with_id(__pyx_v_start, __pyx_v_stop, __pyx_v_table, 0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 246; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("bibrank_word_indexer_c.get_from_forward_index_with_id");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_FinishRefcountContext();
  return __pyx_r;
}

/* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":250
 *     return terms_docs
 * 
 * cpdef get_from_reverse_index(list records, int start, int stop, str table):             # <<<<<<<<<<<<<<
 *     cdef str current_recs = "%s" % records[start:stop]
 *     cdef tuple docs_terms
 */

static PyObject *__pyx_pf_22bibrank_word_indexer_c_get_from_reverse_index(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static  PyObject *__pyx_f_22bibrank_word_indexer_c_get_from_reverse_index(PyObject *__pyx_v_records, int __pyx_v_start, int __pyx_v_stop, PyObject *__pyx_v_table, int __pyx_skip_dispatch) {
  PyObject *__pyx_v_current_recs = 0;
  PyObject *__pyx_v_docs_terms;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  __Pyx_SetupRefcountContext("get_from_reverse_index");
  __pyx_v_docs_terms = ((PyObject *)Py_None); __Pyx_INCREF(Py_None);

  /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":251
 * 
 * cpdef get_from_reverse_index(list records, int start, int stop, str table):
 *     cdef str current_recs = "%s" % records[start:stop]             # <<<<<<<<<<<<<<
 *     cdef tuple docs_terms
 *     current_recs = current_recs[1:-1]
 */
  __pyx_1 = PySequence_GetSlice(((PyObject *)__pyx_v_records), __pyx_v_start, __pyx_v_stop); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 251; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_1));
  __pyx_t_1 = PyNumber_Remainder(__pyx_kp_74, ((PyObject *)__pyx_1)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 251; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
  if (!(likely(PyString_CheckExact(__pyx_t_1)) || (__pyx_t_1) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected str, got %s", Py_TYPE(__pyx_t_1)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 251; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v_current_recs = ((PyObject *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":253
 *     cdef str current_recs = "%s" % records[start:stop]
 *     cdef tuple docs_terms
 *     current_recs = current_recs[1:-1]             # <<<<<<<<<<<<<<
 *     docs_terms = run_sql("SELECT id_bibrec, termlist FROM %sR WHERE id_bibrec IN (%s)" % (table[:-1], current_recs))
 *     return docs_terms
 */
  __pyx_1 = PySequence_GetSlice(((PyObject *)__pyx_v_current_recs), 1, -1); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 253; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_1));
  __Pyx_DECREF(((PyObject *)__pyx_v_current_recs));
  __pyx_v_current_recs = __pyx_1;
  __pyx_1 = 0;

  /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":254
 *     cdef tuple docs_terms
 *     current_recs = current_recs[1:-1]
 *     docs_terms = run_sql("SELECT id_bibrec, termlist FROM %sR WHERE id_bibrec IN (%s)" % (table[:-1], current_recs))             # <<<<<<<<<<<<<<
 *     return docs_terms
 * 
 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_run_sql); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 254; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __pyx_2 = PySequence_GetSlice(((PyObject *)__pyx_v_table), 0, -1); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 254; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_2));
  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 254; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_2));
  __Pyx_GIVEREF(((PyObject *)__pyx_2));
  __Pyx_INCREF(((PyObject *)__pyx_v_current_recs));
  PyTuple_SET_ITEM(__pyx_t_1, 1, ((PyObject *)__pyx_v_current_recs));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_current_recs));
  __pyx_2 = 0;
  __pyx_t_2 = PyNumber_Remainder(__pyx_kp_75, ((PyObject *)__pyx_t_1)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 254; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 254; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_Call(__pyx_1, ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 254; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  if (!(likely(PyTuple_CheckExact(__pyx_t_2)) || (__pyx_t_2) == Py_None || (PyErr_Format(PyExc_TypeError, "Expected tuple, got %s", Py_TYPE(__pyx_t_2)->tp_name), 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 254; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(((PyObject *)__pyx_v_docs_terms));
  __pyx_v_docs_terms = ((PyObject *)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":255
 *     current_recs = current_recs[1:-1]
 *     docs_terms = run_sql("SELECT id_bibrec, termlist FROM %sR WHERE id_bibrec IN (%s)" % (table[:-1], current_recs))
 *     return docs_terms             # <<<<<<<<<<<<<<
 * 
 * cdef serialize_via_marshal(obj):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(((PyObject *)__pyx_v_docs_terms));
  __pyx_r = ((PyObject *)__pyx_v_docs_terms);
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_1);
  __Pyx_XDECREF(__pyx_2);
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("bibrank_word_indexer_c.get_from_reverse_index");
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_current_recs);
  __Pyx_DECREF(__pyx_v_docs_terms);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_FinishRefcountContext();
  return __pyx_r;
}

/* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":250
 *     return terms_docs
 * 
 * cpdef get_from_reverse_index(list records, int start, int stop, str table):             # <<<<<<<<<<<<<<
 *     cdef str current_recs = "%s" % records[start:stop]
 *     cdef tuple docs_terms
 */

static PyObject *__pyx_pf_22bibrank_word_indexer_c_get_from_reverse_index(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pf_22bibrank_word_indexer_c_get_from_reverse_index(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_records = 0;
  int __pyx_v_start;
  int __pyx_v_stop;
  PyObject *__pyx_v_table = 0;
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_t_1 = NULL;
  static PyObject **__pyx_pyargnames[] = {&__pyx_kp_records,&__pyx_kp_start,&__pyx_kp_stop,&__pyx_kp_table,0};
  __Pyx_SetupRefcountContext("get_from_reverse_index");
  __pyx_self = __pyx_self;
  if (unlikely(__pyx_kwds)) {
    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
    PyObject* values[4] = {0,0,0,0};
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
      case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      case  0: break;
      default: goto __pyx_L5_argtuple_error;
    }
    switch (PyTuple_GET_SIZE(__pyx_args)) {
      case  0:
      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_kp_records);
      if (likely(values[0])) kw_args--;
      else goto __pyx_L5_argtuple_error;
      case  1:
      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_kp_start);
      if (likely(values[1])) kw_args--;
      else {
        __Pyx_RaiseArgtupleInvalid("get_from_reverse_index", 1, 4, 4, 1); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 250; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
      case  2:
      values[2] = PyDict_GetItem(__pyx_kwds, __pyx_kp_stop);
      if (likely(values[2])) kw_args--;
      else {
        __Pyx_RaiseArgtupleInvalid("get_from_reverse_index", 1, 4, 4, 2); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 250; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
      case  3:
      values[3] = PyDict_GetItem(__pyx_kwds, __pyx_kp_table);
      if (likely(values[3])) kw_args--;
      else {
        __Pyx_RaiseArgtupleInvalid("get_from_reverse_index", 1, 4, 4, 3); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 250; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    }
    if (unlikely(kw_args > 0)) {
      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "get_from_reverse_index") < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 250; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
    __pyx_v_records = ((PyObject *)values[0]);
    __pyx_v_start = __Pyx_PyInt_AsInt(values[1]); if (unlikely((__pyx_v_start == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 250; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    __pyx_v_stop = __Pyx_PyInt_AsInt(values[2]); if (unlikely((__pyx_v_stop == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 250; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    __pyx_v_table = ((PyObject *)values[3]);
  } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
    goto __pyx_L5_argtuple_error;
  } else {
    __pyx_v_records = ((PyObject *)PyTuple_GET_ITEM(__pyx_args, 0));
    __pyx_v_start = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 1)); if (unlikely((__pyx_v_start == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 250; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    __pyx_v_stop = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 2)); if (unlikely((__pyx_v_stop == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 250; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    __pyx_v_table = ((PyObject *)PyTuple_GET_ITEM(__pyx_args, 3));
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("get_from_reverse_index", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[0]; __pyx_lineno = 250; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  __pyx_L3_error:;
  __Pyx_AddTraceback("bibrank_word_indexer_c.get_from_reverse_index");
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_records), &PyList_Type, 1, "records", 1))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 250; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_table), &PyString_Type, 1, "table", 1))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 250; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __pyx_f_22bibrank_word_indexer_c_get_from_reverse_index(__pyx_v_records, __pyx_v_start, __pyx_v_stop, __pyx_v_table, 0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 250; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("bibrank_word_indexer_c.get_from_reverse_index");
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_FinishRefcountContext();
  return __pyx_r;
}

/* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":257
 *     return docs_terms
 * 
 * cdef serialize_via_marshal(obj):             # <<<<<<<<<<<<<<
 *     """Serialize Python object via marshal into a compressed string."""
 *     return compress(dumps(obj))
 */

static  PyObject *__pyx_f_22bibrank_word_indexer_c_serialize_via_marshal(PyObject *__pyx_v_obj) {
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  __Pyx_SetupRefcountContext("serialize_via_marshal");

  /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":259
 * cdef serialize_via_marshal(obj):
 *     """Serialize Python object via marshal into a compressed string."""
 *     return compress(dumps(obj))             # <<<<<<<<<<<<<<
 * 
 * cdef deserialize_via_marshal(str string):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_compress); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 259; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_kp_dumps); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 259; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_2);
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 259; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  __Pyx_INCREF(__pyx_v_obj);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_obj);
  __Pyx_GIVEREF(__pyx_v_obj);
  __pyx_t_2 = PyObject_Call(__pyx_2, ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 259; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 259; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_Call(__pyx_1, ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 259; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_1);
  __Pyx_XDECREF(__pyx_2);
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("bibrank_word_indexer_c.serialize_via_marshal");
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_FinishRefcountContext();
  return __pyx_r;
}

/* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":261
 *     return compress(dumps(obj))
 * 
 * cdef deserialize_via_marshal(str string):             # <<<<<<<<<<<<<<
 *     """Decompress and deserialize string into a Python object via marshal."""
 *     return loads(decompress(string))
 */

static  PyObject *__pyx_f_22bibrank_word_indexer_c_deserialize_via_marshal(PyObject *__pyx_v_string) {
  PyObject *__pyx_r = NULL;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  __Pyx_SetupRefcountContext("deserialize_via_marshal");

  /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":263
 * cdef deserialize_via_marshal(str string):
 *     """Decompress and deserialize string into a Python object via marshal."""
 *     return loads(decompress(string))             # <<<<<<<<<<<<<<
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_loads); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 263; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_kp_decompress); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 263; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_2);
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 263; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  __Pyx_INCREF(((PyObject *)__pyx_v_string));
  PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_v_string));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_string));
  __pyx_t_2 = PyObject_Call(__pyx_2, ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 263; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 263; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = PyObject_Call(__pyx_1, ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 263; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_1);
  __Pyx_XDECREF(__pyx_2);
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("bibrank_word_indexer_c.deserialize_via_marshal");
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_FinishRefcountContext();
  return __pyx_r;
}

static struct PyMethodDef __pyx_methods[] = {
  {__Pyx_NAMESTR("test"), (PyCFunction)__pyx_pf_22bibrank_word_indexer_c_test, METH_NOARGS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("update_rnkWORD"), (PyCFunction)__pyx_pf_22bibrank_word_indexer_c_update_rnkWORD, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_22bibrank_word_indexer_c_update_rnkWORD)},
  {__Pyx_NAMESTR("get_from_forward_index"), (PyCFunction)__pyx_pf_22bibrank_word_indexer_c_get_from_forward_index, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("get_from_forward_index_with_id"), (PyCFunction)__pyx_pf_22bibrank_word_indexer_c_get_from_forward_index_with_id, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
  {__Pyx_NAMESTR("get_from_reverse_index"), (PyCFunction)__pyx_pf_22bibrank_word_indexer_c_get_from_reverse_index, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
  {0, 0, 0, 0}
};

static void __pyx_init_filenames(void); /*proto*/

#if PY_MAJOR_VERSION >= 3
static struct PyModuleDef __pyx_moduledef = {
    PyModuleDef_HEAD_INIT,
    __Pyx_NAMESTR("bibrank_word_indexer_c"),
    __Pyx_DOCSTR(__pyx_mdoc), /* m_doc */
    -1, /* m_size */
    __pyx_methods /* m_methods */,
    NULL, /* m_reload */
    NULL, /* m_traverse */
    NULL, /* m_clear */
    NULL /* m_free */
};
#endif

static __Pyx_StringTabEntry __pyx_string_tab[] = {
  {&__pyx_kp___main__, __pyx_k___main__, sizeof(__pyx_k___main__), 1, 1, 1},
  {&__pyx_kp_1, __pyx_k_1, sizeof(__pyx_k_1), 1, 1, 1},
  {&__pyx_kp_2, __pyx_k_2, sizeof(__pyx_k_2), 1, 1, 1},
  {&__pyx_kp_3, __pyx_k_3, sizeof(__pyx_k_3), 1, 1, 1},
  {&__pyx_kp_table, __pyx_k_table, sizeof(__pyx_k_table), 1, 1, 1},
  {&__pyx_kp_terms, __pyx_k_terms, sizeof(__pyx_k_terms), 1, 1, 1},
  {&__pyx_kp_start, __pyx_k_start, sizeof(__pyx_k_start), 1, 1, 1},
  {&__pyx_kp_stop, __pyx_k_stop, sizeof(__pyx_k_stop), 1, 1, 1},
  {&__pyx_kp_records, __pyx_k_records, sizeof(__pyx_k_records), 1, 1, 1},
  {&__pyx_kp_marshal, __pyx_k_marshal, sizeof(__pyx_k_marshal), 1, 1, 1},
  {&__pyx_kp_loads, __pyx_k_loads, sizeof(__pyx_k_loads), 1, 1, 1},
  {&__pyx_kp_dumps, __pyx_k_dumps, sizeof(__pyx_k_dumps), 1, 1, 1},
  {&__pyx_kp_zlib, __pyx_k_zlib, sizeof(__pyx_k_zlib), 1, 1, 1},
  {&__pyx_kp_compress, __pyx_k_compress, sizeof(__pyx_k_compress), 1, 1, 1},
  {&__pyx_kp_decompress, __pyx_k_decompress, sizeof(__pyx_k_decompress), 1, 1, 1},
  {&__pyx_kp_time, __pyx_k_time, sizeof(__pyx_k_time), 1, 1, 1},
  {&__pyx_kp_4, __pyx_k_4, sizeof(__pyx_k_4), 1, 1, 1},
  {&__pyx_kp_task_get_option, __pyx_k_task_get_option, sizeof(__pyx_k_task_get_option), 1, 1, 1},
  {&__pyx_kp_5, __pyx_k_5, sizeof(__pyx_k_5), 1, 1, 1},
  {&__pyx_kp_6, __pyx_k_6, sizeof(__pyx_k_6), 1, 1, 1},
  {&__pyx_kp_write_message, __pyx_k_write_message, sizeof(__pyx_k_write_message), 1, 1, 1},
  {&__pyx_kp_7, __pyx_k_7, sizeof(__pyx_k_7), 1, 1, 1},
  {&__pyx_kp_register_exception, __pyx_k_register_exception, sizeof(__pyx_k_register_exception), 1, 1, 1},
  {&__pyx_kp_8, __pyx_k_8, sizeof(__pyx_k_8), 1, 1, 1},
  {&__pyx_kp_run_sql, __pyx_k_run_sql, sizeof(__pyx_k_run_sql), 1, 1, 1},
  {&__pyx_kp_10, __pyx_k_10, sizeof(__pyx_k_10), 0, 1, 0},
  {&__pyx_kp_11, __pyx_k_11, sizeof(__pyx_k_11), 0, 1, 0},
  {&__pyx_kp_14, __pyx_k_14, sizeof(__pyx_k_14), 0, 1, 0},
  {&__pyx_kp_15, __pyx_k_15, sizeof(__pyx_k_15), 0, 1, 0},
  {&__pyx_kp_has_key, __pyx_k_has_key, sizeof(__pyx_k_has_key), 1, 1, 1},
  {&__pyx_kp_19, __pyx_k_19, sizeof(__pyx_k_19), 0, 1, 0},
  {&__pyx_kp_20, __pyx_k_20, sizeof(__pyx_k_20), 0, 1, 0},
  {&__pyx_kp_iteritems, __pyx_k_iteritems, sizeof(__pyx_k_iteritems), 1, 1, 1},
  {&__pyx_kp_21, __pyx_k_21, sizeof(__pyx_k_21), 0, 1, 0},
  {&__pyx_kp_22, __pyx_k_22, sizeof(__pyx_k_22), 0, 1, 0},
  {&__pyx_kp_23, __pyx_k_23, sizeof(__pyx_k_23), 0, 1, 0},
  {&__pyx_kp_24, __pyx_k_24, sizeof(__pyx_k_24), 0, 1, 0},
  {&__pyx_kp_34, __pyx_k_34, sizeof(__pyx_k_34), 0, 1, 0},
  {&__pyx_kp_35, __pyx_k_35, sizeof(__pyx_k_35), 0, 1, 0},
  {&__pyx_kp_40, __pyx_k_40, sizeof(__pyx_k_40), 0, 1, 0},
  {&__pyx_kp_41, __pyx_k_41, sizeof(__pyx_k_41), 0, 1, 0},
  {&__pyx_kp_43, __pyx_k_43, sizeof(__pyx_k_43), 0, 1, 0},
  {&__pyx_kp_44, __pyx_k_44, sizeof(__pyx_k_44), 0, 1, 0},
  {&__pyx_kp_49, __pyx_k_49, sizeof(__pyx_k_49), 0, 1, 0},
  {&__pyx_kp_50, __pyx_k_50, sizeof(__pyx_k_50), 0, 1, 0},
  {&__pyx_kp_get, __pyx_k_get, sizeof(__pyx_k_get), 1, 1, 1},
  {&__pyx_kp_ZeroDivisionError, __pyx_k_ZeroDivisionError, sizeof(__pyx_k_ZeroDivisionError), 1, 1, 1},
  {&__pyx_kp_OverflowError, __pyx_k_OverflowError, sizeof(__pyx_k_OverflowError), 1, 1, 1},
  {&__pyx_kp_prefix, __pyx_k_prefix, sizeof(__pyx_k_prefix), 1, 1, 1},
  {&__pyx_kp_alert_admin, __pyx_k_alert_admin, sizeof(__pyx_k_alert_admin), 1, 1, 1},
  {&__pyx_kp_61, __pyx_k_61, sizeof(__pyx_k_61), 0, 1, 0},
  {&__pyx_kp_62, __pyx_k_62, sizeof(__pyx_k_62), 0, 1, 0},
  {&__pyx_kp_63, __pyx_k_63, sizeof(__pyx_k_63), 0, 1, 0},
  {&__pyx_kp_min, __pyx_k_min, sizeof(__pyx_k_min), 1, 1, 1},
  {&__pyx_kp_9, __pyx_k_9, sizeof(__pyx_k_9), 0, 0, 0},
  {&__pyx_kp_12, __pyx_k_12, sizeof(__pyx_k_12), 0, 0, 0},
  {&__pyx_kp_13, __pyx_k_13, sizeof(__pyx_k_13), 0, 0, 0},
  {&__pyx_kp_16, __pyx_k_16, sizeof(__pyx_k_16), 0, 0, 0},
  {&__pyx_kp_17, __pyx_k_17, sizeof(__pyx_k_17), 0, 0, 0},
  {&__pyx_kp_18, __pyx_k_18, sizeof(__pyx_k_18), 0, 0, 0},
  {&__pyx_kp_25, __pyx_k_25, sizeof(__pyx_k_25), 0, 0, 0},
  {&__pyx_kp_26, __pyx_k_26, sizeof(__pyx_k_26), 0, 0, 0},
  {&__pyx_kp_27, __pyx_k_27, sizeof(__pyx_k_27), 0, 0, 0},
  {&__pyx_kp_28, __pyx_k_28, sizeof(__pyx_k_28), 0, 0, 0},
  {&__pyx_kp_29, __pyx_k_29, sizeof(__pyx_k_29), 0, 0, 0},
  {&__pyx_kp_30, __pyx_k_30, sizeof(__pyx_k_30), 0, 0, 0},
  {&__pyx_kp_31, __pyx_k_31, sizeof(__pyx_k_31), 0, 0, 0},
  {&__pyx_kp_32, __pyx_k_32, sizeof(__pyx_k_32), 0, 0, 0},
  {&__pyx_kp_33, __pyx_k_33, sizeof(__pyx_k_33), 0, 0, 0},
  {&__pyx_kp_36, __pyx_k_36, sizeof(__pyx_k_36), 0, 0, 0},
  {&__pyx_kp_37, __pyx_k_37, sizeof(__pyx_k_37), 0, 0, 0},
  {&__pyx_kp_38, __pyx_k_38, sizeof(__pyx_k_38), 0, 0, 0},
  {&__pyx_kp_39, __pyx_k_39, sizeof(__pyx_k_39), 0, 0, 0},
  {&__pyx_kp_42, __pyx_k_42, sizeof(__pyx_k_42), 0, 0, 0},
  {&__pyx_kp_45, __pyx_k_45, sizeof(__pyx_k_45), 0, 0, 0},
  {&__pyx_kp_46, __pyx_k_46, sizeof(__pyx_k_46), 0, 0, 0},
  {&__pyx_kp_47, __pyx_k_47, sizeof(__pyx_k_47), 0, 0, 0},
  {&__pyx_kp_48, __pyx_k_48, sizeof(__pyx_k_48), 0, 0, 0},
  {&__pyx_kp_51, __pyx_k_51, sizeof(__pyx_k_51), 0, 0, 0},
  {&__pyx_kp_52, __pyx_k_52, sizeof(__pyx_k_52), 0, 0, 0},
  {&__pyx_kp_53, __pyx_k_53, sizeof(__pyx_k_53), 0, 0, 0},
  {&__pyx_kp_54, __pyx_k_54, sizeof(__pyx_k_54), 0, 0, 0},
  {&__pyx_kp_55, __pyx_k_55, sizeof(__pyx_k_55), 0, 0, 0},
  {&__pyx_kp_56, __pyx_k_56, sizeof(__pyx_k_56), 0, 0, 0},
  {&__pyx_kp_57, __pyx_k_57, sizeof(__pyx_k_57), 0, 0, 0},
  {&__pyx_kp_58, __pyx_k_58, sizeof(__pyx_k_58), 0, 0, 0},
  {&__pyx_kp_59, __pyx_k_59, sizeof(__pyx_k_59), 0, 0, 0},
  {&__pyx_kp_60, __pyx_k_60, sizeof(__pyx_k_60), 0, 0, 0},
  {&__pyx_kp_64, __pyx_k_64, sizeof(__pyx_k_64), 0, 0, 0},
  {&__pyx_kp_65, __pyx_k_65, sizeof(__pyx_k_65), 0, 0, 0},
  {&__pyx_kp_66, __pyx_k_66, sizeof(__pyx_k_66), 0, 0, 0},
  {&__pyx_kp_67, __pyx_k_67, sizeof(__pyx_k_67), 0, 0, 0},
  {&__pyx_kp_68, __pyx_k_68, sizeof(__pyx_k_68), 0, 0, 0},
  {&__pyx_kp_69, __pyx_k_69, sizeof(__pyx_k_69), 0, 0, 0},
  {&__pyx_kp_70, __pyx_k_70, sizeof(__pyx_k_70), 0, 0, 0},
  {&__pyx_kp_71, __pyx_k_71, sizeof(__pyx_k_71), 0, 0, 0},
  {&__pyx_kp_72, __pyx_k_72, sizeof(__pyx_k_72), 0, 0, 0},
  {&__pyx_kp_73, __pyx_k_73, sizeof(__pyx_k_73), 0, 0, 0},
  {&__pyx_kp_74, __pyx_k_74, sizeof(__pyx_k_74), 0, 0, 0},
  {&__pyx_kp_75, __pyx_k_75, sizeof(__pyx_k_75), 0, 0, 0},
  {0, 0, 0, 0, 0, 0}
};
static int __Pyx_InitCachedBuiltins(void) {
  __pyx_builtin_ZeroDivisionError = __Pyx_GetName(__pyx_b, __pyx_kp_ZeroDivisionError); if (!__pyx_builtin_ZeroDivisionError) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 198; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_builtin_OverflowError = __Pyx_GetName(__pyx_b, __pyx_kp_OverflowError); if (!__pyx_builtin_OverflowError) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 198; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_builtin_min = __Pyx_GetName(__pyx_b, __pyx_kp_min); if (!__pyx_builtin_min) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 241; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  return 0;
  __pyx_L1_error:;
  return -1;
}

static int __Pyx_InitGlobals(void) {
  __pyx_int_0 = PyInt_FromLong(0); if (unlikely(!__pyx_int_0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_1 = PyInt_FromLong(1); if (unlikely(!__pyx_int_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_2 = PyInt_FromLong(2); if (unlikely(!__pyx_int_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_100 = PyInt_FromLong(100); if (unlikely(!__pyx_int_100)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_60 = PyInt_FromLong(60); if (unlikely(!__pyx_int_60)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  if (__Pyx_InitStrings(__pyx_string_tab) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  return 0;
  __pyx_L1_error:;
  return -1;
}

#if PY_MAJOR_VERSION < 3
PyMODINIT_FUNC initbibrank_word_indexer_c(void); /*proto*/
PyMODINIT_FUNC initbibrank_word_indexer_c(void)
#else
PyMODINIT_FUNC PyInit_bibrank_word_indexer_c(void); /*proto*/
PyMODINIT_FUNC PyInit_bibrank_word_indexer_c(void)
#endif
{
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_t_1 = NULL;
  #ifdef CYTHON_REFNANNY
  void* __pyx_refchk = NULL;
  __Pyx_Refnanny = __Pyx_ImportRefcountAPI("refnanny");
  if (!__Pyx_Refnanny) {
      PyErr_Clear();
      __Pyx_Refnanny = __Pyx_ImportRefcountAPI("Cython.Runtime.refnanny");
      if (!__Pyx_Refnanny)
          Py_FatalError("failed to import refnanny module");
  }
  __pyx_refchk = __Pyx_Refnanny->NewContext("PyMODINIT_FUNC PyInit_bibrank_word_indexer_c(void)", __LINE__, __FILE__);
  #endif
  __pyx_empty_tuple = PyTuple_New(0); if (unlikely(!__pyx_empty_tuple)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  /*--- Library function declarations ---*/
  __pyx_init_filenames();
  /*--- Threads initialization code ---*/
  #if defined(__PYX_FORCE_INIT_THREADS) && __PYX_FORCE_INIT_THREADS
  #ifdef WITH_THREAD /* Python build with threading support? */
  PyEval_InitThreads();
  #endif
  #endif
  /*--- Initialize various global constants etc. ---*/
  if (unlikely(__Pyx_InitGlobals() < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  /*--- Module creation code ---*/
  #if PY_MAJOR_VERSION < 3
  __pyx_m = Py_InitModule4(__Pyx_NAMESTR("bibrank_word_indexer_c"), __pyx_methods, __pyx_mdoc, 0, PYTHON_API_VERSION);
  #else
  __pyx_m = PyModule_Create(&__pyx_moduledef);
  #endif
  if (!__pyx_m) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  #if PY_MAJOR_VERSION < 3
  Py_INCREF(__pyx_m);
  #endif
  __pyx_b = PyImport_AddModule(__Pyx_NAMESTR(__Pyx_BUILTIN_MODULE_NAME));
  if (!__pyx_b) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  if (__Pyx_SetAttrString(__pyx_m, "__builtins__", __pyx_b) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  if (__pyx_module_is_main_bibrank_word_indexer_c) {
    if (__Pyx_SetAttrString(__pyx_m, "__name__", __pyx_kp___main__) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  }
  /*--- Builtin init code ---*/
  if (unlikely(__Pyx_InitCachedBuiltins() < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_skip_dispatch = 0;
  /*--- Global init code ---*/
  /*--- Function export code ---*/
  /*--- Type init code ---*/
  /*--- Type import code ---*/
  /*--- Function import code ---*/
  /*--- Execution code ---*/

  /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":22
 * """
 * 
 * from marshal import loads, dumps             # <<<<<<<<<<<<<<
 * from zlib import compress, decompress
 * from time import time
 */
  __pyx_t_1 = PyList_New(2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 22; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  __Pyx_INCREF(__pyx_kp_loads);
  PyList_SET_ITEM(__pyx_t_1, 0, __pyx_kp_loads);
  __Pyx_GIVEREF(__pyx_kp_loads);
  __Pyx_INCREF(__pyx_kp_dumps);
  PyList_SET_ITEM(__pyx_t_1, 1, __pyx_kp_dumps);
  __Pyx_GIVEREF(__pyx_kp_dumps);
  __pyx_1 = __Pyx_Import(__pyx_kp_marshal, ((PyObject *)__pyx_t_1)); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 22; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_2 = PyObject_GetAttr(__pyx_1, __pyx_kp_loads); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 22; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_2);
  if (PyObject_SetAttr(__pyx_m, __pyx_kp_loads, __pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 22; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_2 = PyObject_GetAttr(__pyx_1, __pyx_kp_dumps); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 22; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_2);
  if (PyObject_SetAttr(__pyx_m, __pyx_kp_dumps, __pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 22; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":23
 * 
 * from marshal import loads, dumps
 * from zlib import compress, decompress             # <<<<<<<<<<<<<<
 * from time import time
 * from invenio.bibtask import task_get_option, task_update_progress, \
 */
  __pyx_t_1 = PyList_New(2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 23; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  __Pyx_INCREF(__pyx_kp_compress);
  PyList_SET_ITEM(__pyx_t_1, 0, __pyx_kp_compress);
  __Pyx_GIVEREF(__pyx_kp_compress);
  __Pyx_INCREF(__pyx_kp_decompress);
  PyList_SET_ITEM(__pyx_t_1, 1, __pyx_kp_decompress);
  __Pyx_GIVEREF(__pyx_kp_decompress);
  __pyx_1 = __Pyx_Import(__pyx_kp_zlib, ((PyObject *)__pyx_t_1)); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 23; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_2 = PyObject_GetAttr(__pyx_1, __pyx_kp_compress); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 23; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_2);
  if (PyObject_SetAttr(__pyx_m, __pyx_kp_compress, __pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 23; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_2 = PyObject_GetAttr(__pyx_1, __pyx_kp_decompress); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 23; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_2);
  if (PyObject_SetAttr(__pyx_m, __pyx_kp_decompress, __pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 23; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":24
 * from marshal import loads, dumps
 * from zlib import compress, decompress
 * from time import time             # <<<<<<<<<<<<<<
 * from invenio.bibtask import task_get_option, task_update_progress, \
 *     task_sleep_now_if_required, write_message
 */
  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 24; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  __Pyx_INCREF(__pyx_kp_time);
  PyList_SET_ITEM(__pyx_t_1, 0, __pyx_kp_time);
  __Pyx_GIVEREF(__pyx_kp_time);
  __pyx_1 = __Pyx_Import(__pyx_kp_time, ((PyObject *)__pyx_t_1)); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 24; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_2 = PyObject_GetAttr(__pyx_1, __pyx_kp_time); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 24; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_2);
  if (PyObject_SetAttr(__pyx_m, __pyx_kp_time, __pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 24; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":26
 * from time import time
 * from invenio.bibtask import task_get_option, task_update_progress, \
 *     task_sleep_now_if_required, write_message             # <<<<<<<<<<<<<<
 * 
 * from invenio.errorlib import register_exception
 */
  __pyx_t_1 = PyList_New(4); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 25; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  __Pyx_INCREF(__pyx_kp_task_get_option);
  PyList_SET_ITEM(__pyx_t_1, 0, __pyx_kp_task_get_option);
  __Pyx_GIVEREF(__pyx_kp_task_get_option);
  __Pyx_INCREF(__pyx_kp_5);
  PyList_SET_ITEM(__pyx_t_1, 1, __pyx_kp_5);
  __Pyx_GIVEREF(__pyx_kp_5);
  __Pyx_INCREF(__pyx_kp_6);
  PyList_SET_ITEM(__pyx_t_1, 2, __pyx_kp_6);
  __Pyx_GIVEREF(__pyx_kp_6);
  __Pyx_INCREF(__pyx_kp_write_message);
  PyList_SET_ITEM(__pyx_t_1, 3, __pyx_kp_write_message);
  __Pyx_GIVEREF(__pyx_kp_write_message);
  __pyx_1 = __Pyx_Import(__pyx_kp_4, ((PyObject *)__pyx_t_1)); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 25; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_2 = PyObject_GetAttr(__pyx_1, __pyx_kp_task_get_option); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 25; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_2);
  if (PyObject_SetAttr(__pyx_m, __pyx_kp_task_get_option, __pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 25; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_2 = PyObject_GetAttr(__pyx_1, __pyx_kp_5); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 25; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_2);
  if (PyObject_SetAttr(__pyx_m, __pyx_kp_5, __pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 25; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_2 = PyObject_GetAttr(__pyx_1, __pyx_kp_6); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 25; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_2);
  if (PyObject_SetAttr(__pyx_m, __pyx_kp_6, __pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 26; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_2 = PyObject_GetAttr(__pyx_1, __pyx_kp_write_message); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 25; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_2);
  if (PyObject_SetAttr(__pyx_m, __pyx_kp_write_message, __pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 26; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":28
 *     task_sleep_now_if_required, write_message
 * 
 * from invenio.errorlib import register_exception             # <<<<<<<<<<<<<<
 * from invenio.dbquery import run_sql
 * 
 */
  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 28; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  __Pyx_INCREF(__pyx_kp_register_exception);
  PyList_SET_ITEM(__pyx_t_1, 0, __pyx_kp_register_exception);
  __Pyx_GIVEREF(__pyx_kp_register_exception);
  __pyx_1 = __Pyx_Import(__pyx_kp_7, ((PyObject *)__pyx_t_1)); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 28; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_2 = PyObject_GetAttr(__pyx_1, __pyx_kp_register_exception); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 28; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_2);
  if (PyObject_SetAttr(__pyx_m, __pyx_kp_register_exception, __pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 28; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":29
 * 
 * from invenio.errorlib import register_exception
 * from invenio.dbquery import run_sql             # <<<<<<<<<<<<<<
 * 
 * cdef extern from "math.h":
 */
  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 29; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
  __Pyx_INCREF(__pyx_kp_run_sql);
  PyList_SET_ITEM(__pyx_t_1, 0, __pyx_kp_run_sql);
  __Pyx_GIVEREF(__pyx_kp_run_sql);
  __pyx_1 = __Pyx_Import(__pyx_kp_8, ((PyObject *)__pyx_t_1)); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 29; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_1);
  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_2 = PyObject_GetAttr(__pyx_1, __pyx_kp_run_sql); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 29; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_2);
  if (PyObject_SetAttr(__pyx_m, __pyx_kp_run_sql, __pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 29; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_DECREF(__pyx_2); __pyx_2 = 0;
  __Pyx_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/mnt/disk1/build/cds-invenio/modules/bibrank/lib/bibrank_word_indexer_c.pyx":261
 *     return compress(dumps(obj))
 * 
 * cdef deserialize_via_marshal(str string):             # <<<<<<<<<<<<<<
 *     """Decompress and deserialize string into a Python object via marshal."""
 *     return loads(decompress(string))
 */
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_1);
  __Pyx_XDECREF(__pyx_2);
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("bibrank_word_indexer_c");
  Py_DECREF(__pyx_m); __pyx_m = 0;
  __pyx_L0:;
  __Pyx_FinishRefcountContext();
  #if PY_MAJOR_VERSION < 3
  return;
  #else
  return __pyx_m;
  #endif
}

static const char *__pyx_filenames[] = {
  "bibrank_word_indexer_c.pyx",
};

/* Runtime support code */

static void __pyx_init_filenames(void) {
  __pyx_f = __pyx_filenames;
}

static void __Pyx_RaiseDoubleKeywordsError(
    const char* func_name,
    PyObject* kw_name)
{
    PyErr_Format(PyExc_TypeError,
        #if PY_MAJOR_VERSION >= 3
        "%s() got multiple values for keyword argument '%U'", func_name, kw_name);
        #else
        "%s() got multiple values for keyword argument '%s'", func_name,
        PyString_AS_STRING(kw_name));
        #endif
}

static void __Pyx_RaiseArgtupleInvalid(
    const char* func_name,
    int exact,
    Py_ssize_t num_min,
    Py_ssize_t num_max,
    Py_ssize_t num_found)
{
    Py_ssize_t num_expected;
    const char *number, *more_or_less;

    if (num_found < num_min) {
        num_expected = num_min;
        more_or_less = "at least";
    } else {
        num_expected = num_max;
        more_or_less = "at most";
    }
    if (exact) {
        more_or_less = "exactly";
    }
    number = (num_expected == 1) ? "" : "s";
    PyErr_Format(PyExc_TypeError,
        #if PY_VERSION_HEX < 0x02050000
            "%s() takes %s %d positional argument%s (%d given)",
        #else
            "%s() takes %s %zd positional argument%s (%zd given)",
        #endif
        func_name, more_or_less, num_expected, number, num_found);
}

static int __Pyx_ParseOptionalKeywords(
    PyObject *kwds,
    PyObject **argnames[],
    PyObject *kwds2,
    PyObject *values[],
    Py_ssize_t num_pos_args,
    const char* function_name)
{
    PyObject *key = 0, *value = 0;
    Py_ssize_t pos = 0;
    PyObject*** name;
    PyObject*** first_kw_arg = argnames + num_pos_args;

    while (PyDict_Next(kwds, &pos, &key, &value)) {
        name = first_kw_arg;
        while (*name && (**name != key)) name++;
        if (*name) {
            values[name-argnames] = value;
        } else {
            #if PY_MAJOR_VERSION < 3
            if (unlikely(!PyString_CheckExact(key)) && unlikely(!PyString_Check(key))) {
            #else
            if (unlikely(!PyUnicode_CheckExact(key)) && unlikely(!PyUnicode_Check(key))) {
            #endif
                goto invalid_keyword_type;
            } else {
                for (name = first_kw_arg; *name; name++) {
                    #if PY_MAJOR_VERSION >= 3
                    if (PyUnicode_GET_SIZE(**name) == PyUnicode_GET_SIZE(key) &&
                        PyUnicode_Compare(**name, key) == 0) break;
                    #else
                    if (PyString_GET_SIZE(**name) == PyString_GET_SIZE(key) &&
                        _PyString_Eq(**name, key)) break;
                    #endif
                }
                if (*name) {
                    values[name-argnames] = value;
                } else {
                    /* unexpected keyword found */
                    for (name=argnames; name != first_kw_arg; name++) {
                        if (**name == key) goto arg_passed_twice;
                        #if PY_MAJOR_VERSION >= 3
                        if (PyUnicode_GET_SIZE(**name) == PyUnicode_GET_SIZE(key) &&
                            PyUnicode_Compare(**name, key) == 0) goto arg_passed_twice;
                        #else
                        if (PyString_GET_SIZE(**name) == PyString_GET_SIZE(key) &&
                            _PyString_Eq(**name, key)) goto arg_passed_twice;
                        #endif
                    }
                    if (kwds2) {
                        if (unlikely(PyDict_SetItem(kwds2, key, value))) goto bad;
                    } else {
                        goto invalid_keyword;
                    }
                }
            }
        }
    }
    return 0;
arg_passed_twice:
    __Pyx_RaiseDoubleKeywordsError(function_name, **name);
    goto bad;
invalid_keyword_type:
    PyErr_Format(PyExc_TypeError,
        "%s() keywords must be strings", function_name);
    goto bad;
invalid_keyword:
    PyErr_Format(PyExc_TypeError,
    #if PY_MAJOR_VERSION < 3
        "%s() got an unexpected keyword argument '%s'",
        function_name, PyString_AsString(key));
    #else
        "%s() got an unexpected keyword argument '%U'",
        function_name, key);
    #endif
bad:
    return -1;
}



static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb) {
    PyObject *tmp_type, *tmp_value, *tmp_tb;
    PyThreadState *tstate = PyThreadState_GET();
    *type = tstate->curexc_type;
    *value = tstate->curexc_value;
    *tb = tstate->curexc_traceback;
    tstate->curexc_type = 0;
    tstate->curexc_value = 0;
    tstate->curexc_traceback = 0;
    PyErr_NormalizeException(type, value, tb);
    if (PyErr_Occurred())
        goto bad;
    Py_INCREF(*type);
    Py_INCREF(*value);
    Py_INCREF(*tb);
    tmp_type = tstate->exc_type;
    tmp_value = tstate->exc_value;
    tmp_tb = tstate->exc_traceback;
    tstate->exc_type = *type;
    tstate->exc_value = *value;
    tstate->exc_traceback = *tb;
    /* Make sure tstate is in a consistent state when we XDECREF
    these objects (XDECREF may run arbitrary code). */
    Py_XDECREF(tmp_type);
    Py_XDECREF(tmp_value);
    Py_XDECREF(tmp_tb);
    return 0;
bad:
    Py_XDECREF(*type);
    Py_XDECREF(*value);
    Py_XDECREF(*tb);
    return -1;
}


static int __Pyx_ArgTypeTest(PyObject *obj, PyTypeObject *type, int none_allowed,
    const char *name, int exact)
{
    if (!type) {
        PyErr_Format(PyExc_SystemError, "Missing type object");
        return 0;
    }
    if (none_allowed && obj == Py_None) return 1;
    else if (exact) {
        if (Py_TYPE(obj) == type) return 1;
    }
    else {
        if (PyObject_TypeCheck(obj, type)) return 1;
    }
    PyErr_Format(PyExc_TypeError,
        "Argument '%s' has incorrect type (expected %s, got %s)",
        name, type->tp_name, Py_TYPE(obj)->tp_name);
    return 0;
}

static INLINE void __Pyx_ExceptionSave(PyObject **type, PyObject **value, PyObject **tb) {
    PyThreadState *tstate = PyThreadState_GET();
    *type = tstate->exc_type;
    *value = tstate->exc_value;
    *tb = tstate->exc_traceback;
    Py_XINCREF(*type);
    Py_XINCREF(*value);
    Py_XINCREF(*tb);
}

static void __Pyx_ExceptionReset(PyObject *type, PyObject *value, PyObject *tb) {
    PyObject *tmp_type, *tmp_value, *tmp_tb;
    PyThreadState *tstate = PyThreadState_GET();
    tmp_type = tstate->exc_type;
    tmp_value = tstate->exc_value;
    tmp_tb = tstate->exc_traceback;
    tstate->exc_type = type;
    tstate->exc_value = value;
    tstate->exc_traceback = tb;
    Py_XDECREF(tmp_type);
    Py_XDECREF(tmp_value);
    Py_XDECREF(tmp_tb);
}

static PyObject *__Pyx_Import(PyObject *name, PyObject *from_list) {
    PyObject *__import__ = 0;
    PyObject *empty_list = 0;
    PyObject *module = 0;
    PyObject *global_dict = 0;
    PyObject *empty_dict = 0;
    PyObject *list;
    __import__ = __Pyx_GetAttrString(__pyx_b, "__import__");
    if (!__import__)
        goto bad;
    if (from_list)
        list = from_list;
    else {
        empty_list = PyList_New(0);
        if (!empty_list)
            goto bad;
        list = empty_list;
    }
    global_dict = PyModule_GetDict(__pyx_m);
    if (!global_dict)
        goto bad;
    empty_dict = PyDict_New();
    if (!empty_dict)
        goto bad;
    module = PyObject_CallFunctionObjArgs(__import__,
        name, global_dict, empty_dict, list, NULL);
bad:
    Py_XDECREF(empty_list);
    Py_XDECREF(__import__);
    Py_XDECREF(empty_dict);
    return module;
}

#if PY_MAJOR_VERSION < 3
static PyObject *__Pyx_GetStdout(void) {
    PyObject *f = PySys_GetObject((char *)"stdout");
    if (!f) {
        PyErr_SetString(PyExc_RuntimeError, "lost sys.stdout");
    }
    return f;
}

static int __Pyx_Print(PyObject *arg_tuple, int newline) {
    PyObject *f;
    PyObject* v;
    int i;

    if (!(f = __Pyx_GetStdout()))
        return -1;
    for (i=0; i < PyTuple_GET_SIZE(arg_tuple); i++) {
        if (PyFile_SoftSpace(f, 1)) {
            if (PyFile_WriteString(" ", f) < 0)
                return -1;
        }
        v = PyTuple_GET_ITEM(arg_tuple, i);
        if (PyFile_WriteObject(v, f, Py_PRINT_RAW) < 0)
            return -1;
        if (PyString_Check(v)) {
            char *s = PyString_AsString(v);
            Py_ssize_t len = PyString_Size(v);
            if (len > 0 &&
                isspace(Py_CHARMASK(s[len-1])) &&
                s[len-1] != ' ')
                    PyFile_SoftSpace(f, 0);
        }
    }
    if (newline) {
        if (PyFile_WriteString("\n", f) < 0)
            return -1;
        PyFile_SoftSpace(f, 0);
    }
    return 0;
}

#else /* Python 3 has a print function */

static int __Pyx_Print(PyObject *arg_tuple, int newline) {
    PyObject* kwargs = 0;
    PyObject* result = 0;
    PyObject* end_string;
    if (!__pyx_print) {
        __pyx_print = __Pyx_GetAttrString(__pyx_b, "print");
        if (!__pyx_print)
            return -1;
    }
    if (!newline) {
        if (!__pyx_print_kwargs) {
            __pyx_print_kwargs = PyDict_New();
            if (!__pyx_print_kwargs)
                return -1;
            end_string = PyUnicode_FromStringAndSize(" ", 1);
            if (!end_string)
                return -1;
            if (PyDict_SetItemString(__pyx_print_kwargs, "end", end_string) < 0) {
                Py_DECREF(end_string);
                return -1;
            }
            Py_DECREF(end_string);
        }
        kwargs = __pyx_print_kwargs;
    }
    result = PyObject_Call(__pyx_print, arg_tuple, kwargs);
    if (!result)
        return -1;
    Py_DECREF(result);
    return 0;
}

#endif

#if PY_MAJOR_VERSION < 3

static int __Pyx_PrintOne(PyObject *o) {
    PyObject *f;
    if (!(f = __Pyx_GetStdout()))
        return -1;
    if (PyFile_SoftSpace(f, 0)) {
        if (PyFile_WriteString(" ", f) < 0)
            return -1;
    }
    if (PyFile_WriteObject(o, f, Py_PRINT_RAW) < 0)
        return -1;
    if (PyFile_WriteString("\n", f) < 0)
        return -1;
    return 0;
    /* the line below is just to avoid compiler
     * compiler warnings about unused functions */
    return __Pyx_Print(NULL, 0);
}

#else /* Python 3 has a print function */

static int __Pyx_PrintOne(PyObject *o) {
    int res;
    PyObject* arg_tuple = PyTuple_New(1);
    if (unlikely(!arg_tuple))
        return -1;
    Py_INCREF(o);
    PyTuple_SET_ITEM(arg_tuple, 0, o);
    res = __Pyx_Print(arg_tuple, 1);
    Py_DECREF(arg_tuple);
    return res;
}

#endif

static PyObject *__Pyx_GetName(PyObject *dict, PyObject *name) {
    PyObject *result;
    result = PyObject_GetAttr(dict, name);
    if (!result)
        PyErr_SetObject(PyExc_NameError, name);
    return result;
}

static INLINE void __Pyx_RaiseNeedMoreValuesError(Py_ssize_t index) {
    PyErr_Format(PyExc_ValueError,
        #if PY_VERSION_HEX < 0x02050000
                 "need more than %d value%s to unpack", (int)index,
        #else
                 "need more than %zd value%s to unpack", index,
        #endif
                 (index == 1) ? "" : "s");
}

static INLINE void __Pyx_RaiseTooManyValuesError(void) {
    PyErr_SetString(PyExc_ValueError, "too many values to unpack");
}

static PyObject *__Pyx_UnpackItem(PyObject *iter, Py_ssize_t index) {
    PyObject *item;
    if (!(item = PyIter_Next(iter))) {
        if (!PyErr_Occurred()) {
            __Pyx_RaiseNeedMoreValuesError(index);
        }
    }
    return item;
}

static int __Pyx_EndUnpack(PyObject *iter) {
    PyObject *item;
    if ((item = PyIter_Next(iter))) {
        Py_DECREF(item);
        __Pyx_RaiseTooManyValuesError();
        return -1;
    }
    else if (!PyErr_Occurred())
        return 0;
    else
        return -1;
}

static INLINE int __Pyx_StrEq(const char *s1, const char *s2) {
     while (*s1 != '\0' && *s1 == *s2) { s1++; s2++; }
     return *s1 == *s2;
}

static INLINE unsigned char __Pyx_PyInt_AsUnsignedChar(PyObject* x) {
    if (sizeof(unsigned char) < sizeof(long)) {
        long val = __Pyx_PyInt_AsLong(x);
        if (unlikely(val != (long)(unsigned char)val)) {
            if (unlikely(val == -1 && PyErr_Occurred()))
                return (unsigned char)-1;
            if (unlikely(val < 0)) {
                PyErr_SetString(PyExc_OverflowError,
                                "can't convert negative value to unsigned char");
                return (unsigned char)-1;
            }
            PyErr_SetString(PyExc_OverflowError,
                           "value too large to convert to unsigned char");
            return (unsigned char)-1;
        }
        return (unsigned char)val;
    }
    return (unsigned char)__Pyx_PyInt_AsUnsignedLong(x);
}

static INLINE unsigned short __Pyx_PyInt_AsUnsignedShort(PyObject* x) {
    if (sizeof(unsigned short) < sizeof(long)) {
        long val = __Pyx_PyInt_AsLong(x);
        if (unlikely(val != (long)(unsigned short)val)) {
            if (unlikely(val == -1 && PyErr_Occurred()))
                return (unsigned short)-1;
            if (unlikely(val < 0)) {
                PyErr_SetString(PyExc_OverflowError,
                                "can't convert negative value to unsigned short");
                return (unsigned short)-1;
            }
            PyErr_SetString(PyExc_OverflowError,
                           "value too large to convert to unsigned short");
            return (unsigned short)-1;
        }
        return (unsigned short)val;
    }
    return (unsigned short)__Pyx_PyInt_AsUnsignedLong(x);
}

static INLINE unsigned int __Pyx_PyInt_AsUnsignedInt(PyObject* x) {
    if (sizeof(unsigned int) < sizeof(long)) {
        long val = __Pyx_PyInt_AsLong(x);
        if (unlikely(val != (long)(unsigned int)val)) {
            if (unlikely(val == -1 && PyErr_Occurred()))
                return (unsigned int)-1;
            if (unlikely(val < 0)) {
                PyErr_SetString(PyExc_OverflowError,
                                "can't convert negative value to unsigned int");
                return (unsigned int)-1;
            }
            PyErr_SetString(PyExc_OverflowError,
                           "value too large to convert to unsigned int");
            return (unsigned int)-1;
        }
        return (unsigned int)val;
    }
    return (unsigned int)__Pyx_PyInt_AsUnsignedLong(x);
}

static INLINE char __Pyx_PyInt_AsChar(PyObject* x) {
    if (sizeof(char) < sizeof(long)) {
        long val = __Pyx_PyInt_AsLong(x);
        if (unlikely(val != (long)(char)val)) {
            if (unlikely(val == -1 && PyErr_Occurred()))
                return (char)-1;
            PyErr_SetString(PyExc_OverflowError,
                           "value too large to convert to char");
            return (char)-1;
        }
        return (char)val;
    }
    return (char)__Pyx_PyInt_AsLong(x);
}

static INLINE short __Pyx_PyInt_AsShort(PyObject* x) {
    if (sizeof(short) < sizeof(long)) {
        long val = __Pyx_PyInt_AsLong(x);
        if (unlikely(val != (long)(short)val)) {
            if (unlikely(val == -1 && PyErr_Occurred()))
                return (short)-1;
            PyErr_SetString(PyExc_OverflowError,
                           "value too large to convert to short");
            return (short)-1;
        }
        return (short)val;
    }
    return (short)__Pyx_PyInt_AsLong(x);
}

static INLINE int __Pyx_PyInt_AsInt(PyObject* x) {
    if (sizeof(int) < sizeof(long)) {
        long val = __Pyx_PyInt_AsLong(x);
        if (unlikely(val != (long)(int)val)) {
            if (unlikely(val == -1 && PyErr_Occurred()))
                return (int)-1;
            PyErr_SetString(PyExc_OverflowError,
                           "value too large to convert to int");
            return (int)-1;
        }
        return (int)val;
    }
    return (int)__Pyx_PyInt_AsLong(x);
}

static INLINE signed char __Pyx_PyInt_AsSignedChar(PyObject* x) {
    if (sizeof(signed char) < sizeof(long)) {
        long val = __Pyx_PyInt_AsLong(x);
        if (unlikely(val != (long)(signed char)val)) {
            if (unlikely(val == -1 && PyErr_Occurred()))
                return (signed char)-1;
            PyErr_SetString(PyExc_OverflowError,
                           "value too large to convert to signed char");
            return (signed char)-1;
        }
        return (signed char)val;
    }
    return (signed char)__Pyx_PyInt_AsSignedLong(x);
}

static INLINE signed short __Pyx_PyInt_AsSignedShort(PyObject* x) {
    if (sizeof(signed short) < sizeof(long)) {
        long val = __Pyx_PyInt_AsLong(x);
        if (unlikely(val != (long)(signed short)val)) {
            if (unlikely(val == -1 && PyErr_Occurred()))
                return (signed short)-1;
            PyErr_SetString(PyExc_OverflowError,
                           "value too large to convert to signed short");
            return (signed short)-1;
        }
        return (signed short)val;
    }
    return (signed short)__Pyx_PyInt_AsSignedLong(x);
}

static INLINE signed int __Pyx_PyInt_AsSignedInt(PyObject* x) {
    if (sizeof(signed int) < sizeof(long)) {
        long val = __Pyx_PyInt_AsLong(x);
        if (unlikely(val != (long)(signed int)val)) {
            if (unlikely(val == -1 && PyErr_Occurred()))
                return (signed int)-1;
            PyErr_SetString(PyExc_OverflowError,
                           "value too large to convert to signed int");
            return (signed int)-1;
        }
        return (signed int)val;
    }
    return (signed int)__Pyx_PyInt_AsSignedLong(x);
}

static INLINE unsigned long __Pyx_PyInt_AsUnsignedLong(PyObject* x) {
#if PY_VERSION_HEX < 0x03000000
    if (likely(PyInt_CheckExact(x) || PyInt_Check(x))) {
        long val = PyInt_AS_LONG(x);
        if (unlikely(val < 0)) {
            PyErr_SetString(PyExc_OverflowError,
                            "can't convert negative value to unsigned long");
            return (unsigned long)-1;
        }
        return (unsigned long)val;
    } else
#endif
    if (likely(PyLong_CheckExact(x) || PyLong_Check(x))) {
        if (unlikely(Py_SIZE(x) < 0)) {
            PyErr_SetString(PyExc_OverflowError,
                            "can't convert negative value to unsigned long");
            return (unsigned long)-1;
        }
        return PyLong_AsUnsignedLong(x);
    } else {
        unsigned long val;
        PyObject *tmp = __Pyx_PyNumber_Int(x);
        if (!tmp) return (unsigned long)-1;
        val = __Pyx_PyInt_AsUnsignedLong(tmp);
        Py_DECREF(tmp);
        return val;
    }
}

static INLINE unsigned PY_LONG_LONG __Pyx_PyInt_AsUnsignedLongLong(PyObject* x) {
#if PY_VERSION_HEX < 0x03000000
    if (likely(PyInt_CheckExact(x) || PyInt_Check(x))) {
        long val = PyInt_AS_LONG(x);
        if (unlikely(val < 0)) {
            PyErr_SetString(PyExc_OverflowError,
                            "can't convert negative value to unsigned PY_LONG_LONG");
            return (unsigned PY_LONG_LONG)-1;
        }
        return (unsigned PY_LONG_LONG)val;
    } else
#endif
    if (likely(PyLong_CheckExact(x) || PyLong_Check(x))) {
        if (unlikely(Py_SIZE(x) < 0)) {
            PyErr_SetString(PyExc_OverflowError,
                            "can't convert negative value to unsigned PY_LONG_LONG");
            return (unsigned PY_LONG_LONG)-1;
        }
        return PyLong_AsUnsignedLongLong(x);
    } else {
        unsigned PY_LONG_LONG val;
        PyObject *tmp = __Pyx_PyNumber_Int(x);
        if (!tmp) return (unsigned PY_LONG_LONG)-1;
        val = __Pyx_PyInt_AsUnsignedLongLong(tmp);
        Py_DECREF(tmp);
        return val;
    }
}

static INLINE long __Pyx_PyInt_AsLong(PyObject* x) {
#if PY_VERSION_HEX < 0x03000000
    if (likely(PyInt_CheckExact(x) || PyInt_Check(x))) {
        long val = PyInt_AS_LONG(x);
        return (long)val;
    } else
#endif
    if (likely(PyLong_CheckExact(x) || PyLong_Check(x))) {
        return PyLong_AsLong(x);
    } else {
        long val;
        PyObject *tmp = __Pyx_PyNumber_Int(x);
        if (!tmp) return (long)-1;
        val = __Pyx_PyInt_AsLong(tmp);
        Py_DECREF(tmp);
        return val;
    }
}

static INLINE PY_LONG_LONG __Pyx_PyInt_AsLongLong(PyObject* x) {
#if PY_VERSION_HEX < 0x03000000
    if (likely(PyInt_CheckExact(x) || PyInt_Check(x))) {
        long val = PyInt_AS_LONG(x);
        return (PY_LONG_LONG)val;
    } else
#endif
    if (likely(PyLong_CheckExact(x) || PyLong_Check(x))) {
        return PyLong_AsLongLong(x);
    } else {
        PY_LONG_LONG val;
        PyObject *tmp = __Pyx_PyNumber_Int(x);
        if (!tmp) return (PY_LONG_LONG)-1;
        val = __Pyx_PyInt_AsLongLong(tmp);
        Py_DECREF(tmp);
        return val;
    }
}

static INLINE signed long __Pyx_PyInt_AsSignedLong(PyObject* x) {
#if PY_VERSION_HEX < 0x03000000
    if (likely(PyInt_CheckExact(x) || PyInt_Check(x))) {
        long val = PyInt_AS_LONG(x);
        return (signed long)val;
    } else
#endif
    if (likely(PyLong_CheckExact(x) || PyLong_Check(x))) {
        return PyLong_AsLong(x);
    } else {
        signed long val;
        PyObject *tmp = __Pyx_PyNumber_Int(x);
        if (!tmp) return (signed long)-1;
        val = __Pyx_PyInt_AsSignedLong(tmp);
        Py_DECREF(tmp);
        return val;
    }
}

static INLINE signed PY_LONG_LONG __Pyx_PyInt_AsSignedLongLong(PyObject* x) {
#if PY_VERSION_HEX < 0x03000000
    if (likely(PyInt_CheckExact(x) || PyInt_Check(x))) {
        long val = PyInt_AS_LONG(x);
        return (signed PY_LONG_LONG)val;
    } else
#endif
    if (likely(PyLong_CheckExact(x) || PyLong_Check(x))) {
        return PyLong_AsLongLong(x);
    } else {
        signed PY_LONG_LONG val;
        PyObject *tmp = __Pyx_PyNumber_Int(x);
        if (!tmp) return (signed PY_LONG_LONG)-1;
        val = __Pyx_PyInt_AsSignedLongLong(tmp);
        Py_DECREF(tmp);
        return val;
    }
}

#include "compile.h"
#include "frameobject.h"
#include "traceback.h"

static void __Pyx_AddTraceback(const char *funcname) {
    PyObject *py_srcfile = 0;
    PyObject *py_funcname = 0;
    PyObject *py_globals = 0;
    PyObject *empty_string = 0;
    PyCodeObject *py_code = 0;
    PyFrameObject *py_frame = 0;

    #if PY_MAJOR_VERSION < 3
    py_srcfile = PyString_FromString(__pyx_filename);
    #else
    py_srcfile = PyUnicode_FromString(__pyx_filename);
    #endif
    if (!py_srcfile) goto bad;
    if (__pyx_clineno) {
        #if PY_MAJOR_VERSION < 3
        py_funcname = PyString_FromFormat( "%s (%s:%d)", funcname, __pyx_cfilenm, __pyx_clineno);
        #else
        py_funcname = PyUnicode_FromFormat( "%s (%s:%d)", funcname, __pyx_cfilenm, __pyx_clineno);
        #endif
    }
    else {
        #if PY_MAJOR_VERSION < 3
        py_funcname = PyString_FromString(funcname);
        #else
        py_funcname = PyUnicode_FromString(funcname);
        #endif
    }
    if (!py_funcname) goto bad;
    py_globals = PyModule_GetDict(__pyx_m);
    if (!py_globals) goto bad;
    #if PY_MAJOR_VERSION < 3
    empty_string = PyString_FromStringAndSize("", 0);
    #else
    empty_string = PyBytes_FromStringAndSize("", 0);
    #endif
    if (!empty_string) goto bad;
    py_code = PyCode_New(
        0,            /*int argcount,*/
        #if PY_MAJOR_VERSION >= 3
        0,            /*int kwonlyargcount,*/
        #endif
        0,            /*int nlocals,*/
        0,            /*int stacksize,*/
        0,            /*int flags,*/
        empty_string, /*PyObject *code,*/
        __pyx_empty_tuple,  /*PyObject *consts,*/
        __pyx_empty_tuple,  /*PyObject *names,*/
        __pyx_empty_tuple,  /*PyObject *varnames,*/
        __pyx_empty_tuple,  /*PyObject *freevars,*/
        __pyx_empty_tuple,  /*PyObject *cellvars,*/
        py_srcfile,   /*PyObject *filename,*/
        py_funcname,  /*PyObject *name,*/
        __pyx_lineno,   /*int firstlineno,*/
        empty_string  /*PyObject *lnotab*/
    );
    if (!py_code) goto bad;
    py_frame = PyFrame_New(
        PyThreadState_GET(), /*PyThreadState *tstate,*/
        py_code,             /*PyCodeObject *code,*/
        py_globals,          /*PyObject *globals,*/
        0                    /*PyObject *locals*/
    );
    if (!py_frame) goto bad;
    py_frame->f_lineno = __pyx_lineno;
    PyTraceBack_Here(py_frame);
bad:
    Py_XDECREF(py_srcfile);
    Py_XDECREF(py_funcname);
    Py_XDECREF(empty_string);
    Py_XDECREF(py_code);
    Py_XDECREF(py_frame);
}

static int __Pyx_InitStrings(__Pyx_StringTabEntry *t) {
    while (t->p) {
        #if PY_MAJOR_VERSION < 3
        if (t->is_unicode && (!t->is_identifier)) {
            *t->p = PyUnicode_DecodeUTF8(t->s, t->n - 1, NULL);
        } else if (t->intern) {
            *t->p = PyString_InternFromString(t->s);
        } else {
            *t->p = PyString_FromStringAndSize(t->s, t->n - 1);
        }
        #else  /* Python 3+ has unicode identifiers */
        if (t->is_identifier || (t->is_unicode && t->intern)) {
            *t->p = PyUnicode_InternFromString(t->s);
        } else if (t->is_unicode) {
            *t->p = PyUnicode_FromStringAndSize(t->s, t->n - 1);
        } else {
            *t->p = PyBytes_FromStringAndSize(t->s, t->n - 1);
        }
        #endif
        if (!*t->p)
            return -1;
        ++t;
    }
    return 0;
}

/* Type Conversion Functions */

static INLINE int __Pyx_PyObject_IsTrue(PyObject* x) {
   if (x == Py_True) return 1;
   else if ((x == Py_False) | (x == Py_None)) return 0;
   else return PyObject_IsTrue(x);
}

static INLINE PyObject* __Pyx_PyNumber_Int(PyObject* x) {
  PyNumberMethods *m;
  const char *name = NULL;
  PyObject *res = NULL;
#if PY_VERSION_HEX < 0x03000000
  if (PyInt_Check(x) || PyLong_Check(x))
#else
  if (PyLong_Check(x))
#endif
    return Py_INCREF(x), x;
  m = Py_TYPE(x)->tp_as_number;
#if PY_VERSION_HEX < 0x03000000
  if (m && m->nb_int) {
    name = "int";
    res = PyNumber_Int(x);
  }
  else if (m && m->nb_long) {
    name = "long";
    res = PyNumber_Long(x);
  }
#else
  if (m && m->nb_int) {
    name = "int";
    res = PyNumber_Long(x);
  }
#endif
  if (res) {
#if PY_VERSION_HEX < 0x03000000
    if (!PyInt_Check(res) && !PyLong_Check(res)) {
#else
    if (!PyLong_Check(res)) {
#endif
      PyErr_Format(PyExc_TypeError,
                   "__%s__ returned non-%s (type %.200s)",
                   name, name, Py_TYPE(res)->tp_name);
      Py_DECREF(res);
      return NULL;
    }
  }
  else if (!PyErr_Occurred()) {
    PyErr_SetString(PyExc_TypeError,
                    "an integer is required");
  }
  return res;
}

static INLINE Py_ssize_t __Pyx_PyIndex_AsSsize_t(PyObject* b) {
  Py_ssize_t ival;
  PyObject* x = PyNumber_Index(b);
  if (!x) return -1;
  ival = PyInt_AsSsize_t(x);
  Py_DECREF(x);
  return ival;
}

static INLINE PyObject * __Pyx_PyInt_FromSize_t(size_t ival) {
#if PY_VERSION_HEX < 0x02050000
   if (ival <= LONG_MAX)
       return PyInt_FromLong((long)ival);
   else {
       unsigned char *bytes = (unsigned char *) &ival;
       int one = 1; int little = (int)*(unsigned char*)&one;
       return _PyLong_FromByteArray(bytes, sizeof(size_t), little, 0);
   }
#else
   return PyInt_FromSize_t(ival);
#endif
}

static INLINE size_t __Pyx_PyInt_AsSize_t(PyObject* x) {
   unsigned PY_LONG_LONG val = __Pyx_PyInt_AsUnsignedLongLong(x);
   if (unlikely(val == (unsigned PY_LONG_LONG)-1 && PyErr_Occurred())) {
       return (size_t)-1;
   } else if (unlikely(val != (unsigned PY_LONG_LONG)(size_t)val)) {
       PyErr_SetString(PyExc_OverflowError,
                       "value too large to convert to size_t");
       return (size_t)-1;
   }
   return (size_t)val;
}


